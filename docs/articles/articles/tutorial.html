<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>[GER] Tutorial • rOstluft</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/lumen/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../../pkgdown.css" rel="stylesheet">
<script src="../../pkgdown.js"></script><meta property="og:title" content="[GER] Tutorial">
<meta property="og:description" content="">
<meta property="og:image" content="/logo.png">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../../index.html">rOstluft</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.0.9023</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../../articles/articles/tutorial.html">[GER] Tutorial</a>
    </li>
    <li>
      <a href="../../articles/resample.html">[GER] Resampling data</a>
    </li>
    <li>
      <a href="../../articles/Technische_Entscheidungen.html">[GER] Technische Entscheidungen</a>
    </li>
  </ul>
</li>
<li>
  <a href="../../articles/articles/tutorial.html">
    <span class="fa fa-leanpub"></span>
     
    Tutorial
  </a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/Ostluft/rOstluft">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>[GER] Tutorial</h1>
                        <h4 class="author">Thomas von Allmen</h4>
            
            <h4 class="date">2019-03-28</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/Ostluft/rOstluft/blob/master/vignettes/articles/tutorial.Rmd"><code>vignettes/articles/tutorial.Rmd</code></a></small>
      <div class="hidden name"><code>tutorial.Rmd</code></div>

    </div>

    
    
<div id="einleitung" class="section level1">
<h1 class="hasAnchor">
<a href="#einleitung" class="anchor"></a>Einleitung</h1>
<p>Dieses Dokument soll einem Anwender des Packages <code><a href="../../reference/rOstluft.html">rOstluft::rOstluft</a></code> einen Überblick der enthaltenen Funktionalität bieten und die gängigsten Arbeitsabläufe aufzeigen.</p>
<p>Der Fokus dieses Packages liegt in der Bereitstellung von Daten aus verschiedenen Datenquellen in einem einheitlichen Format zur Analyse der Luftqualität. Ausserdem enthält es Werkzeuge für einige übliche Aufgaben, die während solchen Analysen anfallen. Diese sind Umrechnungen zwischen verschiedenen Mittelungsintervallen, Statistische Methoden mit Berücksichtung der Datenverfügbarkeit, Umwandlung von Volumen- und Massenkonzentrationen und lesen von Daten vorliegend in verschiedenen Formaten.</p>
</div>
<div id="installation" class="section level1">
<h1 class="hasAnchor">
<a href="#installation" class="anchor"></a>Installation</h1>
<p>Der Quellcode von <a href="https://github.com/Ostluft/rOstluft">rOstluft</a> ist auf github gehosted. Die einfachste Variante ist die Installation mit Hilfe des Packages devtools:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#install.packages("devtools")</span>
devtools<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/devtools/topics/reexports">install_github</a></span>(<span class="st">"Ostluft/rOstluft"</span>)</code></pre></div>
<p>Zusätzlich muss das Package <code>aws.s3</code> manuell aus dem cloudyr Repositorium installiert werden, weil die CRANR Version veraltet ist:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/install.packages">install.packages</a></span>(<span class="st">"aws.s3"</span>, <span class="dt">repos =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"cloudyr"</span> =<span class="st"> "http://cloudyr.github.io/drat"</span>))</code></pre></div>
<p>Ist dies wegen Einschränkungen durch Firewalls oder Proxies nicht möglich. Muss der Quellcode manuell von github heruntergeladen werden (Clone or download &gt; Download as ZIP), entpackt und manuell installiert werden. Allerdings bestehen Abhängigkeiten zu Packages die auf CRAN bereitgestellt werden. Können auch keine CRAN Packages installiert werden, müssen zuerst alle CRAN Abhängkigkeiten und deren Abhängigkeiten installiert werden.</p>
<p>Zusätzlich besteht noch die Github Abhängkigkeit zu <a href="https://github.com/Ostluft/rOstluft.data">rOstluft.data</a>. Dieses Packages muss auf die gleiche Weise zuerst installiert werden mit folgenden Schritten:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/download.file">download.file</a></span>(<span class="st">"https://github.com/Ostluft/rOstluft/archive/master.zip"</span>, <span class="st">"rOstluft-master.zip"</span>)
<span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/download.file">download.file</a></span>(<span class="st">"https://github.com/Ostluft/rOstluft.data/archive/master.zip"</span>, <span class="st">"rOstluft.data-master.zip"</span>)

<span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/install.packages">install.packages</a></span>(<span class="st">"devtools"</span>)
<span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/install.packages">install.packages</a></span>(<span class="st">"aws.s3"</span>, <span class="dt">repos =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"cloudyr"</span> =<span class="st"> "http://cloudyr.github.io/drat"</span>))

deps &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">'dplyr'</span>, <span class="st">'tidyr'</span>, <span class="st">'lubridate'</span>, <span class="st">'R6'</span>, <span class="st">'rappdirs'</span>, <span class="st">'tibble'</span>, <span class="st">'base64url'</span>, <span class="st">'forcats'</span>, 
          <span class="st">'fs'</span>, <span class="st">'purrr'</span>, <span class="st">'readr'</span>, <span class="st">'stringr'</span>, <span class="st">'plyr'</span>, <span class="st">'stringi'</span>, <span class="st">'sp'</span>, <span class="st">'rgdal'</span>, <span class="st">'rlang'</span>, <span class="st">'magrittr'</span>)

<span class="cf">for</span> (p <span class="cf">in</span> deps) {
  <span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/install.packages">install.packages</a></span>(p)
}

devtools<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/devtools/topics/reexports">install_local</a></span>(<span class="st">"rOstluft.data-master.zip"</span>, <span class="dt">dependencies =</span> <span class="ot">FALSE</span>)
devtools<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/devtools/topics/reexports">install_local</a></span>(<span class="st">"rOstluft-master.zip"</span>, <span class="dt">dependencies =</span> <span class="ot">FALSE</span>)</code></pre></div>
<p>Falls das installieren von rOstluft scheitert, fehlt vermutlich eine Abhängigkeit. Welche das ist, kann der Fehlermeldung entnommen werden.</p>
<p>Nach der Installation kann das Packages verwendet werden:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(rOstluft)</code></pre></div>
</div>
<div id="abfrage-von-daten" class="section level1">
<h1 class="hasAnchor">
<a href="#abfrage-von-daten" class="anchor"></a>Abfrage von Daten</h1>
<div id="ostluft-amazon-aws-s3" class="section level2">
<h2 class="hasAnchor">
<a href="#ostluft-amazon-aws-s3" class="anchor"></a>Ostluft Amazon AWS S3</h2>
<p>Die zentrale Datenablage innerhalb von Ostluft erfolgt auf <a href="https://aws.amazon.com/s3/">Amazon AWS S3</a>.Aus Lizenztechnischen Gründen kann das Bucket nicht öffentlich zugänglich gemacht werden. Die Zugangsdaten werden von Jörg Sintermann vergeben. Die Zugangsdaten werden am einfachsten über eine .Renvirion Datei im Verzeichnis des RStudio Projekts dem Package zugänglich gemacht. Inhalt der .Renvirion Datei:</p>
<pre><code>AWS_ACCESS_KEY_ID = "XXXXXXXXXXXXXXXXXXXX"
AWS_SECRET_ACCESS_KEY = "XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX"
AWS_DEFAULT_REGION = "eu-central-1"</code></pre>
<p>Weitere Möglichkeiten sind in der Dokumentation von <a href="https://github.com/cloudyr/aws.signature/">aws.signature</a> zu finden.</p>
<p>Sämtliche Daten die einmal von Amazon S3 geöffnet wurden, werden lokal auf dem Rechner gespeichert. Bei jedem folgenden Zugriff wird nur überprüft, ob die Daten noch identisch sind.</p>
<p>Der Zugriff auf die Daten erfügt dann über ein store Objekt, welches auf folgende Art initialisiert wird:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">store &lt;-<span class="st"> </span><span class="kw"><a href="../../reference/r6_storage_s3.html">storage_s3_rds</a></span>(<span class="st">"tutorial"</span>, <span class="dt">format =</span> <span class="kw"><a href="../../reference/format_rolf.html">format_rolf</a></span>(), <span class="dt">bucket =</span> <span class="st">"rostluft"</span>, <span class="dt">prefix =</span> <span class="st">"aqmet"</span>)
<span class="co">#&gt; store tutorial initialized under 'C:\Users\tom\AppData\Local\rOstluft\tutorial'</span></code></pre></div>
<p><em>TODO: Beschreibung was die verschiedenen Argument bedeuten</em></p>
<p>Dieses store Objekt verfügt über verschiedene Methoden, zur Abfrage von Daten sind jedoch nur zwei von Bedeutung:</p>
<ul>
<li>
<code>$get_content()</code>: holt eine Übersicht über alle im store enthaltene Daten</li>
<li>
<code>$get()</code>: Aktuelle Datenabfrage. Welche Daten geholt werden, muss über Funktionsargumente definiert werden</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">content &lt;-<span class="st"> </span>store<span class="op">$</span><span class="kw">get_content</span>()
content
<span class="co">#&gt; # A tibble: 146,220 x 6</span>
<span class="co">#&gt;     year interval site      parameter unit      n</span>
<span class="co">#&gt;    &lt;dbl&gt; &lt;fct&gt;    &lt;fct&gt;     &lt;fct&gt;     &lt;fct&gt; &lt;int&gt;</span>
<span class="co">#&gt;  1  2018 h8gl     8058_0030 O3        µg/m3  8672</span>
<span class="co">#&gt;  2  2018 y1       8058_0030 Hr        %Hr       1</span>
<span class="co">#&gt;  3  2018 y1       8058_0030 NO2       µg/m3     1</span>
<span class="co">#&gt;  4  2018 y1       8058_0030 NO        µg/m3     1</span>
<span class="co">#&gt;  5  2018 y1       8058_0030 NOx       ppb       1</span>
<span class="co">#&gt;  6  2018 y1       8058_0030 O3        µg/m3     1</span>
<span class="co">#&gt;  7  2018 y1       8058_0030 PM10      µg/m3     1</span>
<span class="co">#&gt;  8  2018 y1       8058_0030 RainDur   min       1</span>
<span class="co">#&gt;  9  2018 y1       8058_0030 T         °C        1</span>
<span class="co">#&gt; 10  2018 y1       8058_0030 p         hPa       1</span>
<span class="co">#&gt; # ... with 146,210 more rows</span>

dplyr<span class="op">::</span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/sample.html">sample_n</a></span>(content, <span class="dv">10</span>)
<span class="co">#&gt; # A tibble: 10 x 6</span>
<span class="co">#&gt;     year interval site                      parameter     unit      n</span>
<span class="co">#&gt;    &lt;dbl&gt; &lt;fct&gt;    &lt;fct&gt;                     &lt;fct&gt;         &lt;fct&gt; &lt;int&gt;</span>
<span class="co">#&gt;  1  2005 y1       Zch_Stampfenbachstrasse   CO_nb_min30   1         1</span>
<span class="co">#&gt;  2  2011 m1       Säntis                    WVs_min_min10 m/s      12</span>
<span class="co">#&gt;  3  1994 m1       Fra_Bahnhofstrasse        T_min_h1      °C       12</span>
<span class="co">#&gt;  4  2018 d1       Zch_Rosengartenstrasse    NO_min_min30  µg/m3   361</span>
<span class="co">#&gt;  5  2013 m1       8058_0030                 T_max_h1      °C       12</span>
<span class="co">#&gt;  6  2013 y1       StG_Blumenbergplatz       NO_nb_d1      1         1</span>
<span class="co">#&gt;  7  1996 m1       Rap_Merkurstrasse         WD            °        12</span>
<span class="co">#&gt;  8  2016 m1       WeF_Berufsbildungszentrum Hr_nb_min30   1        12</span>
<span class="co">#&gt;  9  2004 y1       Opf_Balsberg              O3_nb_h1      1         1</span>
<span class="co">#&gt; 10  2005 d1       Mau_Pünt                  WD_nb_min30   1       108</span></code></pre></div>
<p>Eine Datenabfrage holt immer die Daten von einem komplettem Jahr einer Station für einen bestimmten Mittelungszeitraum:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">store<span class="op">$</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/get">get</a></span>(<span class="dt">site =</span> <span class="st">"Zch_Schimmelstrasse"</span>, <span class="dt">year =</span> <span class="dv">2014</span>, <span class="dt">interval =</span> <span class="st">"min30"</span>)
<span class="co">#&gt; # A tibble: 243,875 x 6</span>
<span class="co">#&gt;    starttime           site               parameter interval unit     value</span>
<span class="co">#&gt;    &lt;dttm&gt;              &lt;fct&gt;              &lt;fct&gt;     &lt;fct&gt;    &lt;fct&gt;    &lt;dbl&gt;</span>
<span class="co">#&gt;  1 2014-01-01 00:00:00 Zch_Schimmelstras~ CO        min30    ppm    6.37e-1</span>
<span class="co">#&gt;  2 2014-01-01 00:00:00 Zch_Schimmelstras~ Hr        min30    %Hr    8.74e+1</span>
<span class="co">#&gt;  3 2014-01-01 00:00:00 Zch_Schimmelstras~ NO2       min30    ppb    2.81e+1</span>
<span class="co">#&gt;  4 2014-01-01 00:00:00 Zch_Schimmelstras~ NO        min30    ppb    6.15e+1</span>
<span class="co">#&gt;  5 2014-01-01 00:00:00 Zch_Schimmelstras~ NOx       min30    ppb    8.96e+1</span>
<span class="co">#&gt;  6 2014-01-01 00:00:00 Zch_Schimmelstras~ O3        min30    ppb    7.98e-1</span>
<span class="co">#&gt;  7 2014-01-01 00:00:00 Zch_Schimmelstras~ PM10      min30    µg/m3  1.02e+2</span>
<span class="co">#&gt;  8 2014-01-01 00:00:00 Zch_Schimmelstras~ PN        min30    1/cm3  2.60e+4</span>
<span class="co">#&gt;  9 2014-01-01 00:00:00 Zch_Schimmelstras~ RainDur   min30    min    0.     </span>
<span class="co">#&gt; 10 2014-01-01 00:00:00 Zch_Schimmelstras~ SO2       min30    ppb    2.12e+0</span>
<span class="co">#&gt; # ... with 243,865 more rows</span></code></pre></div>
<p>Jedes der Argumente kann auch ein Vector sein mit mehreren Werte. Es wird dann Kombination aller Möglichkeiten abgefragt.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">sites &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"Zch_Schimmelstrasse"</span>, <span class="st">"Zch_Rosengartenstrasse"</span>, <span class="st">"Zch_Stampfenbachstrasse"</span>)
data &lt;-<span class="st"> </span>store<span class="op">$</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/get">get</a></span>(<span class="dt">site =</span> sites, <span class="dt">year =</span> <span class="dv">2014</span><span class="op">:</span><span class="dv">2015</span>, <span class="dt">interval =</span> <span class="st">"min30"</span>)
data
<span class="co">#&gt; # A tibble: 1,287,367 x 6</span>
<span class="co">#&gt;    starttime           site               parameter interval unit     value</span>
<span class="co">#&gt;    &lt;dttm&gt;              &lt;fct&gt;              &lt;fct&gt;     &lt;fct&gt;    &lt;fct&gt;    &lt;dbl&gt;</span>
<span class="co">#&gt;  1 2014-01-01 00:00:00 Zch_Rosengartenst~ Hr        min30    %Hr     92.7  </span>
<span class="co">#&gt;  2 2014-01-01 00:00:00 Zch_Rosengartenst~ NO2       min30    ppb     18.6  </span>
<span class="co">#&gt;  3 2014-01-01 00:00:00 Zch_Rosengartenst~ NO        min30    ppb     42.8  </span>
<span class="co">#&gt;  4 2014-01-01 00:00:00 Zch_Rosengartenst~ NOx       min30    ppb     61.4  </span>
<span class="co">#&gt;  5 2014-01-01 00:00:00 Zch_Rosengartenst~ O3        min30    ppb      0.776</span>
<span class="co">#&gt;  6 2014-01-01 00:00:00 Zch_Rosengartenst~ PM10      min30    µg/m3  298.   </span>
<span class="co">#&gt;  7 2014-01-01 00:00:00 Zch_Rosengartenst~ RainDur   min30    min      0    </span>
<span class="co">#&gt;  8 2014-01-01 00:00:00 Zch_Rosengartenst~ T         min30    °C      -2.18 </span>
<span class="co">#&gt;  9 2014-01-01 00:00:00 Zch_Rosengartenst~ p         min30    hPa    966.   </span>
<span class="co">#&gt; 10 2014-01-01 00:30:00 Zch_Rosengartenst~ Hr        min30    %Hr     89.1  </span>
<span class="co">#&gt; # ... with 1,287,357 more rows</span>

dplyr<span class="op">::</span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/sample.html">sample_n</a></span>(data, <span class="dv">10</span>)
<span class="co">#&gt; # A tibble: 10 x 6</span>
<span class="co">#&gt;    starttime           site                parameter interval unit    value</span>
<span class="co">#&gt;    &lt;dttm&gt;              &lt;fct&gt;               &lt;fct&gt;     &lt;fct&gt;    &lt;fct&gt;   &lt;dbl&gt;</span>
<span class="co">#&gt;  1 2015-05-03 21:00:00 Zch_Stampfenbachst~ NO        min30    ppb    11.2  </span>
<span class="co">#&gt;  2 2015-06-06 11:30:00 Zch_Rosengartenstr~ T         min30    °C     27.4  </span>
<span class="co">#&gt;  3 2014-04-14 05:30:00 Zch_Rosengartenstr~ T         min30    °C      8.45 </span>
<span class="co">#&gt;  4 2014-04-29 15:00:00 Zch_Schimmelstrasse p         min30    hPa   965.   </span>
<span class="co">#&gt;  5 2014-10-04 02:30:00 Zch_Schimmelstrasse SO2       min30    ppb     0.464</span>
<span class="co">#&gt;  6 2015-07-30 10:30:00 Zch_Rosengartenstr~ NOx       min30    ppb    26.5  </span>
<span class="co">#&gt;  7 2014-10-06 10:00:00 Zch_Schimmelstrasse p         min30    hPa   966.   </span>
<span class="co">#&gt;  8 2014-07-11 07:00:00 Zch_Rosengartenstr~ Hr        min30    %Hr    89.5  </span>
<span class="co">#&gt;  9 2014-09-07 22:00:00 Zch_Schimmelstrasse RainDur   min30    min     0    </span>
<span class="co">#&gt; 10 2015-11-14 21:30:00 Zch_Stampfenbachst~ WVv       min30    m/s     1.08</span></code></pre></div>
<p>Die letzte Funktionalität von <code>$get()</code> ist die Filterung der Daten vor der Rückgabe. Mit dem Argument “filter” als <code><a href="https://dplyr.tidyverse.org/reference/filter.html">dplyr::filter()</a></code> kompatibler Ausdruck:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">store<span class="op">$</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/get">get</a></span>(<span class="dt">site =</span> sites, <span class="dt">year =</span> <span class="dv">2014</span>, <span class="dt">interval =</span> <span class="st">"min30"</span>, <span class="dt">filter =</span> parameter <span class="op">==</span><span class="st"> "PM10"</span>)
<span class="co">#&gt; # A tibble: 51,319 x 6</span>
<span class="co">#&gt;    starttime           site                  parameter interval unit  value</span>
<span class="co">#&gt;    &lt;dttm&gt;              &lt;fct&gt;                 &lt;fct&gt;     &lt;fct&gt;    &lt;fct&gt; &lt;dbl&gt;</span>
<span class="co">#&gt;  1 2014-01-01 00:00:00 Zch_Rosengartenstras~ PM10      min30    µg/m3 298. </span>
<span class="co">#&gt;  2 2014-01-01 00:30:00 Zch_Rosengartenstras~ PM10      min30    µg/m3 557. </span>
<span class="co">#&gt;  3 2014-01-01 01:00:00 Zch_Rosengartenstras~ PM10      min30    µg/m3 308. </span>
<span class="co">#&gt;  4 2014-01-01 01:30:00 Zch_Rosengartenstras~ PM10      min30    µg/m3 169. </span>
<span class="co">#&gt;  5 2014-01-01 02:00:00 Zch_Rosengartenstras~ PM10      min30    µg/m3 128. </span>
<span class="co">#&gt;  6 2014-01-01 02:30:00 Zch_Rosengartenstras~ PM10      min30    µg/m3  82.9</span>
<span class="co">#&gt;  7 2014-01-01 03:00:00 Zch_Rosengartenstras~ PM10      min30    µg/m3  38.3</span>
<span class="co">#&gt;  8 2014-01-01 03:30:00 Zch_Rosengartenstras~ PM10      min30    µg/m3  32.6</span>
<span class="co">#&gt;  9 2014-01-01 04:00:00 Zch_Rosengartenstras~ PM10      min30    µg/m3  32.4</span>
<span class="co">#&gt; 10 2014-01-01 04:30:00 Zch_Rosengartenstras~ PM10      min30    µg/m3  31.7</span>
<span class="co">#&gt; # ... with 51,309 more rows</span></code></pre></div>
</div>
<div id="lokales-arbeiten-mit-den-aws-s3-daten" class="section level2">
<h2 class="hasAnchor">
<a href="#lokales-arbeiten-mit-den-aws-s3-daten" class="anchor"></a>Lokales Arbeiten mit den AWS S3 Daten</h2>
<p>Ein Nachteil des S3 Storage ist, dass bei jeder Datenabfrage eine Internetverbindung zur Überprüfung ob aktualisierte Daten verfügbar sind vorhanden sein muss. Selbst wenn die Daten bereits lokal gespeichert sind. Nicht nur wird eine Internetverbindung benötigt, die Überprüfung braucht auch eine kurze Zeit. Hat man alle notwendigen Daten bereits herunter geladen, kann man jedoch mit einem lokalen Store arbeiten. Praktischerweise hat der S3 Store eine Funktion, welche einen lokalen Store zurückgibt.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">lokal &lt;-<span class="st"> </span>store<span class="op">$</span><span class="kw">get_local_storage</span>()</code></pre></div>
<p>Dieser verfügt über die gleichen Funktionalität wie der S3 Store:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">lokal<span class="op">$</span><span class="kw">get_content</span>()
<span class="co">#&gt; # A tibble: 146,220 x 6</span>
<span class="co">#&gt;     year interval site      parameter unit      n</span>
<span class="co">#&gt;    &lt;dbl&gt; &lt;fct&gt;    &lt;fct&gt;     &lt;fct&gt;     &lt;fct&gt; &lt;int&gt;</span>
<span class="co">#&gt;  1  2018 h8gl     8058_0030 O3        µg/m3  8672</span>
<span class="co">#&gt;  2  2018 y1       8058_0030 Hr        %Hr       1</span>
<span class="co">#&gt;  3  2018 y1       8058_0030 NO2       µg/m3     1</span>
<span class="co">#&gt;  4  2018 y1       8058_0030 NO        µg/m3     1</span>
<span class="co">#&gt;  5  2018 y1       8058_0030 NOx       ppb       1</span>
<span class="co">#&gt;  6  2018 y1       8058_0030 O3        µg/m3     1</span>
<span class="co">#&gt;  7  2018 y1       8058_0030 PM10      µg/m3     1</span>
<span class="co">#&gt;  8  2018 y1       8058_0030 RainDur   min       1</span>
<span class="co">#&gt;  9  2018 y1       8058_0030 T         °C        1</span>
<span class="co">#&gt; 10  2018 y1       8058_0030 p         hPa       1</span>
<span class="co">#&gt; # ... with 146,210 more rows</span>

lokal<span class="op">$</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/get">get</a></span>(<span class="dt">site =</span> sites, <span class="dt">year =</span> <span class="dv">2014</span>, <span class="dt">interval =</span> <span class="st">"min30"</span>, <span class="dt">filter =</span> parameter <span class="op">==</span><span class="st"> "PM10"</span>)
<span class="co">#&gt; # A tibble: 51,319 x 6</span>
<span class="co">#&gt;    starttime           site                  parameter interval unit  value</span>
<span class="co">#&gt;    &lt;dttm&gt;              &lt;fct&gt;                 &lt;fct&gt;     &lt;fct&gt;    &lt;fct&gt; &lt;dbl&gt;</span>
<span class="co">#&gt;  1 2014-01-01 00:00:00 Zch_Rosengartenstras~ PM10      min30    µg/m3 298. </span>
<span class="co">#&gt;  2 2014-01-01 00:30:00 Zch_Rosengartenstras~ PM10      min30    µg/m3 557. </span>
<span class="co">#&gt;  3 2014-01-01 01:00:00 Zch_Rosengartenstras~ PM10      min30    µg/m3 308. </span>
<span class="co">#&gt;  4 2014-01-01 01:30:00 Zch_Rosengartenstras~ PM10      min30    µg/m3 169. </span>
<span class="co">#&gt;  5 2014-01-01 02:00:00 Zch_Rosengartenstras~ PM10      min30    µg/m3 128. </span>
<span class="co">#&gt;  6 2014-01-01 02:30:00 Zch_Rosengartenstras~ PM10      min30    µg/m3  82.9</span>
<span class="co">#&gt;  7 2014-01-01 03:00:00 Zch_Rosengartenstras~ PM10      min30    µg/m3  38.3</span>
<span class="co">#&gt;  8 2014-01-01 03:30:00 Zch_Rosengartenstras~ PM10      min30    µg/m3  32.6</span>
<span class="co">#&gt;  9 2014-01-01 04:00:00 Zch_Rosengartenstras~ PM10      min30    µg/m3  32.4</span>
<span class="co">#&gt; 10 2014-01-01 04:30:00 Zch_Rosengartenstras~ PM10      min30    µg/m3  31.7</span>
<span class="co">#&gt; # ... with 51,309 more rows</span></code></pre></div>
<p>Dem aufmerksamen Leser ist vermutlich aufgefallen, dass die Inhaltsübersicht von <code>$get_content()</code> nicht dem lokalen Inhalt entspricht. Es ist immer noch die Übersicht welche Daten in S3 verfügbar wären. Will man wissen welche Daten lokal verfügbar sind, hilft einem die Funktion <code>$list_chunks()</code> weiter.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">tibble<span class="op">::</span><span class="kw"><a href="https://tibble.tidyverse.org/reference/glimpse.html">glimpse</a></span>(lokal<span class="op">$</span><span class="kw">list_chunks</span>())
<span class="co">#&gt; Observations: 6</span>
<span class="co">#&gt; Variables: 7</span>
<span class="co">#&gt; $ chunk_name              &lt;chr&gt; "min30/bWluMzDCu1pjaF9Sb3NlbmdhcnRlbnN...</span>
<span class="co">#&gt; $ interval                &lt;chr&gt; "min30", "min30", "min30", "min30", "m...</span>
<span class="co">#&gt; $ site                    &lt;chr&gt; "Zch_Rosengartenstrasse", "Zch_Rosenga...</span>
<span class="co">#&gt; $ year                    &lt;chr&gt; "2014", "2015", "2014", "2015", "2014"...</span>
<span class="co">#&gt; $ local.path              &lt;fs::path&gt; "C:/Users/tom/AppData/Local/rOstl...</span>
<span class="co">#&gt; $ local.modification_time &lt;dttm&gt; 2019-03-28 16:29:50, 2019-03-28 16:29...</span>
<span class="co">#&gt; $ local.size              &lt;fs::bytes&gt; 662.57K, 780.05K, 1.07M, 1.07M, ...</span></code></pre></div>
<p>Auch der S3 Store verfügt über die <code>$list_chunks()</code> Funktion.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">tibble<span class="op">::</span><span class="kw"><a href="https://tibble.tidyverse.org/reference/glimpse.html">glimpse</a></span>(store<span class="op">$</span><span class="kw">list_chunks</span>())
<span class="co">#&gt; Observations: 7,025</span>
<span class="co">#&gt; Variables: 11</span>
<span class="co">#&gt; $ chunk_name              &lt;chr&gt; "d1/ZDHCu01hdV9Qw7xudMK7MTk5MA", "d1/Z...</span>
<span class="co">#&gt; $ interval                &lt;chr&gt; "d1", "d1", "d1", "d1", "d1", "d1", "d...</span>
<span class="co">#&gt; $ site                    &lt;chr&gt; "Mau_Pünt", "Mau_Pünt", "Mau_Pünt", "M...</span>
<span class="co">#&gt; $ year                    &lt;chr&gt; "1990", "1991", "1992", "1993", "1994"...</span>
<span class="co">#&gt; $ s3.key                  &lt;chr&gt; "aqmet/data/d1/ZDHCu01hdV9Qw7xudMK7MTk...</span>
<span class="co">#&gt; $ s3.lastmodified         &lt;chr&gt; "2019-03-26T15:20:05.000Z", "2019-03-2...</span>
<span class="co">#&gt; $ s3.etag                 &lt;chr&gt; "cb52efc18f4157a6c6cb508f5d116922", "2...</span>
<span class="co">#&gt; $ s3.size                 &lt;fs::bytes&gt; 15.7K, 27.02K, 29.17K, 28.24K, 1...</span>
<span class="co">#&gt; $ local.path              &lt;fs::path&gt; NA, NA, NA, NA, NA, NA, NA, NA, N...</span>
<span class="co">#&gt; $ local.modification_time &lt;dttm&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, N...</span>
<span class="co">#&gt; $ local.size              &lt;fs::bytes&gt; NA, NA, NA, NA, NA, NA, NA, NA, ...</span></code></pre></div>
<p>Im normal Fall ist Nutzung von <code>$get_content()</code> über <code>$list_chunks()</code> zu bevorzugen. Die Rückgabe von <code>$get_content()</code> enthält die gemessen Parameter und die Anzahl der gültigen Punkte. Bei <code>$list_chunks()</code> hingegen sind einige interne Informationen über den Store enthalten.</p>
<p>Um die Vorbereitung um mit einem lokalen Store zu arbeiten zu vereinfachen verfügt der S3 Store über die Funktion <code>$download(...)</code>. Die dot Argumente werden als Filter auf die Rückgabe von <code>$list_chunks()</code> angewendet. Ohne Argumente wird der komplette Store heruntergeladen. Folgendes Beispiel lädt samtliche 30 Minutenmittelwerte für die Station Rosengartenstrasse nach dem Jahr 2015 (Achtung == verwenden, es sind Filter Ausdrücke!):</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">store<span class="op">$</span><span class="kw">download</span>(site <span class="op">==</span><span class="st"> "Zch_Rosengartenstrasse"</span>, interval <span class="op">==</span><span class="st"> "min30"</span>, year <span class="op">&gt;</span><span class="st"> </span><span class="dv">2015</span>)
<span class="co">#&gt; list()</span>

lokal<span class="op">$</span><span class="kw">list_chunks</span>() <span class="op">%&gt;%</span><span class="st"> </span>dplyr<span class="op">::</span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(<span class="st">"site"</span>, <span class="st">"year"</span>, <span class="st">"interval"</span>)
<span class="co">#&gt; # A tibble: 9 x 3</span>
<span class="co">#&gt;   site                    year  interval</span>
<span class="co">#&gt;   &lt;chr&gt;                   &lt;chr&gt; &lt;chr&gt;   </span>
<span class="co">#&gt; 1 Zch_Rosengartenstrasse  2017  min30   </span>
<span class="co">#&gt; 2 Zch_Rosengartenstrasse  2018  min30   </span>
<span class="co">#&gt; 3 Zch_Rosengartenstrasse  2014  min30   </span>
<span class="co">#&gt; 4 Zch_Rosengartenstrasse  2015  min30   </span>
<span class="co">#&gt; 5 Zch_Rosengartenstrasse  2016  min30   </span>
<span class="co">#&gt; 6 Zch_Stampfenbachstrasse 2014  min30   </span>
<span class="co">#&gt; 7 Zch_Stampfenbachstrasse 2015  min30   </span>
<span class="co">#&gt; 8 Zch_Schimmelstrasse     2014  min30   </span>
<span class="co">#&gt; 9 Zch_Schimmelstrasse     2015  min30</span></code></pre></div>
</div>
<div id="eigene-daten-in-einem-lokalen-store" class="section level2">
<h2 class="hasAnchor">
<a href="#eigene-daten-in-einem-lokalen-store" class="anchor"></a>Eigene Daten in einem lokalen Store</h2>
<p>Der aqmet S3 Store enthält nur bereinigte Daten von abgeschlossenen Jahren. Werden Daten benötigt, die nicht in S3 vorhanden sind, bietet sich die Nutzung eines seperaten lokalen Stores an:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">my_store =<span class="st"> </span><span class="kw"><a href="../../reference/r6_storage_local.html">storage_local_rds</a></span>(<span class="st">"eigene_daten"</span>, <span class="kw"><a href="../../reference/format_rolf.html">format_rolf</a></span>(), <span class="dt">read.only =</span> <span class="ot">FALSE</span>)
<span class="co">#&gt; Local store eigene_daten initialized under 'C:\Users\tom\AppData\Local\rOstluft\eigene_daten'</span></code></pre></div>
<p>In diesen kann man nun Daten mit der Store Funktion <code>$put()</code> oder der Hilfsfunktion <code><a href="../../reference/import_directory.html">import_directory()</a></code> importieren:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">examples_path &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/system.file">system.file</a></span>(<span class="st">"extdata"</span>, <span class="dt">package =</span> <span class="st">"rOstluft.data"</span>)
<span class="kw"><a href="../../reference/import_directory.html">import_directory</a></span>(my_store, examples_path, read_airmo_csv, <span class="dt">glob =</span> <span class="st">"*Jan.csv"</span>)
<span class="co">#&gt; Importing 'D:/tom/Documents/R/win-library/3.5/rOstluft.data/extdata/Zch_Stampfenbachstrasse_d1_2013_Jan.csv' with size 25.4K. File 1 of 3</span>
<span class="co">#&gt; Read 'D:/tom/Documents/R/win-library/3.5/rOstluft.data/extdata/Zch_Stampfenbachstrasse_d1_2013_Jan.csv' in 0.37 seconds. Got 2170 data points</span>
<span class="co">#&gt; Put data into store eigene_daten in 0.04 seconds</span>
<span class="co">#&gt; Importing 'D:/tom/Documents/R/win-library/3.5/rOstluft.data/extdata/Zch_Stampfenbachstrasse_h1_2013_Jan.csv' with size 142K. File 2 of 3</span>
<span class="co">#&gt; Read 'D:/tom/Documents/R/win-library/3.5/rOstluft.data/extdata/Zch_Stampfenbachstrasse_h1_2013_Jan.csv' in 0.07 seconds. Got 14116 data points</span>
<span class="co">#&gt; Put data into store eigene_daten in 0.09 seconds</span>
<span class="co">#&gt; Importing 'D:/tom/Documents/R/win-library/3.5/rOstluft.data/extdata/Zch_Stampfenbachstrasse_min30_2013_Jan.csv' with size 258K. File 3 of 3</span>
<span class="co">#&gt; Read 'D:/tom/Documents/R/win-library/3.5/rOstluft.data/extdata/Zch_Stampfenbachstrasse_min30_2013_Jan.csv' in 0.08 seconds. Got 28234 data points</span>
<span class="co">#&gt; Put data into store eigene_daten in 0.10 seconds</span>
<span class="co">#&gt; Finished import after 0.76 seconds</span>

fn &lt;-<span class="st"> </span>fs<span class="op">::</span><span class="kw"><a href="http://fs.r-lib.org/reference/path.html">path</a></span>(examples_path, <span class="st">"Zch_Rosengartenstrasse_2010-2014.csv"</span>)
my_data &lt;-<span class="st"> </span><span class="kw"><a href="../../reference/read_airmo_csv.html">read_airmo_csv</a></span>(fn)
my_store<span class="op">$</span><span class="kw">put</span>(my_data)
<span class="co">#&gt; # A tibble: 18 x 6</span>
<span class="co">#&gt;     year interval site                   parameter unit      n</span>
<span class="co">#&gt;    &lt;dbl&gt; &lt;fct&gt;    &lt;fct&gt;                  &lt;fct&gt;     &lt;fct&gt; &lt;int&gt;</span>
<span class="co">#&gt;  1  2013 min30    Zch_Rosengartenstrasse NO        µg/m3  4269</span>
<span class="co">#&gt;  2  2013 min30    Zch_Rosengartenstrasse NO2       µg/m3  4269</span>
<span class="co">#&gt;  3  2013 min30    Zch_Rosengartenstrasse NOx       ppb    4269</span>
<span class="co">#&gt;  4  2013 min30    Zch_Rosengartenstrasse O3        µg/m3  4277</span>
<span class="co">#&gt;  5  2013 min30    Zch_Rosengartenstrasse PM10      µg/m3  4025</span>
<span class="co">#&gt;  6  2013 min30    Zch_Rosengartenstrasse Hr        %Hr    4010</span>
<span class="co">#&gt;  7  2013 min30    Zch_Rosengartenstrasse p         hPa    4291</span>
<span class="co">#&gt;  8  2013 min30    Zch_Rosengartenstrasse RainDur   min    4291</span>
<span class="co">#&gt;  9  2013 min30    Zch_Rosengartenstrasse T         °C     4010</span>
<span class="co">#&gt; 10  2014 min30    Zch_Rosengartenstrasse NO        µg/m3 17415</span>
<span class="co">#&gt; 11  2014 min30    Zch_Rosengartenstrasse NO2       µg/m3 17415</span>
<span class="co">#&gt; 12  2014 min30    Zch_Rosengartenstrasse NOx       ppb   17415</span>
<span class="co">#&gt; 13  2014 min30    Zch_Rosengartenstrasse O3        µg/m3 17366</span>
<span class="co">#&gt; 14  2014 min30    Zch_Rosengartenstrasse PM10      µg/m3 16788</span>
<span class="co">#&gt; 15  2014 min30    Zch_Rosengartenstrasse Hr        %Hr   17517</span>
<span class="co">#&gt; 16  2014 min30    Zch_Rosengartenstrasse p         hPa   17519</span>
<span class="co">#&gt; 17  2014 min30    Zch_Rosengartenstrasse RainDur   min   17519</span>
<span class="co">#&gt; 18  2014 min30    Zch_Rosengartenstrasse T         °C    17517</span></code></pre></div>
<p>Wie gewohnt kann erhält man mit <code>$get_content()</code> eine Übersicht und die Daten mit <code>$get()</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">my_store<span class="op">$</span><span class="kw">get_content</span>()
<span class="co">#&gt; # A tibble: 126 x 6</span>
<span class="co">#&gt;     year interval site                   parameter unit      n</span>
<span class="co">#&gt;    &lt;dbl&gt; &lt;fct&gt;    &lt;fct&gt;                  &lt;fct&gt;     &lt;fct&gt; &lt;int&gt;</span>
<span class="co">#&gt;  1  2014 min30    Zch_Rosengartenstrasse NO        µg/m3 17415</span>
<span class="co">#&gt;  2  2014 min30    Zch_Rosengartenstrasse NO2       µg/m3 17415</span>
<span class="co">#&gt;  3  2014 min30    Zch_Rosengartenstrasse NOx       ppb   17415</span>
<span class="co">#&gt;  4  2014 min30    Zch_Rosengartenstrasse O3        µg/m3 17366</span>
<span class="co">#&gt;  5  2014 min30    Zch_Rosengartenstrasse PM10      µg/m3 16788</span>
<span class="co">#&gt;  6  2014 min30    Zch_Rosengartenstrasse Hr        %Hr   17517</span>
<span class="co">#&gt;  7  2014 min30    Zch_Rosengartenstrasse p         hPa   17519</span>
<span class="co">#&gt;  8  2014 min30    Zch_Rosengartenstrasse RainDur   min   17519</span>
<span class="co">#&gt;  9  2014 min30    Zch_Rosengartenstrasse T         °C    17517</span>
<span class="co">#&gt; 10  2013 min30    Zch_Rosengartenstrasse NO        µg/m3  4269</span>
<span class="co">#&gt; # ... with 116 more rows</span>

my_store<span class="op">$</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/get">get</a></span>(<span class="dt">site =</span> <span class="st">"Zch_Stampfenbachstrasse"</span>, <span class="dt">interval =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"d1"</span>, <span class="st">"h1"</span>), <span class="dt">year =</span> <span class="dv">2013</span>)  <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span>dplyr<span class="op">::</span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span>(.data<span class="op">$</span>starttime, .data<span class="op">$</span>parameter)
<span class="co">#&gt; # A tibble: 16,286 x 6</span>
<span class="co">#&gt;    starttime           site               parameter   interval unit   value</span>
<span class="co">#&gt;    &lt;dttm&gt;              &lt;fct&gt;              &lt;fct&gt;       &lt;fct&gt;    &lt;fct&gt;  &lt;dbl&gt;</span>
<span class="co">#&gt;  1 2013-01-01 00:00:00 Zch_Stampfenbachs~ CO          d1       mg/m3  0.381</span>
<span class="co">#&gt;  2 2013-01-01 00:00:00 Zch_Stampfenbachs~ CO          d1       ppm    0.327</span>
<span class="co">#&gt;  3 2013-01-01 00:00:00 Zch_Stampfenbachs~ CO          h1       mg/m3  0.805</span>
<span class="co">#&gt;  4 2013-01-01 00:00:00 Zch_Stampfenbachs~ CO          h1       ppm    0.692</span>
<span class="co">#&gt;  5 2013-01-01 00:00:00 Zch_Stampfenbachs~ CO_max_min~ d1       mg/m3  0.966</span>
<span class="co">#&gt;  6 2013-01-01 00:00:00 Zch_Stampfenbachs~ CO_min_min~ d1       mg/m3  0.190</span>
<span class="co">#&gt;  7 2013-01-01 00:00:00 Zch_Stampfenbachs~ CO_nb_min30 d1       1     48    </span>
<span class="co">#&gt;  8 2013-01-01 00:00:00 Zch_Stampfenbachs~ Hr          d1       %Hr   76.0  </span>
<span class="co">#&gt;  9 2013-01-01 00:00:00 Zch_Stampfenbachs~ Hr          h1       %Hr   82.9  </span>
<span class="co">#&gt; 10 2013-01-01 00:00:00 Zch_Stampfenbachs~ Hr_max_min~ d1       %Hr   88.4  </span>
<span class="co">#&gt; # ... with 16,276 more rows</span></code></pre></div>
</div>
</div>
<div id="einlesefunktionen-von-daten" class="section level1">
<h1 class="hasAnchor">
<a href="#einlesefunktionen-von-daten" class="anchor"></a>Einlesefunktionen von Daten</h1>
<p>Um Daten in R einzulesen exisitieren für folgende Quellen bereits Funktionen:</p>
<ul>
<li>Ostluft: <code><a href="../../reference/read_airmo_csv.html">read_airmo_csv()</a></code> und <code><a href="../../reference/read_airmo_dat.html">read_airmo_dat()</a></code> für Exporte aus der AIRMO</li>
<li>MeteoSchweiz: <code><a href="../../reference/read_smn.html">read_smn()</a></code> und <code><a href="../../reference/read_smn_multiple.html">read_smn_multiple()</a></code> für SwissMetNet Exporte</li>
<li>ETHZ/IAC: <code><a href="../../reference/read_ethz_iac.html">read_ethz_iac()</a></code> Meteo Stationen auf dem Hönggerberg und dem Hauptgebäude CHN</li>
</ul>
<p>Existiert für die vorliegenden Daten keine Funktion und man möchte die selber schreiben an dieser Stelle einige Hinweise und Tipps.</p>
<div id="verwende-readr-funktionen-und-definiere-die-zeichenkodierung" class="section level2">
<h2 class="hasAnchor">
<a href="#verwende-readr-funktionen-und-definiere-die-zeichenkodierung" class="anchor"></a>Verwende readr Funktionen und definiere die Zeichenkodierung</h2>
<p>Ein generelles Problem beim einlesen von Textdateien ist die <a href="https://de.wikipedia.org/wiki/Zeichenkodierung">Zeichenkodierung</a>. Die meisten haben vermutlich “�” schon in Texten gesehen. Alle Daten im aqmet Store und alle Rückgabewerte von <code>read_xxx()</code> Funktionen sind UTF-8 kodiert. Mit dem <a href="https://readr.tidyverse.org/index.html">readr Packages</a> wird bei korrekter Definition der <a href="https://readr.tidyverse.org/articles/locales.html#character">Locale</a> der Text automatisch zu UTF-8 konvertiert. Im Gegensatz zu den R Base Funktionen oder data.table::fread().</p>
</div>
<div id="ausgabeformat-rolf" class="section level2">
<h2 class="hasAnchor">
<a href="#ausgabeformat-rolf" class="anchor"></a>Ausgabeformat rolf</h2>
<p>Für ein reibungsloses Zusammenspiel mit den Stores zu garantieren muss das Format rolf eingehalten werden. rolf setzt einen tibble mit folgenden Spalten und Klassen voraus:</p>
<table class="table">
<thead><tr class="header">
<th>Spalte</th>
<th>Klasse</th>
</tr></thead>
<tbody>
<tr class="odd">
<td><strong>“starttime”</strong></td>
<td>POSIXct</td>
</tr>
<tr class="even">
<td><strong>“site”</strong></td>
<td>factor</td>
</tr>
<tr class="odd">
<td><strong>“parameter”</strong></td>
<td>factor</td>
</tr>
<tr class="even">
<td><strong>“interval”</strong></td>
<td>factor</td>
</tr>
<tr class="odd">
<td><strong>“unit”</strong></td>
<td>factor</td>
</tr>
<tr class="even">
<td><strong>“value”</strong></td>
<td>double</td>
</tr>
</tbody>
</table>
<p>Selbst wenn in der Datei keine Einheiten enthalten sind, ist es besser die Spalte unit mit NA zu initialisieren. Ein weiterer Trick ist es die Spalten am Ende explizit zu selektionieren. Hier ein Beispiel, wie es in <code><a href="../../reference/read_smn.html">read_smn()</a></code> gelöst ist:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">data &lt;-<span class="st"> </span>dplyr<span class="op">::</span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(data,
  <span class="dt">stn =</span> forcats<span class="op">::</span><span class="kw"><a href="https://forcats.tidyverse.org/reference/as_factor.html">as_factor</a></span>(.data<span class="op">$</span>stn),
  <span class="dt">parameter =</span> forcats<span class="op">::</span><span class="kw"><a href="https://forcats.tidyverse.org/reference/as_factor.html">as_factor</a></span>(.data<span class="op">$</span>parameter),
  <span class="dt">interval =</span> forcats<span class="op">::</span><span class="kw"><a href="https://forcats.tidyverse.org/reference/as_factor.html">as_factor</a></span>(interval),
  <span class="dt">unit =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/factor">factor</a></span>(<span class="ot">NA</span>)
)
dplyr<span class="op">::</span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(data, <span class="dt">starttime =</span> <span class="st">"time"</span>, <span class="dt">site =</span> <span class="st">"stn"</span>, <span class="st">"parameter"</span>, <span class="st">"interval"</span>, <span class="st">"unit"</span>, <span class="st">"value"</span>)</code></pre></div>
<p>Mit dem <code><a href="https://dplyr.tidyverse.org/reference/select.html">dplyr::select</a></code> am Ende ist man sicher nur die Spalten in der Rückgabe zu haben die man haben will und es ist einfach noch Spalten umzubenennen und die Reihenfolge zu ändern.</p>
</div>
</div>
<div id="zusammenfugen-von-daten-im-rolf-format" class="section level1">
<h1 class="hasAnchor">
<a href="#zusammenfugen-von-daten-im-rolf-format" class="anchor"></a>Zusammenfügen von Daten im rolf Format</h1>
<p>Die Verwendung von Factoren im rolf Format hat seine Vor- und Nachteile. Der Hauptvorteil liegt bei schnelleren Lese- und Schreiboperation, der grösste Nachteil beim Zusammenfügen der Daten. <code><a href="https://dplyr.tidyverse.org/reference/bind.html">dplyr::bind_rows</a></code> wird die Factoren in Characters umwandeln, wenn unterschiedliche Levels in den Daten vorhanden sind. Die Funktion <code><a href="../../reference/bind_rows_with_factor_columns.html">bind_rows_with_factor_columns()</a></code> führt das Zusammenfügen korrekt aus. Sie unterstützt ausserdem <a href="https://rlang.r-lib.org/reference/quasiquotation.html">Quasiquotation</a> von rlang<a href="#fn1" class="footnoteRef" id="fnref1"><sup>1</sup></a>. Somit kann auch eine grosse Liste von tibbles im rolf Format komfortable aneinander gefügt werden:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">df1 &lt;-<span class="st"> </span><span class="kw"><a href="../../reference/read_airmo_csv.html">read_airmo_csv</a></span>(fs<span class="op">::</span><span class="kw"><a href="http://fs.r-lib.org/reference/path.html">path</a></span>(examples_path, <span class="st">"Zch_Stampfenbachstrasse_h1_2013_Jan.csv"</span>))
df2 &lt;-<span class="st"> </span><span class="kw"><a href="../../reference/read_airmo_csv.html">read_airmo_csv</a></span>(fs<span class="op">::</span><span class="kw"><a href="http://fs.r-lib.org/reference/path.html">path</a></span>(examples_path, <span class="st">"Zch_Stampfenbachstrasse_d1_2013_Jan.csv"</span>))
df_comb &lt;-<span class="st"> </span><span class="kw"><a href="../../reference/bind_rows_with_factor_columns.html">bind_rows_with_factor_columns</a></span>(df1, df2)
df_comb <span class="op">%&gt;%</span><span class="st"> </span>dplyr<span class="op">::</span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span>(.data<span class="op">$</span>starttime, .data<span class="op">$</span>parameter)
<span class="co">#&gt; # A tibble: 16,286 x 6</span>
<span class="co">#&gt;    starttime           site                 parameter interval unit   value</span>
<span class="co">#&gt;    &lt;dttm&gt;              &lt;fct&gt;                &lt;fct&gt;     &lt;fct&gt;    &lt;fct&gt;  &lt;dbl&gt;</span>
<span class="co">#&gt;  1 2013-01-01 00:00:00 Zch_Stampfenbachstr~ CO        h1       mg/m3  0.805</span>
<span class="co">#&gt;  2 2013-01-01 00:00:00 Zch_Stampfenbachstr~ CO        h1       ppm    0.692</span>
<span class="co">#&gt;  3 2013-01-01 00:00:00 Zch_Stampfenbachstr~ CO        d1       mg/m3  0.381</span>
<span class="co">#&gt;  4 2013-01-01 00:00:00 Zch_Stampfenbachstr~ CO        d1       ppm    0.327</span>
<span class="co">#&gt;  5 2013-01-01 00:00:00 Zch_Stampfenbachstr~ Hr        h1       %Hr   82.9  </span>
<span class="co">#&gt;  6 2013-01-01 00:00:00 Zch_Stampfenbachstr~ Hr        d1       %Hr   76.0  </span>
<span class="co">#&gt;  7 2013-01-01 00:00:00 Zch_Stampfenbachstr~ NO        h1       µg/m3 80.5  </span>
<span class="co">#&gt;  8 2013-01-01 00:00:00 Zch_Stampfenbachstr~ NO        h1       ppb   64.6  </span>
<span class="co">#&gt;  9 2013-01-01 00:00:00 Zch_Stampfenbachstr~ NO        d1       µg/m3 17.6  </span>
<span class="co">#&gt; 10 2013-01-01 00:00:00 Zch_Stampfenbachstr~ NO        d1       ppb   14.1  </span>
<span class="co">#&gt; # ... with 16,276 more rows</span>

<span class="co"># liste mit 20+ tibbles</span>
df_list &lt;-<span class="st"> </span><span class="kw"><a href="../../reference/read_smn_multiple.html">read_smn_multiple</a></span>(fs<span class="op">::</span><span class="kw"><a href="http://fs.r-lib.org/reference/path.html">path</a></span>(examples_path, <span class="st">"smn_multi.txt"</span>), <span class="dt">as_list =</span> <span class="ot">TRUE</span>)
<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/length">length</a></span>(df_list)
<span class="co">#&gt; [1] 26</span>
df_comb &lt;-<span class="st"> </span><span class="kw"><a href="../../reference/bind_rows_with_factor_columns.html">bind_rows_with_factor_columns</a></span>(<span class="op">!!!</span>df_list)
df_comb <span class="op">%&gt;%</span><span class="st"> </span>dplyr<span class="op">::</span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span>(.data<span class="op">$</span>starttime, .data<span class="op">$</span>parameter)
<span class="co">#&gt; # A tibble: 1,070 x 6</span>
<span class="co">#&gt;    starttime           site  parameter interval unit  value</span>
<span class="co">#&gt;    &lt;dttm&gt;              &lt;fct&gt; &lt;fct&gt;     &lt;fct&gt;    &lt;fct&gt; &lt;dbl&gt;</span>
<span class="co">#&gt;  1 2010-01-01 00:00:00 KLO   dkl010b0  h1       &lt;NA&gt;  319  </span>
<span class="co">#&gt;  2 2010-01-01 00:00:00 KLO   fkl010b0  h1       &lt;NA&gt;    1.5</span>
<span class="co">#&gt;  3 2010-01-01 00:00:00 KLO   gre000b0  h1       &lt;NA&gt;    0  </span>
<span class="co">#&gt;  4 2010-01-01 00:00:00 KLO   tre200b0  h1       &lt;NA&gt;    2.3</span>
<span class="co">#&gt;  5 2010-01-01 00:00:00 UEB   dk1towb0  h1       &lt;NA&gt;  249  </span>
<span class="co">#&gt;  6 2010-01-01 00:00:00 UEB   fk1towb0  h1       &lt;NA&gt;    1.7</span>
<span class="co">#&gt;  7 2010-01-01 00:00:00 UEB   ta1towb0  h1       &lt;NA&gt;    3.7</span>
<span class="co">#&gt;  8 2010-01-01 01:00:00 KLO   dkl010b0  h1       &lt;NA&gt;  317  </span>
<span class="co">#&gt;  9 2010-01-01 01:00:00 KLO   fkl010b0  h1       &lt;NA&gt;    1.7</span>
<span class="co">#&gt; 10 2010-01-01 01:00:00 KLO   gre000b0  h1       &lt;NA&gt;    0  </span>
<span class="co">#&gt; # ... with 1,060 more rows</span></code></pre></div>
<p><code><a href="../../reference/bind_rows_with_factor_columns.html">bind_rows_with_factor_columns()</a></code> entfernt jedoch keine Duplikate aus den Daten. Es hängt die Daten einfach aneinander. Möchte man Duplikate entfernen, bzw. Daten aktualisieren mit neueren Daten muss man die Funktion <code>$merge()</code> des Format Objekts benützen. Dieses wurde beim Erzeugen des Store direkt initialisiert und ist als Feld <code>$format</code> verfügbar. Alternativ kann ein seperates Format Objekt erzeugt werden. Die Daten im ersten Datenframe werden über Daten im zweiten Datenframe priorisiert.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># kopiere Daten und setze einige NA -&gt; Resultat sollte NA enthalten</span>
df1 &lt;-<span class="st"> </span>df2
df1<span class="op">$</span>value[<span class="dv">1</span><span class="op">:</span><span class="dv">150</span>] &lt;-<span class="st"> </span><span class="ot">NA</span>  

df_comb &lt;-<span class="st"> </span>store<span class="op">$</span>format<span class="op">$</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/merge">merge</a></span>(df1, df2)
df_comb <span class="op">%&gt;%</span><span class="st"> </span>dplyr<span class="op">::</span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span>(.data<span class="op">$</span>starttime, .data<span class="op">$</span>parameter)
<span class="co">#&gt; # A tibble: 2,170 x 6</span>
<span class="co">#&gt;    starttime           site                parameter   interval unit  value</span>
<span class="co">#&gt;    &lt;dttm&gt;              &lt;fct&gt;               &lt;fct&gt;       &lt;fct&gt;    &lt;fct&gt; &lt;dbl&gt;</span>
<span class="co">#&gt;  1 2013-01-01 00:00:00 Zch_Stampfenbachst~ CO          d1       mg/m3  NA  </span>
<span class="co">#&gt;  2 2013-01-01 00:00:00 Zch_Stampfenbachst~ CO          d1       ppm    NA  </span>
<span class="co">#&gt;  3 2013-01-01 00:00:00 Zch_Stampfenbachst~ CO_max_min~ d1       mg/m3  NA  </span>
<span class="co">#&gt;  4 2013-01-01 00:00:00 Zch_Stampfenbachst~ CO_min_min~ d1       mg/m3  NA  </span>
<span class="co">#&gt;  5 2013-01-01 00:00:00 Zch_Stampfenbachst~ CO_nb_min30 d1       1      NA  </span>
<span class="co">#&gt;  6 2013-01-01 00:00:00 Zch_Stampfenbachst~ Hr          d1       %Hr    76.0</span>
<span class="co">#&gt;  7 2013-01-01 00:00:00 Zch_Stampfenbachst~ Hr_max_min~ d1       %Hr    88.4</span>
<span class="co">#&gt;  8 2013-01-01 00:00:00 Zch_Stampfenbachst~ Hr_min_min~ d1       %Hr    50.3</span>
<span class="co">#&gt;  9 2013-01-01 00:00:00 Zch_Stampfenbachst~ Hr_nb_min30 d1       1      48  </span>
<span class="co">#&gt; 10 2013-01-01 00:00:00 Zch_Stampfenbachst~ NO          d1       µg/m3  17.6</span>
<span class="co">#&gt; # ... with 2,160 more rows</span>

rolf &lt;-<span class="st"> </span><span class="kw"><a href="../../reference/format_rolf.html">format_rolf</a></span>()
df_comb &lt;-<span class="st"> </span>rolf<span class="op">$</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/merge">merge</a></span>(df1, df2)
df_comb <span class="op">%&gt;%</span><span class="st"> </span>dplyr<span class="op">::</span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span>(.data<span class="op">$</span>starttime, .data<span class="op">$</span>parameter)
<span class="co">#&gt; # A tibble: 2,170 x 6</span>
<span class="co">#&gt;    starttime           site                parameter   interval unit  value</span>
<span class="co">#&gt;    &lt;dttm&gt;              &lt;fct&gt;               &lt;fct&gt;       &lt;fct&gt;    &lt;fct&gt; &lt;dbl&gt;</span>
<span class="co">#&gt;  1 2013-01-01 00:00:00 Zch_Stampfenbachst~ CO          d1       mg/m3  NA  </span>
<span class="co">#&gt;  2 2013-01-01 00:00:00 Zch_Stampfenbachst~ CO          d1       ppm    NA  </span>
<span class="co">#&gt;  3 2013-01-01 00:00:00 Zch_Stampfenbachst~ CO_max_min~ d1       mg/m3  NA  </span>
<span class="co">#&gt;  4 2013-01-01 00:00:00 Zch_Stampfenbachst~ CO_min_min~ d1       mg/m3  NA  </span>
<span class="co">#&gt;  5 2013-01-01 00:00:00 Zch_Stampfenbachst~ CO_nb_min30 d1       1      NA  </span>
<span class="co">#&gt;  6 2013-01-01 00:00:00 Zch_Stampfenbachst~ Hr          d1       %Hr    76.0</span>
<span class="co">#&gt;  7 2013-01-01 00:00:00 Zch_Stampfenbachst~ Hr_max_min~ d1       %Hr    88.4</span>
<span class="co">#&gt;  8 2013-01-01 00:00:00 Zch_Stampfenbachst~ Hr_min_min~ d1       %Hr    50.3</span>
<span class="co">#&gt;  9 2013-01-01 00:00:00 Zch_Stampfenbachst~ Hr_nb_min30 d1       1      48  </span>
<span class="co">#&gt; 10 2013-01-01 00:00:00 Zch_Stampfenbachst~ NO          d1       µg/m3  17.6</span>
<span class="co">#&gt; # ... with 2,160 more rows</span></code></pre></div>
<p>Die <code>$merge()</code> Funktion unterstützt nur 2 Argumente. Muss eine Liste von tibbles gemerget werden muss man <code><a href="https://purrr.tidyverse.org/reference/reduce.html">purrr::reduce()</a></code> benützen. Mit Hilfe des Argument <code>.dir</code> kann man die Priosierung setzen. Mit “forward”" haben die Daten die zuerst in der Liste auftauchen Priorität, mit “backward” die Letzten.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">df_comb &lt;-<span class="st"> </span>purrr<span class="op">::</span><span class="kw"><a href="https://purrr.tidyverse.org/reference/reduce.html">reduce</a></span>(df_list, rolf<span class="op">$</span>merge, <span class="dt">.dir =</span> <span class="st">"forward"</span>)
df_comb <span class="op">%&gt;%</span><span class="st"> </span>dplyr<span class="op">::</span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span>(.data<span class="op">$</span>starttime, .data<span class="op">$</span>parameter)
<span class="co">#&gt; # A tibble: 1,070 x 6</span>
<span class="co">#&gt;    starttime           site  parameter interval unit  value</span>
<span class="co">#&gt;    &lt;dttm&gt;              &lt;fct&gt; &lt;fct&gt;     &lt;fct&gt;    &lt;fct&gt; &lt;dbl&gt;</span>
<span class="co">#&gt;  1 2010-01-01 00:00:00 KLO   dkl010b0  h1       &lt;NA&gt;  319  </span>
<span class="co">#&gt;  2 2010-01-01 00:00:00 KLO   fkl010b0  h1       &lt;NA&gt;    1.5</span>
<span class="co">#&gt;  3 2010-01-01 00:00:00 KLO   gre000b0  h1       &lt;NA&gt;    0  </span>
<span class="co">#&gt;  4 2010-01-01 00:00:00 KLO   tre200b0  h1       &lt;NA&gt;    2.3</span>
<span class="co">#&gt;  5 2010-01-01 00:00:00 UEB   dk1towb0  h1       &lt;NA&gt;  249  </span>
<span class="co">#&gt;  6 2010-01-01 00:00:00 UEB   fk1towb0  h1       &lt;NA&gt;    1.7</span>
<span class="co">#&gt;  7 2010-01-01 00:00:00 UEB   ta1towb0  h1       &lt;NA&gt;    3.7</span>
<span class="co">#&gt;  8 2010-01-01 01:00:00 KLO   dkl010b0  h1       &lt;NA&gt;  317  </span>
<span class="co">#&gt;  9 2010-01-01 01:00:00 KLO   fkl010b0  h1       &lt;NA&gt;    1.7</span>
<span class="co">#&gt; 10 2010-01-01 01:00:00 KLO   gre000b0  h1       &lt;NA&gt;    0  </span>
<span class="co">#&gt; # ... with 1,060 more rows</span></code></pre></div>
</div>
<div id="metadaten" class="section level1">
<h1 class="hasAnchor">
<a href="#metadaten" class="anchor"></a>Metadaten</h1>
<p>Daten aus verschiedenen Quellen werden verschiedene Schemen für die Vergabe von Namen haben. MeteoSchweiz zum Beispiel kodiert im Parameter Namen gleichzeitig das Mittelungsinterval:</p>
<table class="table">
<thead><tr class="header">
<th>Parameter</th>
<th>Interval</th>
<th>Messgrösse</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>ta1towb0</td>
<td>Bürgerliche Stundenmittel</td>
<td>Lufttemperatur, Instrument 1</td>
</tr>
<tr class="even">
<td>ta1towh0</td>
<td>Stundenmittel</td>
<td>Lufttemperatur, Instrument 1</td>
</tr>
<tr class="odd">
<td>ta1tows0</td>
<td>Momentanwerte</td>
<td>Lufttemperatur, Instrument 1</td>
</tr>
<tr class="even">
<td>fk1towz0</td>
<td>Zehnminutenmittel</td>
<td>Windgeschwindigkeit skalar, Instrument 1</td>
</tr>
</tbody>
</table>
<p>Um die Bezeichnungen zu normalisieren kommt es zu einem Zusammenspiel von im Store bereitgestellte Daten und der Funktion <code><a href="../../reference/meta_apply.html">meta_apply()</a></code>. Das Store Objekt verfügt über die Funktion <code>$get_meta()</code>, welche im AWS S3 bereitgestellte Metadaten zurück gibt. Wird <code>$get_meta()</code> ohne Argument aufgerufen erhält man eine Liste mit sämtlichen Metadaten im Store. Kennt man bereits den Namen kann man direkt die entsprechenden Metadaten holen:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">meta &lt;-<span class="st"> </span>store<span class="op">$</span><span class="kw">get_meta</span>()
<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/names">names</a></span>(meta)
<span class="co">#&gt; [1] "all"          "ecmwf"        "ethz"         "hysplit"     </span>
<span class="co">#&gt; [5] "meteoschweiz" "meteotest"    "nabel"        "ostluft"</span>

meteoschweiz &lt;-<span class="st"> </span>store<span class="op">$</span><span class="kw">get_meta</span>(<span class="st">"meteoschweiz"</span>)
tibble<span class="op">::</span><span class="kw"><a href="https://tibble.tidyverse.org/reference/glimpse.html">glimpse</a></span>(meteoschweiz)
<span class="co">#&gt; List of 1</span>
<span class="co">#&gt;  $ meteoschweiz:Classes 'tbl_df', 'tbl' and 'data.frame':    261 obs. of  15 variables:</span>
<span class="co">#&gt;   ..$ site_short        : chr [1:261] "TAE" "TAE" "TAE" "TAE" ...</span>
<span class="co">#&gt;   ..$ site              : chr [1:261] "Aadorf/Tänikon" "Aadorf/Tänikon" "Aadorf/Tänikon" "Aadorf/Tänikon" ...</span>
<span class="co">#&gt;   ..$ Länge             : chr [1:261] "8°54'" "8°54'" "8°54'" "8°54'" ...</span>
<span class="co">#&gt;   ..$ Breite            : chr [1:261] "47°29'" "47°29'" "47°29'" "47°29'" ...</span>
<span class="co">#&gt;   ..$ x                 : num [1:261] 2710517 2710517 2710517 2710517 2710517 ...</span>
<span class="co">#&gt;   ..$ y                 : num [1:261] 1259824 1259824 1259824 1259824 1259824 ...</span>
<span class="co">#&gt;   ..$ masl              : num [1:261] 539 539 539 539 539 539 539 539 539 539 ...</span>
<span class="co">#&gt;   ..$ parameter_original: chr [1:261] "tre200s0" "ure200s0" "prestas0" "prestas0" ...</span>
<span class="co">#&gt;   ..$ source            : chr [1:261] "MeteoSchweiz" "MeteoSchweiz" "MeteoSchweiz" "MeteoSchweiz" ...</span>
<span class="co">#&gt;   ..$ unit              : chr [1:261] "°C" "%" "hPa" "hPa" ...</span>
<span class="co">#&gt;   ..$ Beschreibung      : chr [1:261] "Lufttemperatur" "Relative" "Luftdruck" "Luftdruck" ...</span>
<span class="co">#&gt;   ..$ timezone_original : chr [1:261] "UTC" "UTC" "UTC" "UTC" ...</span>
<span class="co">#&gt;   ..$ site_long         : logi [1:261] NA NA NA NA NA NA ...</span>
<span class="co">#&gt;   ..$ interval          : chr [1:261] "min10" "min10" "min10" "min10" ...</span>
<span class="co">#&gt;   ..$ parameter         : chr [1:261] "T" "Hr" "p" "p" ...</span></code></pre></div>
<p>Die <code><a href="../../reference/meta_apply.html">meta_apply()</a></code> benützt die Metadaten als “Lookup Table”. Es wird folgende Operation ausgeführt:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../../reference/meta_apply.html">meta_apply</a></span>(data, meta, data_src, data_dest, meta_key, meta_val) 

data<span class="op">$</span>data_dest =<span class="st"> </span>meta[meta<span class="op">$</span>meta_key <span class="op">==</span><span class="st"> </span>data<span class="op">$</span>data_src]<span class="op">$</span>meta_val</code></pre></div>
<p>Wobei die jeweiligen Spalten jeweils als Argument übergeben werden. Die Funktion verfügt über verschiende Modi um mit fehlenden Einträgen umzugehen. Im folgenden Beispiel werden bei den MeteoSchweiz Daten die “unit” Spalte basierend auf den “parameter” Spalte ausgefüllt. Da die Parameter noch die MeteoSchweiz Bezeichnungen haben müssen wir als Meta Key die Spalte “parameter_original” und “unit” als Value verwenden. Es werden die Daten aus rOstluft.data verwendet. In diesen fehlt in den Metadaten der MeteoSchweiz Parameter rre150z0 (Niederschlag). Der Default Modus “strict” stoppt das Script:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">meteoschweiz &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/readRDS">readRDS</a></span>(fs<span class="op">::</span><span class="kw"><a href="http://fs.r-lib.org/reference/path.html">path</a></span>(examples_path, <span class="st">"meta_smn.rds"</span>))
data &lt;-<span class="st"> </span><span class="kw"><a href="../../reference/read_smn.html">read_smn</a></span>(fs<span class="op">::</span><span class="kw"><a href="http://fs.r-lib.org/reference/path.html">path</a></span>(examples_path, <span class="st">"smn.txt"</span>), <span class="dt">na.rm =</span> <span class="ot">FALSE</span>)
data &lt;-<span class="st"> </span>dplyr<span class="op">::</span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span>(data, .data<span class="op">$</span>starttime, .data<span class="op">$</span>parameter) 
data
<span class="co">#&gt; # A tibble: 60 x 6</span>
<span class="co">#&gt;    starttime           site  parameter interval unit  value</span>
<span class="co">#&gt;    &lt;dttm&gt;              &lt;fct&gt; &lt;fct&gt;     &lt;fct&gt;    &lt;fct&gt; &lt;dbl&gt;</span>
<span class="co">#&gt;  1 2018-01-01 00:50:00 CHU   dkl010z0  min10    &lt;NA&gt;  216  </span>
<span class="co">#&gt;  2 2018-01-01 00:50:00 CHU   fkl010z0  min10    &lt;NA&gt;    1.7</span>
<span class="co">#&gt;  3 2018-01-01 00:50:00 CHU   fkl010z1  min10    &lt;NA&gt;    3  </span>
<span class="co">#&gt;  4 2018-01-01 00:50:00 CHU   gre000z0  min10    &lt;NA&gt;    5  </span>
<span class="co">#&gt;  5 2018-01-01 00:50:00 CHU   hto000s0  min10    &lt;NA&gt;   NA  </span>
<span class="co">#&gt;  6 2018-01-01 00:50:00 CHU   prestas0  min10    &lt;NA&gt;  946. </span>
<span class="co">#&gt;  7 2018-01-01 00:50:00 CHU   rre150z0  min10    &lt;NA&gt;    0  </span>
<span class="co">#&gt;  8 2018-01-01 00:50:00 CHU   sre000z0  min10    &lt;NA&gt;    0  </span>
<span class="co">#&gt;  9 2018-01-01 00:50:00 CHU   tre200s0  min10    &lt;NA&gt;    2.3</span>
<span class="co">#&gt; 10 2018-01-01 00:50:00 CHU   ure200s0  min10    &lt;NA&gt;   82.7</span>
<span class="co">#&gt; # ... with 50 more rows</span>

<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/conditions">tryCatch</a></span>({
  <span class="kw"><a href="../../reference/meta_apply.html">meta_apply</a></span>(data, meteoschweiz, <span class="st">"parameter"</span>, <span class="st">"unit"</span>, <span class="st">"parameter_original"</span>, <span class="st">"unit"</span>)
}, <span class="dt">error =</span> <span class="cf">function</span>(e) {
  <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/sprintf">sprintf</a></span>(e<span class="op">$</span>message)
})
<span class="co">#&gt; [1] "apply meta data$unit = meta[meta$parameter_original == data$parameter]$unit:\n  missing keys in meta$parameter_original: rre150z0"</span></code></pre></div>
<p>Im einfachsten Fall werden Zeilen mit fehlenden Einträge einfach gelöscht. Dies geschieht mit dem Modus “drop”:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">
df &lt;-<span class="st"> </span><span class="kw"><a href="../../reference/meta_apply.html">meta_apply</a></span>(data, meteoschweiz, <span class="st">"parameter"</span>, <span class="st">"unit"</span>, <span class="st">"parameter_original"</span>, <span class="st">"unit"</span>, <span class="dt">mode =</span> <span class="st">"drop"</span>)
<span class="co">#&gt; Warning in meta_apply(data, meteoschweiz, "parameter", "unit", "parameter_original", : apply meta data$unit = meta[meta$parameter_original == data$parameter]$unit:</span>
<span class="co">#&gt;   missing keys in meta$parameter_original: rre150z0</span>
<span class="co">#&gt;   dropping missing prameters</span>
df
<span class="co">#&gt; # A tibble: 54 x 6</span>
<span class="co">#&gt;    starttime           site  parameter interval unit  value</span>
<span class="co">#&gt;    &lt;dttm&gt;              &lt;fct&gt; &lt;fct&gt;     &lt;fct&gt;    &lt;fct&gt; &lt;dbl&gt;</span>
<span class="co">#&gt;  1 2018-01-01 00:50:00 CHU   dkl010z0  min10    °     216  </span>
<span class="co">#&gt;  2 2018-01-01 00:50:00 CHU   fkl010z0  min10    m/s     1.7</span>
<span class="co">#&gt;  3 2018-01-01 00:50:00 CHU   fkl010z1  min10    m/s     3  </span>
<span class="co">#&gt;  4 2018-01-01 00:50:00 CHU   gre000z0  min10    W/m2    5  </span>
<span class="co">#&gt;  5 2018-01-01 00:50:00 CHU   hto000s0  min10    cm     NA  </span>
<span class="co">#&gt;  6 2018-01-01 00:50:00 CHU   prestas0  min10    hPa   946. </span>
<span class="co">#&gt;  7 2018-01-01 00:50:00 CHU   sre000z0  min10    min     0  </span>
<span class="co">#&gt;  8 2018-01-01 00:50:00 CHU   tre200s0  min10    °C      2.3</span>
<span class="co">#&gt;  9 2018-01-01 00:50:00 CHU   ure200s0  min10    %      82.7</span>
<span class="co">#&gt; 10 2018-01-01 01:00:00 CHU   dkl010z0  min10    °     209  </span>
<span class="co">#&gt; # ... with 44 more rows</span></code></pre></div>
<p>Sollte der Parameter für spätere Bearbeitung behalten werden, kommt der Modus “keep” zum Zug:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">df &lt;-<span class="st"> </span><span class="kw"><a href="../../reference/meta_apply.html">meta_apply</a></span>(data, meteoschweiz, <span class="st">"parameter"</span>, <span class="st">"unit"</span>, <span class="st">"parameter_original"</span>, <span class="st">"unit"</span>, <span class="dt">mode =</span> <span class="st">"keep"</span>)
<span class="co">#&gt; Warning in meta_apply(data, meteoschweiz, "parameter", "unit", "parameter_original", : apply meta data$unit = meta[meta$parameter_original == data$parameter]$unit:</span>
<span class="co">#&gt;   missing keys in meta$parameter_original: rre150z0</span>
<span class="co">#&gt;   keeping values: NA</span>
df
<span class="co">#&gt; # A tibble: 60 x 6</span>
<span class="co">#&gt;    starttime           site  parameter interval unit  value</span>
<span class="co">#&gt;    &lt;dttm&gt;              &lt;fct&gt; &lt;fct&gt;     &lt;fct&gt;    &lt;fct&gt; &lt;dbl&gt;</span>
<span class="co">#&gt;  1 2018-01-01 00:50:00 CHU   dkl010z0  min10    °     216  </span>
<span class="co">#&gt;  2 2018-01-01 00:50:00 CHU   fkl010z0  min10    m/s     1.7</span>
<span class="co">#&gt;  3 2018-01-01 00:50:00 CHU   fkl010z1  min10    m/s     3  </span>
<span class="co">#&gt;  4 2018-01-01 00:50:00 CHU   gre000z0  min10    W/m2    5  </span>
<span class="co">#&gt;  5 2018-01-01 00:50:00 CHU   hto000s0  min10    cm     NA  </span>
<span class="co">#&gt;  6 2018-01-01 00:50:00 CHU   prestas0  min10    hPa   946. </span>
<span class="co">#&gt;  7 2018-01-01 00:50:00 CHU   rre150z0  min10    &lt;NA&gt;    0  </span>
<span class="co">#&gt;  8 2018-01-01 00:50:00 CHU   sre000z0  min10    min     0  </span>
<span class="co">#&gt;  9 2018-01-01 00:50:00 CHU   tre200s0  min10    °C      2.3</span>
<span class="co">#&gt; 10 2018-01-01 00:50:00 CHU   ure200s0  min10    %      82.7</span>
<span class="co">#&gt; # ... with 50 more rows</span></code></pre></div>
<p>Mit Hilfe des Modus “replace” kann eine zusätzliche “Lookup Table” übergeben werden. Werte in dieser Tabelle haben Priorität über Werte in der Meta Tabelle. Im Beispiel wird die fehlende Einheit für rre150z0 bereit gestellt und die Einheit für dkl010z0 von ° zu deg überschrieben.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">df &lt;-<span class="st"> </span><span class="kw"><a href="../../reference/meta_apply.html">meta_apply</a></span>(data, meteoschweiz, <span class="st">"parameter"</span>, <span class="st">"unit"</span>, <span class="st">"parameter_original"</span>, <span class="st">"unit"</span>, 
                 <span class="dt">mode =</span> <span class="st">"replace"</span>, <span class="dt">replacements =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(<span class="dt">rre150z0 =</span> <span class="st">"mm"</span>, <span class="dt">dkl010z0 =</span> <span class="st">"deg"</span>))
<span class="co">#&gt; apply meta data$unit = meta[meta$parameter_original == data$parameter]$unit:</span>
<span class="co">#&gt;   missing keys in meta$parameter_original: rre150z0</span>
<span class="co">#&gt;   replacements used: dkl010z0, rre150z0</span>
df
<span class="co">#&gt; # A tibble: 60 x 6</span>
<span class="co">#&gt;    starttime           site  parameter interval unit  value</span>
<span class="co">#&gt;    &lt;dttm&gt;              &lt;fct&gt; &lt;fct&gt;     &lt;fct&gt;    &lt;fct&gt; &lt;dbl&gt;</span>
<span class="co">#&gt;  1 2018-01-01 00:50:00 CHU   dkl010z0  min10    deg   216  </span>
<span class="co">#&gt;  2 2018-01-01 00:50:00 CHU   fkl010z0  min10    m/s     1.7</span>
<span class="co">#&gt;  3 2018-01-01 00:50:00 CHU   fkl010z1  min10    m/s     3  </span>
<span class="co">#&gt;  4 2018-01-01 00:50:00 CHU   gre000z0  min10    W/m2    5  </span>
<span class="co">#&gt;  5 2018-01-01 00:50:00 CHU   hto000s0  min10    cm     NA  </span>
<span class="co">#&gt;  6 2018-01-01 00:50:00 CHU   prestas0  min10    hPa   946. </span>
<span class="co">#&gt;  7 2018-01-01 00:50:00 CHU   rre150z0  min10    mm      0  </span>
<span class="co">#&gt;  8 2018-01-01 00:50:00 CHU   sre000z0  min10    min     0  </span>
<span class="co">#&gt;  9 2018-01-01 00:50:00 CHU   tre200s0  min10    °C      2.3</span>
<span class="co">#&gt; 10 2018-01-01 00:50:00 CHU   ure200s0  min10    %      82.7</span>
<span class="co">#&gt; # ... with 50 more rows</span></code></pre></div>
<p>Hier ein Beispiel für die komplette Überführung der MeteoSchweiz Daten, inkl. manuelle Umbennung von rre150z0 und Änderung der Einheit für die Windrichtung (WD) von ° zu deg:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">df &lt;-<span class="st"> </span><span class="kw"><a href="../../reference/meta_apply.html">meta_apply</a></span>(data, meteoschweiz, <span class="st">"parameter"</span>, <span class="st">"unit"</span>, <span class="st">"parameter_original"</span>, <span class="st">"unit"</span>, 
                 <span class="dt">mode =</span> <span class="st">"replace"</span>, <span class="dt">replacements =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(<span class="dt">rre150z0 =</span> <span class="st">"mm"</span>, <span class="dt">dkl010z0 =</span> <span class="st">"deg"</span>))
<span class="co">#&gt; apply meta data$unit = meta[meta$parameter_original == data$parameter]$unit:</span>
<span class="co">#&gt;   missing keys in meta$parameter_original: rre150z0</span>
<span class="co">#&gt;   replacements used: dkl010z0, rre150z0</span>

df &lt;-<span class="st"> </span><span class="kw"><a href="../../reference/meta_apply.html">meta_apply</a></span>(df, meteoschweiz, <span class="st">"parameter"</span>, <span class="st">"parameter"</span>, <span class="st">"parameter_original"</span>, <span class="st">"parameter"</span>, 
                 <span class="dt">mode =</span> <span class="st">"replace"</span>, <span class="dt">replacements =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(<span class="dt">rre150z0 =</span> <span class="st">"Niederschlag"</span>))
<span class="co">#&gt; apply meta data$parameter = meta[meta$parameter_original == data$parameter]$parameter:</span>
<span class="co">#&gt;   missing keys in meta$parameter_original: rre150z0</span>
<span class="co">#&gt;   replacements used: rre150z0</span>

df &lt;-<span class="st"> </span><span class="kw"><a href="../../reference/meta_apply.html">meta_apply</a></span>(df, meteoschweiz, <span class="st">"site"</span>, <span class="st">"site"</span>, <span class="st">"site_short"</span>, <span class="st">"site"</span>)

df
<span class="co">#&gt; # A tibble: 60 x 6</span>
<span class="co">#&gt;    starttime           site  parameter    interval unit  value</span>
<span class="co">#&gt;    &lt;dttm&gt;              &lt;fct&gt; &lt;fct&gt;        &lt;fct&gt;    &lt;fct&gt; &lt;dbl&gt;</span>
<span class="co">#&gt;  1 2018-01-01 00:50:00 Chur  WD           min10    deg   216  </span>
<span class="co">#&gt;  2 2018-01-01 00:50:00 Chur  WVs          min10    m/s     1.7</span>
<span class="co">#&gt;  3 2018-01-01 00:50:00 Chur  WVs_max      min10    m/s     3  </span>
<span class="co">#&gt;  4 2018-01-01 00:50:00 Chur  StrGlo       min10    W/m2    5  </span>
<span class="co">#&gt;  5 2018-01-01 00:50:00 Chur  SnowDep      min10    cm     NA  </span>
<span class="co">#&gt;  6 2018-01-01 00:50:00 Chur  p            min10    hPa   946. </span>
<span class="co">#&gt;  7 2018-01-01 00:50:00 Chur  Niederschlag min10    mm      0  </span>
<span class="co">#&gt;  8 2018-01-01 00:50:00 Chur  SunDur       min10    min     0  </span>
<span class="co">#&gt;  9 2018-01-01 00:50:00 Chur  T            min10    °C      2.3</span>
<span class="co">#&gt; 10 2018-01-01 00:50:00 Chur  Hr           min10    %      82.7</span>
<span class="co">#&gt; # ... with 50 more rows</span></code></pre></div>
</div>
<div id="openair-kompatibles-wide-format" class="section level1">
<h1 class="hasAnchor">
<a href="#openair-kompatibles-wide-format" class="anchor"></a>openair kompatibles Wide Format</h1>
<p>Das Long Format ist nicht für jede Analyse geeignet. Aus diesem Grund enthält rOstluft die Funktionalität Daten im rolf Format in ein <a href="http://davidcarslaw.github.io/openair/">openair</a> kompatibles Wide Format umzuwandeln. Ein Nachteil am Wide Format ist, dass Informationen die zu einer Spalte gehören, wie die Einheit einer Messgrösse, verloren gehen. Dies führt auch dazu, das man nicht die gleiche Messgrösse mit unterschiedlichen Einheiten in den Daten haben kann. Ausser man nennt die Messgrösse um. Die Funktion <code><a href="../../reference/rolf_to_openair.html">rolf_to_openair()</a></code> geht folgende Kompromisse ein: Die Einheiten werden entfernt, aber im Attribute “units” des Datenframes gespeichert. Messgrössen mit der Einheit ppb oder ppm werden ebenfalls entfernt (Dieser Automatismus lässt sich mit dem Argument keep_ppb abschalten). Openair nimmt an, dass alle Messgrössen als Massenkonzentrationen vorliegen. Weitere Konventionen in openair sind das die Zeitinformation in der Spalte “date” als <code>Date</code> oder <code>POSIXct</code> vorliegen, die Windgeschwindigkeit in der Spalte “ws” und die Windrichtung in der Spalte “wd”. Sämtliche Character und Factor Spalten dienen als Gruppierungsspalten. Diese werden von openair ignoriert oder gar entfernt, wenn nicht das Argument type benützt wird. Dieses erlaubt die explizite Nutzung einer Spalte als Gruppierungskriterium. Es können mehrere Gruppierungskriterien getrennt durch ein Komma definiert werden. Die openair Funktion <code><a href="https://www.rdocumentation.org/packages/openair/topics/cutData">openair::cutData()</a></code> übernimmt die Gruppierung.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">data &lt;-<span class="st"> </span><span class="kw"><a href="../../reference/read_airmo_csv.html">read_airmo_csv</a></span>(fs<span class="op">::</span><span class="kw"><a href="http://fs.r-lib.org/reference/path.html">path</a></span>(examples_path, <span class="st">"Zch_Stampfenbachstrasse_2010-2014.csv"</span>))
wide &lt;-<span class="st"> </span><span class="kw"><a href="../../reference/rolf_to_openair.html">rolf_to_openair</a></span>(data)
tibble<span class="op">::</span><span class="kw"><a href="https://tibble.tidyverse.org/reference/glimpse.html">glimpse</a></span>(wide)
<span class="co">#&gt; Observations: 87,626</span>
<span class="co">#&gt; Variables: 16</span>
<span class="co">#&gt; $ date    &lt;dttm&gt; 2010-01-01 00:00:00, 2010-01-01 00:30:00, 2010-01-01 ...</span>
<span class="co">#&gt; $ site    &lt;fct&gt; Zch_Stampfenbachstrasse, Zch_Stampfenbachstrasse, Zch_...</span>
<span class="co">#&gt; $ CO      &lt;dbl&gt; 0.513, 0.609, 0.822, 1.063, 0.861, 0.760, 0.633, 0.666...</span>
<span class="co">#&gt; $ NO      &lt;dbl&gt; 9.50, 26.85, 59.95, 85.55, 72.04, 49.74, 26.50, 36.18,...</span>
<span class="co">#&gt; $ NO2     &lt;dbl&gt; 37.0, 46.5, 54.6, 60.5, 58.8, 52.9, 49.0, 50.9, 56.3, ...</span>
<span class="co">#&gt; $ NOx     &lt;dbl&gt; 26.9, 45.8, 76.6, 100.2, 88.5, 67.5, 46.9, 55.6, 77.8,...</span>
<span class="co">#&gt; $ O3      &lt;dbl&gt; 11.812, 7.989, 2.111, 1.410, 2.517, 2.416, 3.606, 1.61...</span>
<span class="co">#&gt; $ PM10    &lt;dbl&gt; 49.7, 82.3, 152.9, 169.2, 190.1, 158.9, 93.0, 54.9, 58...</span>
<span class="co">#&gt; $ SO2     &lt;dbl&gt; 2.36, 3.13, 4.19, 4.60, 3.97, 2.71, 2.29, 2.46, 2.86, ...</span>
<span class="co">#&gt; $ Hr      &lt;dbl&gt; 87.9, 88.6, 91.1, 91.8, 92.0, 92.4, 92.8, 92.0, 90.4, ...</span>
<span class="co">#&gt; $ p       &lt;dbl&gt; 942, 942, 942, 942, 942, 942, 941, 941, 941, 941, 940,...</span>
<span class="co">#&gt; $ RainDur &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, ...</span>
<span class="co">#&gt; $ StrGlo  &lt;dbl&gt; 0.00749, 0.00727, 0.01020, 0.00781, 0.01215, 0.01573, ...</span>
<span class="co">#&gt; $ T       &lt;dbl&gt; 5.61, 5.57, 5.35, 5.39, 5.11, 4.81, 4.58, 4.80, 5.38, ...</span>
<span class="co">#&gt; $ wd      &lt;dbl&gt; 159.6, 147.9, 258.2, 2.9, 27.7, 35.4, 40.2, 164.1, 182...</span>
<span class="co">#&gt; $ ws      &lt;dbl&gt; 0.904, 0.314, 0.630, 0.625, 1.905, 2.281, 2.245, 0.846...</span></code></pre></div>
<p>Diese Daten können nun direkt in openair verwendet werden:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">openair<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/openair/topics/windRose">windRose</a></span>(wide)</code></pre></div>
<p><img src="tutorial_files/figure-html/unnamed-chunk-30-1.png" width="700"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">
openair<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/openair/topics/polarPlot">polarPlot</a></span>(wide, <span class="st">"NO2"</span>, <span class="dt">type=</span><span class="st">"year"</span>)</code></pre></div>
<p><img src="tutorial_files/figure-html/unnamed-chunk-30-2.png" width="700"></p>
<p><code><a href="../../reference/openair_to_rolf.html">openair_to_rolf()</a></code> konventiert Daten zurück ins rolf Format. Der Nutzer muss die fehlenden Informationen bereitstellen:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../../reference/openair_to_rolf.html">openair_to_rolf</a></span>(wide, <span class="dt">interval =</span> <span class="st">"min30"</span>, <span class="dt">units =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/attr">attr</a></span>(wide, <span class="st">"units"</span>))
<span class="co">#&gt; # A tibble: 1,226,764 x 6</span>
<span class="co">#&gt;    starttime           site                  parameter interval unit  value</span>
<span class="co">#&gt;    &lt;dttm&gt;              &lt;fct&gt;                 &lt;fct&gt;     &lt;fct&gt;    &lt;fct&gt; &lt;dbl&gt;</span>
<span class="co">#&gt;  1 2010-01-01 00:00:00 Zch_Stampfenbachstra~ CO        min30    mg/m3 0.513</span>
<span class="co">#&gt;  2 2010-01-01 00:30:00 Zch_Stampfenbachstra~ CO        min30    mg/m3 0.609</span>
<span class="co">#&gt;  3 2010-01-01 01:00:00 Zch_Stampfenbachstra~ CO        min30    mg/m3 0.822</span>
<span class="co">#&gt;  4 2010-01-01 01:30:00 Zch_Stampfenbachstra~ CO        min30    mg/m3 1.06 </span>
<span class="co">#&gt;  5 2010-01-01 02:00:00 Zch_Stampfenbachstra~ CO        min30    mg/m3 0.861</span>
<span class="co">#&gt;  6 2010-01-01 02:30:00 Zch_Stampfenbachstra~ CO        min30    mg/m3 0.760</span>
<span class="co">#&gt;  7 2010-01-01 03:00:00 Zch_Stampfenbachstra~ CO        min30    mg/m3 0.633</span>
<span class="co">#&gt;  8 2010-01-01 03:30:00 Zch_Stampfenbachstra~ CO        min30    mg/m3 0.666</span>
<span class="co">#&gt;  9 2010-01-01 04:00:00 Zch_Stampfenbachstra~ CO        min30    mg/m3 0.780</span>
<span class="co">#&gt; 10 2010-01-01 04:30:00 Zch_Stampfenbachstra~ CO        min30    mg/m3 0.654</span>
<span class="co">#&gt; # ... with 1,226,754 more rows</span></code></pre></div>
<p><code><a href="../../reference/rolf_to_openair_single.html">rolf_to_openair_single()</a></code> bietet die Möglichkeit einen bestimmten Parameter rauszupicken:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../../reference/rolf_to_openair_single.html">rolf_to_openair_single</a></span>(data, <span class="st">"NO2"</span>, <span class="dt">unit =</span> <span class="st">"µg/m3"</span>, <span class="dt">keep_interval =</span> <span class="ot">TRUE</span>)
<span class="co">#&gt; # A tibble: 86,883 x 5</span>
<span class="co">#&gt;    date                site                    interval unit    NO2</span>
<span class="co">#&gt;    &lt;dttm&gt;              &lt;fct&gt;                   &lt;fct&gt;    &lt;fct&gt; &lt;dbl&gt;</span>
<span class="co">#&gt;  1 2010-01-01 00:00:00 Zch_Stampfenbachstrasse min30    µg/m3  37.0</span>
<span class="co">#&gt;  2 2010-01-01 00:30:00 Zch_Stampfenbachstrasse min30    µg/m3  46.5</span>
<span class="co">#&gt;  3 2010-01-01 01:00:00 Zch_Stampfenbachstrasse min30    µg/m3  54.6</span>
<span class="co">#&gt;  4 2010-01-01 01:30:00 Zch_Stampfenbachstrasse min30    µg/m3  60.5</span>
<span class="co">#&gt;  5 2010-01-01 02:00:00 Zch_Stampfenbachstrasse min30    µg/m3  58.8</span>
<span class="co">#&gt;  6 2010-01-01 02:30:00 Zch_Stampfenbachstrasse min30    µg/m3  52.9</span>
<span class="co">#&gt;  7 2010-01-01 03:00:00 Zch_Stampfenbachstrasse min30    µg/m3  49.0</span>
<span class="co">#&gt;  8 2010-01-01 03:30:00 Zch_Stampfenbachstrasse min30    µg/m3  50.9</span>
<span class="co">#&gt;  9 2010-01-01 04:00:00 Zch_Stampfenbachstrasse min30    µg/m3  56.3</span>
<span class="co">#&gt; 10 2010-01-01 04:30:00 Zch_Stampfenbachstrasse min30    µg/m3  48.8</span>
<span class="co">#&gt; # ... with 86,873 more rows</span></code></pre></div>
<p>Die weitere Optionen für die Funktion <code><a href="../../reference/rolf_to_openair.html">rolf_to_openair()</a></code> sind in der Dokumentation zu finden.</p>
</div>
<div id="resampling-von-daten" class="section level1">
<h1 class="hasAnchor">
<a href="#resampling-von-daten" class="anchor"></a>Resampling von Daten</h1>
</div>
<div id="umwandlung-von-volumen--und-massenkonzentrationen" class="section level1">
<h1 class="hasAnchor">
<a href="#umwandlung-von-volumen--und-massenkonzentrationen" class="anchor"></a>Umwandlung von Volumen- und Massenkonzentrationen</h1>
<p>Die Umwandlung der Konzentrationen erfolgt äquivalent zu den Berechnungen in der AIRMO. Sollen andere Konstanten verwendet werden, ist die Dokumentation von <code><a href="../../reference/convert_get_R.html">convert_set_R()</a></code> zu konsultieren. Die Funktionen <code><a href="../../reference/convert_conc.html">convert_conc()</a></code> und <code><a href="../../reference/convert_conc.html">convert_conc_multiple()</a></code> verfügen beide über Varianten wie die umgewandelten Daten zurückgegeben werden. Definiert wird dies mit dem Argument method. Bei “return” werden nur die umgewandelten Daten zurückgegeben, bei “append” werden sie am Ende angehängt und zuletzt bei “replace” werden die ursprünglichen Daten ersetzt.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">input &lt;-<span class="st"> </span><span class="kw"><a href="../../reference/read_airmo_csv.html">read_airmo_csv</a></span>(fs<span class="op">::</span><span class="kw"><a href="http://fs.r-lib.org/reference/path.html">path</a></span>(examples_path, <span class="st">"Zch_Stampfenbachstrasse_min30_2013_Jan.csv"</span>))

<span class="co"># Behalte nur Volumenkonzentrationen im input</span>
input &lt;-<span class="st"> </span>dplyr<span class="op">::</span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(input, .data<span class="op">$</span>unit <span class="op">==</span><span class="st"> "ppb"</span> <span class="op">|</span><span class="st"> </span>.data<span class="op">$</span>unit <span class="op">==</span><span class="st"> "ppm"</span>)

<span class="kw"><a href="../../reference/convert_conc.html">convert_conc</a></span>(input, <span class="st">"NO"</span>, <span class="st">"ppb"</span>, <span class="st">"µg/m3"</span>, <span class="dt">method =</span> <span class="st">"return"</span>)
<span class="co">#&gt; # A tibble: 1,484 x 6</span>
<span class="co">#&gt;    starttime           site                  parameter interval unit  value</span>
<span class="co">#&gt;    &lt;dttm&gt;              &lt;fct&gt;                 &lt;fct&gt;     &lt;fct&gt;    &lt;fct&gt; &lt;dbl&gt;</span>
<span class="co">#&gt;  1 2013-01-01 00:00:00 Zch_Stampfenbachstra~ NO        min30    µg/m3  79.3</span>
<span class="co">#&gt;  2 2013-01-01 00:30:00 Zch_Stampfenbachstra~ NO        min30    µg/m3  81.8</span>
<span class="co">#&gt;  3 2013-01-01 01:00:00 Zch_Stampfenbachstra~ NO        min30    µg/m3  75.6</span>
<span class="co">#&gt;  4 2013-01-01 01:30:00 Zch_Stampfenbachstra~ NO        min30    µg/m3  81.2</span>
<span class="co">#&gt;  5 2013-01-01 02:00:00 Zch_Stampfenbachstra~ NO        min30    µg/m3 101. </span>
<span class="co">#&gt;  6 2013-01-01 02:30:00 Zch_Stampfenbachstra~ NO        min30    µg/m3  61.4</span>
<span class="co">#&gt;  7 2013-01-01 03:00:00 Zch_Stampfenbachstra~ NO        min30    µg/m3  63.6</span>
<span class="co">#&gt;  8 2013-01-01 03:30:00 Zch_Stampfenbachstra~ NO        min30    µg/m3  61.0</span>
<span class="co">#&gt;  9 2013-01-01 04:00:00 Zch_Stampfenbachstra~ NO        min30    µg/m3  63.6</span>
<span class="co">#&gt; 10 2013-01-01 04:30:00 Zch_Stampfenbachstra~ NO        min30    µg/m3  70.7</span>
<span class="co">#&gt; # ... with 1,474 more rows</span>

conversions &lt;-<span class="st"> </span>tibble<span class="op">::</span><span class="kw"><a href="https://tibble.tidyverse.org/reference/tribble.html">tribble</a></span>(
  <span class="op">~</span>parameter, <span class="op">~</span>from, <span class="op">~</span>to,
  <span class="st">"CO"</span>, <span class="st">"ppm"</span>, <span class="st">"mg/m3"</span>,
  <span class="st">"NO"</span>, <span class="st">"ppb"</span>, <span class="st">"µg/m3"</span>,
  <span class="st">"O3"</span>, <span class="st">"ppb"</span>, <span class="st">"µg/m3"</span>,
  <span class="st">"NO2"</span>, <span class="st">"ppb"</span>, <span class="st">"µg/m3"</span>,
  <span class="st">"SO2"</span>, <span class="st">"ppb"</span>, <span class="st">"µg/m3"</span>
)
<span class="kw"><a href="../../reference/convert_conc.html">convert_conc_multiple</a></span>(input, conversions, <span class="dt">method =</span> <span class="st">"return"</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span>dplyr<span class="op">::</span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span>(.data<span class="op">$</span>starttime)
<span class="co">#&gt; # A tibble: 7,424 x 6</span>
<span class="co">#&gt;    starttime           site                 parameter interval unit   value</span>
<span class="co">#&gt;    &lt;dttm&gt;              &lt;fct&gt;                &lt;fct&gt;     &lt;fct&gt;    &lt;fct&gt;  &lt;dbl&gt;</span>
<span class="co">#&gt;  1 2013-01-01 00:00:00 Zch_Stampfenbachstr~ CO        min30    mg/m3  0.782</span>
<span class="co">#&gt;  2 2013-01-01 00:00:00 Zch_Stampfenbachstr~ NO        min30    µg/m3 79.3  </span>
<span class="co">#&gt;  3 2013-01-01 00:00:00 Zch_Stampfenbachstr~ O3        min30    µg/m3  3.48 </span>
<span class="co">#&gt;  4 2013-01-01 00:00:00 Zch_Stampfenbachstr~ NO2       min30    µg/m3 63.0  </span>
<span class="co">#&gt;  5 2013-01-01 00:00:00 Zch_Stampfenbachstr~ SO2       min30    µg/m3 11.7  </span>
<span class="co">#&gt;  6 2013-01-01 00:30:00 Zch_Stampfenbachstr~ CO        min30    mg/m3  0.828</span>
<span class="co">#&gt;  7 2013-01-01 00:30:00 Zch_Stampfenbachstr~ NO        min30    µg/m3 81.8  </span>
<span class="co">#&gt;  8 2013-01-01 00:30:00 Zch_Stampfenbachstr~ O3        min30    µg/m3  3.40 </span>
<span class="co">#&gt;  9 2013-01-01 00:30:00 Zch_Stampfenbachstr~ NO2       min30    µg/m3 64.7  </span>
<span class="co">#&gt; 10 2013-01-01 00:30:00 Zch_Stampfenbachstr~ SO2       min30    µg/m3 12.2  </span>
<span class="co">#&gt; # ... with 7,414 more rows</span>

<span class="kw"><a href="../../reference/convert_conc.html">convert_conc_multiple</a></span>(input, conversions, <span class="dt">method =</span> <span class="st">"append"</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span>dplyr<span class="op">::</span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span>(.data<span class="op">$</span>starttime)
<span class="co">#&gt; # A tibble: 16,332 x 6</span>
<span class="co">#&gt;    starttime           site                 parameter interval unit   value</span>
<span class="co">#&gt;    &lt;dttm&gt;              &lt;fct&gt;                &lt;fct&gt;     &lt;fct&gt;    &lt;fct&gt;  &lt;dbl&gt;</span>
<span class="co">#&gt;  1 2013-01-01 00:00:00 Zch_Stampfenbachstr~ CO        min30    ppm    0.672</span>
<span class="co">#&gt;  2 2013-01-01 00:00:00 Zch_Stampfenbachstr~ NO        min30    ppb   63.6  </span>
<span class="co">#&gt;  3 2013-01-01 00:00:00 Zch_Stampfenbachstr~ NO2       min30    ppb   33.0  </span>
<span class="co">#&gt;  4 2013-01-01 00:00:00 Zch_Stampfenbachstr~ NOx       min30    ppb   96.5  </span>
<span class="co">#&gt;  5 2013-01-01 00:00:00 Zch_Stampfenbachstr~ O3        min30    ppb    1.75 </span>
<span class="co">#&gt;  6 2013-01-01 00:00:00 Zch_Stampfenbachstr~ SO2       min30    ppb    4.41 </span>
<span class="co">#&gt;  7 2013-01-01 00:00:00 Zch_Stampfenbachstr~ CO        min30    mg/m3  0.782</span>
<span class="co">#&gt;  8 2013-01-01 00:00:00 Zch_Stampfenbachstr~ NO        min30    µg/m3 79.3  </span>
<span class="co">#&gt;  9 2013-01-01 00:00:00 Zch_Stampfenbachstr~ O3        min30    µg/m3  3.48 </span>
<span class="co">#&gt; 10 2013-01-01 00:00:00 Zch_Stampfenbachstr~ NO2       min30    µg/m3 63.0  </span>
<span class="co">#&gt; # ... with 16,322 more rows</span>

<span class="kw"><a href="../../reference/convert_conc.html">convert_conc_multiple</a></span>(input, conversions, <span class="dt">method =</span> <span class="st">"replace"</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span>dplyr<span class="op">::</span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span>(.data<span class="op">$</span>starttime)
<span class="co">#&gt; # A tibble: 8,908 x 6</span>
<span class="co">#&gt;    starttime           site                 parameter interval unit   value</span>
<span class="co">#&gt;    &lt;dttm&gt;              &lt;fct&gt;                &lt;fct&gt;     &lt;fct&gt;    &lt;fct&gt;  &lt;dbl&gt;</span>
<span class="co">#&gt;  1 2013-01-01 00:00:00 Zch_Stampfenbachstr~ NOx       min30    ppb   96.5  </span>
<span class="co">#&gt;  2 2013-01-01 00:00:00 Zch_Stampfenbachstr~ CO        min30    mg/m3  0.782</span>
<span class="co">#&gt;  3 2013-01-01 00:00:00 Zch_Stampfenbachstr~ NO        min30    µg/m3 79.3  </span>
<span class="co">#&gt;  4 2013-01-01 00:00:00 Zch_Stampfenbachstr~ O3        min30    µg/m3  3.48 </span>
<span class="co">#&gt;  5 2013-01-01 00:00:00 Zch_Stampfenbachstr~ NO2       min30    µg/m3 63.0  </span>
<span class="co">#&gt;  6 2013-01-01 00:00:00 Zch_Stampfenbachstr~ SO2       min30    µg/m3 11.7  </span>
<span class="co">#&gt;  7 2013-01-01 00:30:00 Zch_Stampfenbachstr~ NOx       min30    ppb   99.4  </span>
<span class="co">#&gt;  8 2013-01-01 00:30:00 Zch_Stampfenbachstr~ CO        min30    mg/m3  0.828</span>
<span class="co">#&gt;  9 2013-01-01 00:30:00 Zch_Stampfenbachstr~ NO        min30    µg/m3 81.8  </span>
<span class="co">#&gt; 10 2013-01-01 00:30:00 Zch_Stampfenbachstr~ O3        min30    µg/m3  3.40 </span>
<span class="co">#&gt; # ... with 8,898 more rows</span></code></pre></div>
</div>
<div id="lokale-daten-loschen" class="section level1">
<h1 class="hasAnchor">
<a href="#lokale-daten-loschen" class="anchor"></a>Lokale Daten löschen</h1>
<p>Werden die Daten lokal nicht mehr benötigt, kann mit der Funktion <code>$destroy()</code> des Store Objektes die Daten gelöscht werden. Zu beachten ist, dass der AWS S3 Store als read only initialisiert wurde. Um ihn löschen zu können muss dies geändert werden. Um ein versehentliches löschen durch Autocomplete zu verhindern, muss der String “DELETE” als Argument übergeben werden</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">store<span class="op">$</span>read.only =<span class="st"> </span><span class="ot">FALSE</span>
store<span class="op">$</span><span class="kw">destroy</span>(<span class="st">"DELETE"</span>)
<span class="co">#&gt; Cache for Store tutorial destroyed</span>

my_store<span class="op">$</span><span class="kw">destroy</span>(<span class="st">"DELETE"</span>)
<span class="co">#&gt; Store eigene_daten destroyed</span></code></pre></div>
</div>
<div class="footnotes">
<hr>
<ol>
<li id="fn1"><p>rlang muss nicht als library importiert werden. … leitet die Expression an rOstluft weiter. Dieses hat den Operator importiert und kann somit die Expression korrekt auswerten.<a href="#fnref1">↩</a></p></li>
</ol>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#einleitung">Einleitung</a></li>
      <li><a href="#installation">Installation</a></li>
      <li>
<a href="#abfrage-von-daten">Abfrage von Daten</a><ul class="nav nav-pills nav-stacked">
<li><a href="#ostluft-amazon-aws-s3">Ostluft Amazon AWS S3</a></li>
      <li><a href="#lokales-arbeiten-mit-den-aws-s3-daten">Lokales Arbeiten mit den AWS S3 Daten</a></li>
      <li><a href="#eigene-daten-in-einem-lokalen-store">Eigene Daten in einem lokalen Store</a></li>
      </ul>
</li>
      <li>
<a href="#einlesefunktionen-von-daten">Einlesefunktionen von Daten</a><ul class="nav nav-pills nav-stacked">
<li><a href="#verwende-readr-funktionen-und-definiere-die-zeichenkodierung">Verwende readr Funktionen und definiere die Zeichenkodierung</a></li>
      <li><a href="#ausgabeformat-rolf">Ausgabeformat rolf</a></li>
      </ul>
</li>
      <li><a href="#zusammenfugen-von-daten-im-rolf-format">Zusammenfügen von Daten im rolf Format</a></li>
      <li><a href="#metadaten">Metadaten</a></li>
      <li><a href="#openair-kompatibles-wide-format">openair kompatibles Wide Format</a></li>
      <li><a href="#resampling-von-daten">Resampling von Daten</a></li>
      <li><a href="#umwandlung-von-volumen--und-massenkonzentrationen">Umwandlung von Volumen- und Massenkonzentrationen</a></li>
      <li><a href="#lokale-daten-loschen">Lokale Daten löschen</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Thomas von Allmen, Jörg Sintermann, Noël Rederlechner.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.3.0.</p>
</div>
      </footer>
</div>

  

  </body>
</html>

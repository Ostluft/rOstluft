<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>[GER] Tutorial • rOstluft</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/cosmo/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../../bootstrap-toc.css">
<script src="../../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../../pkgdown.css" rel="stylesheet">
<script src="../../pkgdown.js"></script><meta property="og:title" content="[GER] Tutorial">
<meta property="og:description" content="rOstluft">
<meta property="og:image" content="/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../../index.html">rOstluft</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.4.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../../articles/articles/tutorial.html">[GER] Tutorial</a>
    </li>
    <li>
      <a href="../../articles/resample.html">[GER] Resampling data</a>
    </li>
    <li>
      <a href="../../articles/Technische_Entscheidungen.html">[GER] Technische Entscheidungen</a>
    </li>
  </ul>
</li>
<li>
  <a href="../../articles/articles/tutorial.html">
    <span class="fa fa-leanpub"></span>
     
    Tutorial
  </a>
</li>
<li>
  <a href="../../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/Ostluft/rOstluft">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="tutorial_files/header-attrs-2.3/header-attrs.js"></script><script src="tutorial_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>[GER] Tutorial</h1>
                        <h4 class="author">Thomas von Allmen</h4>
            
            <h4 class="date">2020-09-20</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/Ostluft/rOstluft/blob/master/vignettes/articles/tutorial.Rmd"><code>vignettes/articles/tutorial.Rmd</code></a></small>
      <div class="hidden name"><code>tutorial.Rmd</code></div>

    </div>

    
    
<div id="einleitung" class="section level1">
<h1 class="hasAnchor">
<a href="#einleitung" class="anchor"></a>Einleitung</h1>
<p>Dieses Dokument soll einem Anwender des Packages <code><a href="../../reference/rOstluft.html">rOstluft::rOstluft</a></code> einen Überblick der enthaltenen Funktionalität bieten und die gängigsten Arbeitsabläufe aufzeigen.</p>
<p>Der Fokus dieses Packages liegt in der Bereitstellung von Daten aus verschiedenen Datenquellen in einem einheitlichen Format zur Analyse der Luftqualität. Ausserdem enthält es Werkzeuge für einige übliche Aufgaben, die während solchen Analysen anfallen. Diese sind Umrechnungen zwischen verschiedenen Mittelungsintervallen, Statistische Methoden mit Berücksichtung der Datenverfügbarkeit, Umwandlung von Volumen- und Massenkonzentrationen und lesen von Daten vorliegend in verschiedenen Formaten.</p>
</div>
<div id="installation" class="section level1">
<h1 class="hasAnchor">
<a href="#installation" class="anchor"></a>Installation</h1>
<p>Der Quellcode von <a href="https://github.com/Ostluft/rOstluft">rOstluft</a> ist auf github gehosted. Die einfachste Variante ist die Installation mit Hilfe des Packages devtools:</p>
<div class="sourceCode" id="cb1"><pre class="downlit">
<span class="co">#install.packages("devtools")</span>
<span class="kw">devtools</span>::<span class="fu"><a href="https://devtools.r-lib.org//reference/remote-reexports.html">install_github</a></span>(<span class="st">"Ostluft/rOstluft"</span>)
</pre></div>
<p>Zusätzlich muss das Package <code>aws.s3</code> manuell aus dem cloudyr Repositorium installiert werden, weil die CRANR Version veraltet ist:</p>
<div class="sourceCode" id="cb2"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span>(<span class="st">"aws.s3"</span>, repos = <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"cloudyr"</span> = <span class="st">"http://cloudyr.github.io/drat"</span>))
</pre></div>
<p>Ist dies wegen Einschränkungen durch Firewalls oder Proxies nicht möglich. Muss der Quellcode manuell von github heruntergeladen werden (Clone or download &gt; Download as ZIP), entpackt und manuell installiert werden. Allerdings bestehen Abhängigkeiten zu Packages die auf CRAN bereitgestellt werden. Können auch keine CRAN Packages installiert werden, müssen zuerst alle CRAN Abhängkigkeiten und deren Abhängigkeiten installiert werden.</p>
<p>Zusätzlich besteht noch die Github Abhängkigkeit zu <a href="https://github.com/Ostluft/rOstluft.data">rOstluft.data</a>. Dieses Packages muss auf die gleiche Weise zuerst installiert werden mit folgenden Schritten:</p>
<div class="sourceCode" id="cb3"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/utils/download.file.html">download.file</a></span>(<span class="st">"https://github.com/Ostluft/rOstluft/archive/master.zip"</span>, <span class="st">"rOstluft-master.zip"</span>)
<span class="fu"><a href="https://rdrr.io/r/utils/download.file.html">download.file</a></span>(<span class="st">"https://github.com/Ostluft/rOstluft.data/archive/master.zip"</span>, <span class="st">"rOstluft.data-master.zip"</span>)

<span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span>(<span class="st">"devtools"</span>)
<span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span>(<span class="st">"aws.s3"</span>, repos = <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"cloudyr"</span> = <span class="st">"http://cloudyr.github.io/drat"</span>))

<span class="kw">deps</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">'dplyr'</span>, <span class="st">'tidyr'</span>, <span class="st">'lubridate'</span>, <span class="st">'R6'</span>, <span class="st">'rappdirs'</span>, <span class="st">'tibble'</span>, <span class="st">'base64url'</span>, <span class="st">'forcats'</span>,
          <span class="st">'fs'</span>, <span class="st">'purrr'</span>, <span class="st">'readr'</span>, <span class="st">'stringr'</span>, <span class="st">'stringi'</span>, <span class="st">'sp'</span>, <span class="st">'rgdal'</span>, <span class="st">'rlang'</span>, <span class="st">'magrittr'</span>)

<span class="co">for</span> (<span class="kw">p</span> <span class="co">in</span> <span class="kw">deps</span>) {
  <span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span>(<span class="kw">p</span>)
}

<span class="kw">devtools</span>::<span class="fu"><a href="https://devtools.r-lib.org//reference/remote-reexports.html">install_local</a></span>(<span class="st">"rOstluft.data-master.zip"</span>, dependencies = <span class="fl">FALSE</span>)
<span class="kw">devtools</span>::<span class="fu"><a href="https://devtools.r-lib.org//reference/remote-reexports.html">install_local</a></span>(<span class="st">"rOstluft-master.zip"</span>, dependencies = <span class="fl">FALSE</span>)
</pre></div>
<p>Falls das installieren von rOstluft scheitert, fehlt vermutlich eine Abhängigkeit. Welche das ist, kann der Fehlermeldung entnommen werden.</p>
<p>Nach der Installation kann das Packages verwendet werden:</p>
<div class="sourceCode" id="cb4"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="kw"><a href="https://github.com/Ostluft/rOstluft">rOstluft</a></span>)
</pre></div>
</div>
<div id="abfrage-von-daten" class="section level1">
<h1 class="hasAnchor">
<a href="#abfrage-von-daten" class="anchor"></a>Abfrage von Daten</h1>
<div id="ostluft-amazon-aws-s3" class="section level2">
<h2 class="hasAnchor">
<a href="#ostluft-amazon-aws-s3" class="anchor"></a>Ostluft Amazon AWS S3</h2>
<p>Die zentrale Datenablage innerhalb von Ostluft erfolgt auf <a href="https://aws.amazon.com/s3/">Amazon AWS S3</a>.Aus Lizenztechnischen Gründen kann das Bucket nicht öffentlich zugänglich gemacht werden. Die Zugangsdaten werden von Jörg Sintermann vergeben. Die Zugangsdaten werden am einfachsten über eine .Renvirion Datei im Verzeichnis des RStudio Projektes oder im HOME Verzeichnis des Users<a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a> dem Package zugänglich gemacht. Inhalt der .Renvirion Datei:</p>
<pre><code>AWS_ACCESS_KEY_ID = "XXXXXXXXXXXXXXXXXXXX"
AWS_SECRET_ACCESS_KEY = "XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX"
AWS_DEFAULT_REGION = "eu-central-1"</code></pre>
<p>Weitere Möglichkeiten sind in der Dokumentation von <a href="https://github.com/cloudyr/aws.signature/">aws.signature</a> zu finden.</p>
<p>Sämtliche Daten die einmal von Amazon S3 geöffnet wurden, werden lokal auf dem Rechner gespeichert. Bei jedem folgenden Zugriff wird nur überprüft, ob die Daten noch identisch sind.</p>
<p>Der Zugriff auf die Daten erfügt dann über ein store Objekt, welches auf folgende Art initialisiert wird:</p>
<div class="sourceCode" id="cb6"><pre class="downlit">
<span class="kw">store</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/r6_storage_s3.html">storage_s3_rds</a></span>(<span class="st">"tutorial"</span>, format = <span class="fu"><a href="../../reference/format_rolf.html">format_rolf</a></span>(), bucket = <span class="st">"rostluft"</span>, prefix = <span class="st">"aqmet"</span>)

<span class="co"># oder nutze den vordefinierten store (name ist optional, default ist "aqmet")</span>
<span class="kw">store</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/store_aqmet.html">store_aqmet</a></span>(<span class="st">"tutorial"</span>)
</pre></div>
<p>Dieses store Objekt verfügt über verschiedene Methoden, zur Abfrage von Daten sind jedoch nur zwei von Bedeutung:</p>
<ul>
<li>
<code>$get_content()</code>: holt eine Übersicht über alle im store enthaltene Daten</li>
<li>
<code>$get()</code>: Aktuelle Datenabfrage. Welche Daten geholt werden, muss über Funktionsargumente definiert werden</li>
</ul>
<div class="sourceCode" id="cb7"><pre class="downlit">
<span class="kw">content</span> <span class="op">&lt;-</span> <span class="kw">store</span><span class="op">$</span><span class="fu">get_content</span>()
<span class="kw">content</span>
<span class="co">#&gt; # A tibble: 179,019 x 6</span>
<span class="co">#&gt;     year interval site                parameter unit      n</span>
<span class="co">#&gt;    &lt;dbl&gt; &lt;fct&gt;    &lt;fct&gt;               &lt;fct&gt;     &lt;fct&gt; &lt;int&gt;</span>
<span class="co">#&gt;  1  2013 h1       Zürich - EraInterim blh       m       730</span>
<span class="co">#&gt;  2  2013 h1       Zürich - EraInterim cape      J/kg    730</span>
<span class="co">#&gt;  3  2013 h1       Zürich - EraInterim d2m       °C      730</span>0
<span class="co">#&gt;  4  2013 h1       Zürich - EraInterim e         m H2O   730</span>
<span class="co">#&gt;  5  2013 h1       Zürich - EraInterim ishf      W/m2    730</span>
<span class="co">#&gt;  6  2013 h1       Zürich - EraInterim p         hPa     730</span>
<span class="co">#&gt;  7  2013 h1       Zürich - EraInterim par       J/m2    730</span>
<span class="co">#&gt;  8  2013 h1       Zürich - EraInterim RainSum   m       730</span>
<span class="co">#&gt;  9  2013 h1       Zürich - EraInterim skt       °C      730</span>0
<span class="co">#&gt; 10  2013 h1       Zürich - EraInterim slhf      J/m2    730</span>
<span class="co">#&gt; # ... with 179,009 more rows</span>

<span class="kw">dplyr</span>::<span class="fu"><a href="https://dplyr.tidyverse.org/reference/sample_n.html">sample_n</a></span>(<span class="kw">content</span>, <span class="fl">10</span>)
<span class="co">#&gt; # A tibble: 10 x 6</span>
<span class="co">#&gt;     year interval site                    parameter           unit      n</span>
<span class="co">#&gt;    &lt;dbl&gt; &lt;fct&gt;    &lt;fct&gt;                   &lt;fct&gt;               &lt;fct&gt; &lt;int&gt;</span>
<span class="co">#&gt;  1  2014 y1       Wee_Weerstein           O3_98%_min30_max_m1 µg/m3     1</span>1
<span class="co">#&gt;  2  2001 m1       Zch_Schimmelstrasse     CO                  mg/m3    12</span>
<span class="co">#&gt;  3  2006 min30    Wal_Dietlikonerstrasse  NOx                 ppb   17121</span>
<span class="co">#&gt;  4  2016 y1       StG_Stuelegg            NOx_min_min30       ppb       1</span>
<span class="co">#&gt;  5  2008 d1       Zch_Stampfenbachstrasse NO2                 µg/m3   358</span>8
<span class="co">#&gt;  6  2003 y1       9030_0010               NO2                 µg/m3     1</span>1
<span class="co">#&gt;  7  2013 d1       Obf_Gugelrebenstrasse   NO_nb_min30         1       145</span>
<span class="co">#&gt;  8  1998 d1       Opf_Tenniscenter        p                   hPa     360</span>
<span class="co">#&gt;  9  2002 y1       St.Gallen               Hr                  %         1</span>
<span class="co">#&gt; 10  2011 m1       StG_Stuelegg            WD                  °        12</span>2
</pre></div>
<p>Eine Datenabfrage holt immer die Daten von einem komplettem Jahr einer Station für einen bestimmten Mittelungszeitraum:</p>
<div class="sourceCode" id="cb8"><pre class="downlit">
<span class="kw">store</span><span class="op">$</span><span class="fu"><a href="https://rdrr.io/r/base/get.html">get</a></span>(site = <span class="st">"Zch_Schimmelstrasse"</span>, year = <span class="fl">2014</span>, interval = <span class="st">"min30"</span>)
<span class="co">#&gt; # A tibble: 243,875 x 6</span>
<span class="co">#&gt;    starttime           site                parameter interval unit      value</span>
<span class="co">#&gt;    &lt;dttm&gt;              &lt;fct&gt;               &lt;fct&gt;     &lt;fct&gt;    &lt;fct&gt;     &lt;dbl&gt;</span>
<span class="co">#&gt;  1 2014-01-01 00:00:00 Zch_Schimmelstrasse CO        min30    ppm       0.637</span>
<span class="co">#&gt;  2 2014-01-01 00:00:00 Zch_Schimmelstrasse Hr        min30    %Hr      87.4  </span>
<span class="co">#&gt;  3 2014-01-01 00:00:00 Zch_Schimmelstrasse NO2       min30    ppb      28.1  </span>
<span class="co">#&gt;  4 2014-01-01 00:00:00 Zch_Schimmelstrasse NO        min30    ppb      61.5  </span>
<span class="co">#&gt;  5 2014-01-01 00:00:00 Zch_Schimmelstrasse NOx       min30    ppb      89.6  </span>
<span class="co">#&gt;  6 2014-01-01 00:00:00 Zch_Schimmelstrasse O3        min30    ppb       0.798</span>
<span class="co">#&gt;  7 2014-01-01 00:00:00 Zch_Schimmelstrasse PM10      min30    µg/m3   102.   </span> 
<span class="co">#&gt;  8 2014-01-01 00:00:00 Zch_Schimmelstrasse PN        min30    1/cm3 25971    </span>
<span class="co">#&gt;  9 2014-01-01 00:00:00 Zch_Schimmelstrasse RainDur   min30    min       0    </span>
<span class="co">#&gt; 10 2014-01-01 00:00:00 Zch_Schimmelstrasse SO2       min30    ppb       2.12 </span>
<span class="co">#&gt; # ... with 243,865 more rows</span>
</pre></div>
<p>Jedes der Argumente kann auch ein Vector sein mit mehreren Werte. Es wird dann Kombination aller Möglichkeiten abgefragt.</p>
<div class="sourceCode" id="cb9"><pre class="downlit">
<span class="kw">sites</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"Zch_Schimmelstrasse"</span>, <span class="st">"Zch_Rosengartenstrasse"</span>, <span class="st">"Zch_Stampfenbachstrasse"</span>)
<span class="kw">data</span> <span class="op">&lt;-</span> <span class="kw">store</span><span class="op">$</span><span class="fu"><a href="https://rdrr.io/r/base/get.html">get</a></span>(site = <span class="kw">sites</span>, year = <span class="fl">2014</span><span class="op">:</span><span class="fl">2015</span>, interval = <span class="st">"min30"</span>)
<span class="kw">data</span>
<span class="co">#&gt; # A tibble: 1,287,367 x 6</span>
<span class="co">#&gt;    starttime           site                   parameter interval unit    value</span>
<span class="co">#&gt;    &lt;dttm&gt;              &lt;fct&gt;                  &lt;fct&gt;     &lt;fct&gt;    &lt;fct&gt;   &lt;dbl&gt;</span>
<span class="co">#&gt;  1 2014-01-01 00:00:00 Zch_Rosengartenstrasse Hr        min30    %Hr    92.7  </span>
<span class="co">#&gt;  2 2014-01-01 00:00:00 Zch_Rosengartenstrasse NO2       min30    ppb    18.6  </span>
<span class="co">#&gt;  3 2014-01-01 00:00:00 Zch_Rosengartenstrasse NO        min30    ppb    42.8  </span>
<span class="co">#&gt;  4 2014-01-01 00:00:00 Zch_Rosengartenstrasse NOx       min30    ppb    61.4  </span>
<span class="co">#&gt;  5 2014-01-01 00:00:00 Zch_Rosengartenstrasse O3        min30    ppb     0.776</span>
<span class="co">#&gt;  6 2014-01-01 00:00:00 Zch_Rosengartenstrasse PM10      min30    µg/m3 298.   </span> 
<span class="co">#&gt;  7 2014-01-01 00:00:00 Zch_Rosengartenstrasse RainDur   min30    min     0    </span>
<span class="co">#&gt;  8 2014-01-01 00:00:00 Zch_Rosengartenstrasse T         min30    °C     -2.18 </span> 
<span class="co">#&gt;  9 2014-01-01 00:00:00 Zch_Rosengartenstrasse p         min30    hPa   966.   </span>
<span class="co">#&gt; 10 2014-01-01 00:30:00 Zch_Rosengartenstrasse Hr        min30    %Hr    89.1  </span>
<span class="co">#&gt; # ... with 1,287,357 more rows</span>

<span class="kw">dplyr</span>::<span class="fu"><a href="https://dplyr.tidyverse.org/reference/sample_n.html">sample_n</a></span>(<span class="kw">data</span>, <span class="fl">10</span>)
<span class="co">#&gt; # A tibble: 10 x 6</span>
<span class="co">#&gt;    starttime           site                    parameter interval unit   value</span>
<span class="co">#&gt;    &lt;dttm&gt;              &lt;fct&gt;                   &lt;fct&gt;     &lt;fct&gt;    &lt;fct&gt;  &lt;dbl&gt;</span>
<span class="co">#&gt;  1 2015-11-19 09:00:00 Zch_Rosengartenstrasse  Hr        min30    %Hr    64.0 </span>
<span class="co">#&gt;  2 2015-10-21 20:30:00 Zch_Schimmelstrasse     RainDur   min30    min     0   </span>
<span class="co">#&gt;  3 2014-09-16 05:00:00 Zch_Rosengartenstrasse  RainDur   min30    min     0   </span>
<span class="co">#&gt;  4 2015-07-04 15:30:00 Zch_Rosengartenstrasse  Hr        min30    %Hr    26.4 </span>
<span class="co">#&gt;  5 2014-08-07 21:30:00 Zch_Rosengartenstrasse  PM10      min30    µg/m3  14.9 </span> 
<span class="co">#&gt;  6 2015-05-30 06:00:00 Zch_Schimmelstrasse     p         min30    hPa   968.  </span>
<span class="co">#&gt;  7 2014-02-26 11:30:00 Zch_Schimmelstrasse     SO2       min30    ppb     1.57</span>
<span class="co">#&gt;  8 2015-05-05 17:00:00 Zch_Schimmelstrasse     T         min30    °C     19.4 </span> 
<span class="co">#&gt;  9 2015-02-07 22:30:00 Zch_Stampfenbachstrasse RainDur   min30    min     0   </span>
<span class="co">#&gt; 10 2014-03-03 17:00:00 Zch_Schimmelstrasse     NOx       min30    ppb    35.1</span>
</pre></div>
<p>Die letzte Funktionalität von <code>$get()</code> ist die Filterung der Daten vor der Rückgabe. Mit dem Argument “filter” als <code><a href="https://dplyr.tidyverse.org/reference/filter.html">dplyr::filter()</a></code> kompatibler Ausdruck:</p>
<div class="sourceCode" id="cb10"><pre class="downlit">
<span class="kw">store</span><span class="op">$</span><span class="fu"><a href="https://rdrr.io/r/base/get.html">get</a></span>(site = <span class="kw">sites</span>, year = <span class="fl">2014</span>, interval = <span class="st">"min30"</span>, filter = <span class="kw">parameter</span> <span class="op">==</span> <span class="st">"PM10"</span>)
<span class="co">#&gt; # A tibble: 51,319 x 6</span>
<span class="co">#&gt;    starttime           site                   parameter interval unit  value</span>
<span class="co">#&gt;    &lt;dttm&gt;              &lt;fct&gt;                  &lt;fct&gt;     &lt;fct&gt;    &lt;fct&gt; &lt;dbl&gt;</span>
<span class="co">#&gt;  1 2014-01-01 00:00:00 Zch_Rosengartenstrasse PM10      min30    µg/m3 298. </span> 
<span class="co">#&gt;  2 2014-01-01 00:30:00 Zch_Rosengartenstrasse PM10      min30    µg/m3 557. </span> 
<span class="co">#&gt;  3 2014-01-01 01:00:00 Zch_Rosengartenstrasse PM10      min30    µg/m3 308. </span> 
<span class="co">#&gt;  4 2014-01-01 01:30:00 Zch_Rosengartenstrasse PM10      min30    µg/m3 169. </span> 
<span class="co">#&gt;  5 2014-01-01 02:00:00 Zch_Rosengartenstrasse PM10      min30    µg/m3 128. </span> 
<span class="co">#&gt;  6 2014-01-01 02:30:00 Zch_Rosengartenstrasse PM10      min30    µg/m3  82.9</span>9
<span class="co">#&gt;  7 2014-01-01 03:00:00 Zch_Rosengartenstrasse PM10      min30    µg/m3  38.3</span>3
<span class="co">#&gt;  8 2014-01-01 03:30:00 Zch_Rosengartenstrasse PM10      min30    µg/m3  32.6</span>6
<span class="co">#&gt;  9 2014-01-01 04:00:00 Zch_Rosengartenstrasse PM10      min30    µg/m3  32.4</span>4
<span class="co">#&gt; 10 2014-01-01 04:30:00 Zch_Rosengartenstrasse PM10      min30    µg/m3  31.7</span>7
<span class="co">#&gt; # ... with 51,309 more rows</span>
</pre></div>
</div>
<div id="lokales-arbeiten-mit-den-aws-s3-daten" class="section level2">
<h2 class="hasAnchor">
<a href="#lokales-arbeiten-mit-den-aws-s3-daten" class="anchor"></a>Lokales Arbeiten mit den AWS S3 Daten</h2>
<p>Ein Nachteil des S3 Storage ist, dass bei jeder Datenabfrage eine Internetverbindung zur Überprüfung, ob aktualisierte Daten verfügbar sind, vorhanden sein muss. Selbst wenn die Daten bereits lokal gespeichert sind. Nicht nur wird eine Internetverbindung benötigt, die Überprüfung braucht auch eine kurze Zeit. Hat man alle notwendigen Daten bereits herunter geladen, kann man jedoch mit einem lokalen Store arbeiten. Praktischerweise hat der S3 Store eine Funktion, welche einen lokalen Store zurückgibt.</p>
<div class="sourceCode" id="cb11"><pre class="downlit">
<span class="kw">lokal</span> <span class="op">&lt;-</span> <span class="kw">store</span><span class="op">$</span><span class="fu">get_local_storage</span>()
</pre></div>
<p>Dieser verfügt über die gleichen Funktionalität wie der S3 Store:</p>
<div class="sourceCode" id="cb12"><pre class="downlit">
<span class="kw">lokal</span><span class="op">$</span><span class="fu">get_content</span>()
<span class="co">#&gt; # A tibble: 179,019 x 6</span>
<span class="co">#&gt;     year interval site                parameter unit      n</span>
<span class="co">#&gt;    &lt;dbl&gt; &lt;fct&gt;    &lt;fct&gt;               &lt;fct&gt;     &lt;fct&gt; &lt;int&gt;</span>
<span class="co">#&gt;  1  2013 h1       Zürich - EraInterim blh       m       730</span>
<span class="co">#&gt;  2  2013 h1       Zürich - EraInterim cape      J/kg    730</span>
<span class="co">#&gt;  3  2013 h1       Zürich - EraInterim d2m       °C      730</span>0
<span class="co">#&gt;  4  2013 h1       Zürich - EraInterim e         m H2O   730</span>
<span class="co">#&gt;  5  2013 h1       Zürich - EraInterim ishf      W/m2    730</span>
<span class="co">#&gt;  6  2013 h1       Zürich - EraInterim p         hPa     730</span>
<span class="co">#&gt;  7  2013 h1       Zürich - EraInterim par       J/m2    730</span>
<span class="co">#&gt;  8  2013 h1       Zürich - EraInterim RainSum   m       730</span>
<span class="co">#&gt;  9  2013 h1       Zürich - EraInterim skt       °C      730</span>0
<span class="co">#&gt; 10  2013 h1       Zürich - EraInterim slhf      J/m2    730</span>
<span class="co">#&gt; # ... with 179,009 more rows</span>

<span class="kw">lokal</span><span class="op">$</span><span class="fu"><a href="https://rdrr.io/r/base/get.html">get</a></span>(site = <span class="kw">sites</span>, year = <span class="fl">2014</span>, interval = <span class="st">"min30"</span>, filter = <span class="kw">parameter</span> <span class="op">==</span> <span class="st">"PM10"</span>)
<span class="co">#&gt; # A tibble: 51,319 x 6</span>
<span class="co">#&gt;    starttime           site                   parameter interval unit  value</span>
<span class="co">#&gt;    &lt;dttm&gt;              &lt;fct&gt;                  &lt;fct&gt;     &lt;fct&gt;    &lt;fct&gt; &lt;dbl&gt;</span>
<span class="co">#&gt;  1 2014-01-01 00:00:00 Zch_Rosengartenstrasse PM10      min30    µg/m3 298. </span> 
<span class="co">#&gt;  2 2014-01-01 00:30:00 Zch_Rosengartenstrasse PM10      min30    µg/m3 557. </span> 
<span class="co">#&gt;  3 2014-01-01 01:00:00 Zch_Rosengartenstrasse PM10      min30    µg/m3 308. </span> 
<span class="co">#&gt;  4 2014-01-01 01:30:00 Zch_Rosengartenstrasse PM10      min30    µg/m3 169. </span> 
<span class="co">#&gt;  5 2014-01-01 02:00:00 Zch_Rosengartenstrasse PM10      min30    µg/m3 128. </span> 
<span class="co">#&gt;  6 2014-01-01 02:30:00 Zch_Rosengartenstrasse PM10      min30    µg/m3  82.9</span>9
<span class="co">#&gt;  7 2014-01-01 03:00:00 Zch_Rosengartenstrasse PM10      min30    µg/m3  38.3</span>3
<span class="co">#&gt;  8 2014-01-01 03:30:00 Zch_Rosengartenstrasse PM10      min30    µg/m3  32.6</span>6
<span class="co">#&gt;  9 2014-01-01 04:00:00 Zch_Rosengartenstrasse PM10      min30    µg/m3  32.4</span>4
<span class="co">#&gt; 10 2014-01-01 04:30:00 Zch_Rosengartenstrasse PM10      min30    µg/m3  31.7</span>7
<span class="co">#&gt; # ... with 51,309 more rows</span>
</pre></div>
<p>Dem aufmerksamen Leser ist vermutlich aufgefallen, dass die Inhaltsübersicht von <code>$get_content()</code> nicht dem lokalen Inhalt entspricht. Es ist immer noch die Übersicht welche Daten in S3 verfügbar wären. Will man wissen welche Daten lokal verfügbar sind, hilft einem die Funktion <code>$list_chunks()</code> weiter.</p>
<div class="sourceCode" id="cb13"><pre class="downlit">
<span class="kw">tibble</span>::<span class="fu"><a href="https://tibble.tidyverse.org/reference/glimpse.html">glimpse</a></span>(<span class="kw">lokal</span><span class="op">$</span><span class="fu">list_chunks</span>())
<span class="co">#&gt; Rows: 6</span>
<span class="co">#&gt; Columns: 7</span>
<span class="co">#&gt; $ chunk_name              &lt;fs::path&gt; "min30/bWluMzDCu1pjaF9Sb3NlbmdhcnRlbnN...</span>
<span class="co">#&gt; $ interval                &lt;chr&gt; "min30", "min30", "min30", "min30", "min30"...</span>
<span class="co">#&gt; $ site                    &lt;chr&gt; "Zch_Rosengartenstrasse", "Zch_Rosengartens...</span>
<span class="co">#&gt; $ year                    &lt;chr&gt; "2014", "2015", "2014", "2015", "2014", "2015"</span>
<span class="co">#&gt; $ local.path              &lt;fs::path&gt; "C:/Users/tom/AppData/Local/rOstluft/t...</span>
<span class="co">#&gt; $ local.modification_time &lt;dttm&gt; 2020-09-20 22:42:10, 2020-09-20 22:42:11, ...</span>
<span class="co">#&gt; $ local.size              &lt;fs::bytes&gt; 662.71K, 780.21K, 1.08M, 1.07M, 1.08M...</span>
</pre></div>
<p>Auch der S3 Store verfügt über die <code>$list_chunks()</code> Funktion.</p>
<div class="sourceCode" id="cb14"><pre class="downlit">
<span class="kw">tibble</span>::<span class="fu"><a href="https://tibble.tidyverse.org/reference/glimpse.html">glimpse</a></span>(<span class="kw">store</span><span class="op">$</span><span class="fu">list_chunks</span>())
<span class="co">#&gt; Rows: 13,296</span>
<span class="co">#&gt; Columns: 11</span>
<span class="co">#&gt; $ chunk_name              &lt;fs::path&gt; "d1/ZDHCu01hdV9Qw7xudMK7MTk5MA", "d1/Z...</span>
<span class="co">#&gt; $ interval                &lt;chr&gt; "d1", "d1", "d1", "d1", "d1", "d1", "d1", "...</span>
<span class="co">#&gt; $ site                    &lt;chr&gt; "Mau_Pünt", "Mau_Pünt", "Mau_Pünt", "Mau_Pü...</span>
<span class="co">#&gt; $ year                    &lt;chr&gt; "1990", "1991", "1992", "1993", "1994", "19...</span>
<span class="co">#&gt; $ s3.key                  &lt;chr&gt; "aqmet/data/d1/ZDHCu01hdV9Qw7xudMK7MTk5MA.r...</span>
<span class="co">#&gt; $ s3.lastmodified         &lt;chr&gt; "2020-03-20T18:06:04.000Z", "2020-03-20T18:...</span>
<span class="co">#&gt; $ s3.etag                 &lt;chr&gt; "4d357b0954a7c44ad13a2ce146fed821", "57847e...</span>
<span class="co">#&gt; $ s3.size                 &lt;fs::bytes&gt; 15.78K, 27.11K, 29.25K, 28.32K, 16.95...</span>
<span class="co">#&gt; $ local.path              &lt;fs::path&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA...</span>
<span class="co">#&gt; $ local.modification_time &lt;dttm&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA...</span>
<span class="co">#&gt; $ local.size              &lt;fs::bytes&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, N...</span>
</pre></div>
<p>Im normal Fall ist Nutzung von <code>$get_content()</code> über <code>$list_chunks()</code> zu bevorzugen. Die Rückgabe von <code>$get_content()</code> enthält die gemessen Parameter und die Anzahl der gültigen Punkte. Bei <code>$list_chunks()</code> hingegen sind einige interne Informationen über den Store enthalten.</p>
<p>Um die Vorbereitung um mit einem lokalen Store zu arbeiten zu vereinfachen verfügt der S3 Store über die Funktion <code>$download(...)</code>. Die dot Argumente werden als Filter auf die Rückgabe von <code>$list_chunks()</code> angewendet. Ohne Argumente wird der komplette Store heruntergeladen. Folgendes Beispiel lädt samtliche 30 Minutenmittelwerte für die Station Rosengartenstrasse nach dem Jahr 2015 (Achtung == verwenden, es sind Filter Ausdrücke!):</p>
<div class="sourceCode" id="cb15"><pre class="downlit">
<span class="kw">store</span><span class="op">$</span><span class="fu">download</span>(<span class="kw">site</span> <span class="op">==</span> <span class="st">"Zch_Rosengartenstrasse"</span>, <span class="kw">interval</span> <span class="op">==</span> <span class="st">"min30"</span>, <span class="kw">year</span> <span class="op">&gt;</span> <span class="fl">2015</span>)
<span class="co">#&gt; list()</span>

<span class="kw">lokal</span><span class="op">$</span><span class="fu">list_chunks</span>() <span class="op">%&gt;%</span> <span class="kw">dplyr</span>::<span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(<span class="st">"site"</span>, <span class="st">"year"</span>, <span class="st">"interval"</span>)
<span class="co">#&gt; # A tibble: 10 x 3</span>
<span class="co">#&gt;    site                    year  interval</span>
<span class="co">#&gt;    &lt;chr&gt;                   &lt;chr&gt; &lt;chr&gt;   </span>
<span class="co">#&gt;  1 Zch_Rosengartenstrasse  2017  min30   </span>
<span class="co">#&gt;  2 Zch_Rosengartenstrasse  2018  min30   </span>
<span class="co">#&gt;  3 Zch_Rosengartenstrasse  2019  min30   </span>
<span class="co">#&gt;  4 Zch_Rosengartenstrasse  2014  min30   </span>
<span class="co">#&gt;  5 Zch_Rosengartenstrasse  2015  min30   </span>
<span class="co">#&gt;  6 Zch_Rosengartenstrasse  2016  min30   </span>
<span class="co">#&gt;  7 Zch_Stampfenbachstrasse 2014  min30   </span>
<span class="co">#&gt;  8 Zch_Stampfenbachstrasse 2015  min30   </span>
<span class="co">#&gt;  9 Zch_Schimmelstrasse     2014  min30   </span>
<span class="co">#&gt; 10 Zch_Schimmelstrasse     2015  min30</span>
</pre></div>
</div>
<div id="eigene-daten-in-einem-lokalen-store" class="section level2">
<h2 class="hasAnchor">
<a href="#eigene-daten-in-einem-lokalen-store" class="anchor"></a>Eigene Daten in einem lokalen Store</h2>
<p>Der aqmet S3 Store enthält nur bereinigte Daten von abgeschlossenen Jahren. Werden Daten benötigt, die nicht in S3 vorhanden sind, bietet sich die Nutzung eines seperaten lokalen Stores an:</p>
<div class="sourceCode" id="cb16"><pre class="downlit">
<span class="kw">my_store</span> <span class="op">=</span> <span class="fu"><a href="../../reference/r6_storage_local.html">storage_local_rds</a></span>(<span class="st">"eigene_daten"</span>, <span class="fu"><a href="../../reference/format_rolf.html">format_rolf</a></span>(), read.only = <span class="fl">FALSE</span>)
<span class="co">#&gt; Local store eigene_daten initialized under 'C:\Users\tom\AppData\Local\rOstluft\eigene_daten'</span>
</pre></div>
<p>In diesen kann man nun Daten mit der Store Funktion <code>$put()</code> oder der Hilfsfunktion <code><a href="../../reference/import_directory.html">import_directory()</a></code> importieren:</p>
<div class="sourceCode" id="cb17"><pre class="downlit">
<span class="kw">examples_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span>(<span class="st">"extdata"</span>, package = <span class="st">"rOstluft.data"</span>)
<span class="fu"><a href="../../reference/import_directory.html">import_directory</a></span>(<span class="kw">my_store</span>, <span class="kw">examples_path</span>, <span class="kw">read_airmo_csv</span>, glob = <span class="st">"*Jan.csv"</span>)
<span class="co">#&gt; Importing 'D:/tom/Documents/R/win-library/3.6/rOstluft.data/extdata/Zch_Stampfenbachstrasse_d1_2013_Jan.csv' with size 25.5K. File 1 of 3</span>
<span class="co">#&gt; Read 'D:/tom/Documents/R/win-library/3.6/rOstluft.data/extdata/Zch_Stampfenbachstrasse_d1_2013_Jan.csv' in 0.35 seconds. Got 2170 data points</span>
<span class="co">#&gt; First put to storage. Save columns types to C:/Users/tom/AppData/Local/rOstluft/eigene_daten/columns.rds</span>
<span class="co">#&gt; Put data into store eigene_daten in 0.11 seconds</span>
<span class="co">#&gt; Importing 'D:/tom/Documents/R/win-library/3.6/rOstluft.data/extdata/Zch_Stampfenbachstrasse_h1_2013_Jan.csv' with size 143K. File 2 of 3</span>
<span class="co">#&gt; Read 'D:/tom/Documents/R/win-library/3.6/rOstluft.data/extdata/Zch_Stampfenbachstrasse_h1_2013_Jan.csv' in 0.06 seconds. Got 14116 data points</span>
<span class="co">#&gt; Put data into store eigene_daten in 0.13 seconds</span>
<span class="co">#&gt; Importing 'D:/tom/Documents/R/win-library/3.6/rOstluft.data/extdata/Zch_Stampfenbachstrasse_min30_2013_Jan.csv' with size 259K. File 3 of 3</span>
<span class="co">#&gt; Read 'D:/tom/Documents/R/win-library/3.6/rOstluft.data/extdata/Zch_Stampfenbachstrasse_min30_2013_Jan.csv' in 0.07 seconds. Got 28234 data points</span>
<span class="co">#&gt; Put data into store eigene_daten in 0.11 seconds</span>
<span class="co">#&gt; Finished import after 0.83 seconds</span>

<span class="kw">fn</span> <span class="op">&lt;-</span> <span class="kw">fs</span>::<span class="fu"><a href="http://fs.r-lib.org/reference/path.html">path</a></span>(<span class="kw">examples_path</span>, <span class="st">"Zch_Rosengartenstrasse_2010-2014.csv"</span>)
<span class="kw">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/read_airmo_csv.html">read_airmo_csv</a></span>(<span class="kw">fn</span>)
<span class="kw">my_store</span><span class="op">$</span><span class="fu">put</span>(<span class="kw">data</span>)
<span class="co">#&gt; # A tibble: 18 x 6</span>
<span class="co">#&gt;     year interval site                   parameter unit      n</span>
<span class="co">#&gt;    &lt;dbl&gt; &lt;fct&gt;    &lt;fct&gt;                  &lt;fct&gt;     &lt;fct&gt; &lt;int&gt;</span>
<span class="co">#&gt;  1  2013 min30    Zch_Rosengartenstrasse NO        µg/m3  4269</span>9
<span class="co">#&gt;  2  2013 min30    Zch_Rosengartenstrasse NO2       µg/m3  4269</span>9
<span class="co">#&gt;  3  2013 min30    Zch_Rosengartenstrasse NOx       ppb    4269</span>
<span class="co">#&gt;  4  2013 min30    Zch_Rosengartenstrasse O3        µg/m3  4277</span>7
<span class="co">#&gt;  5  2013 min30    Zch_Rosengartenstrasse PM10      µg/m3  4025</span>5
<span class="co">#&gt;  6  2013 min30    Zch_Rosengartenstrasse Hr        %Hr    4010</span>
<span class="co">#&gt;  7  2013 min30    Zch_Rosengartenstrasse p         hPa    4291</span>
<span class="co">#&gt;  8  2013 min30    Zch_Rosengartenstrasse RainDur   min    4291</span>
<span class="co">#&gt;  9  2013 min30    Zch_Rosengartenstrasse T         °C     4010</span>0
<span class="co">#&gt; 10  2014 min30    Zch_Rosengartenstrasse NO        µg/m3 17415</span>5
<span class="co">#&gt; 11  2014 min30    Zch_Rosengartenstrasse NO2       µg/m3 17415</span>5
<span class="co">#&gt; 12  2014 min30    Zch_Rosengartenstrasse NOx       ppb   17415</span>
<span class="co">#&gt; 13  2014 min30    Zch_Rosengartenstrasse O3        µg/m3 17366</span>6
<span class="co">#&gt; 14  2014 min30    Zch_Rosengartenstrasse PM10      µg/m3 16788</span>8
<span class="co">#&gt; 15  2014 min30    Zch_Rosengartenstrasse Hr        %Hr   17517</span>
<span class="co">#&gt; 16  2014 min30    Zch_Rosengartenstrasse p         hPa   17519</span>
<span class="co">#&gt; 17  2014 min30    Zch_Rosengartenstrasse RainDur   min   17519</span>
<span class="co">#&gt; 18  2014 min30    Zch_Rosengartenstrasse T         °C    17517</span>7
</pre></div>
<p>Wie gewohnt kann erhält man mit <code>$get_content()</code> eine Übersicht und die Daten mit <code>$get()</code>:</p>
<div class="sourceCode" id="cb18"><pre class="downlit">
<span class="kw">my_store</span><span class="op">$</span><span class="fu">get_content</span>()
<span class="co">#&gt; # A tibble: 126 x 6</span>
<span class="co">#&gt;     year interval site                   parameter unit      n</span>
<span class="co">#&gt;    &lt;dbl&gt; &lt;fct&gt;    &lt;fct&gt;                  &lt;fct&gt;     &lt;fct&gt; &lt;int&gt;</span>
<span class="co">#&gt;  1  2014 min30    Zch_Rosengartenstrasse NO        µg/m3 17415</span>5
<span class="co">#&gt;  2  2014 min30    Zch_Rosengartenstrasse NO2       µg/m3 17415</span>5
<span class="co">#&gt;  3  2014 min30    Zch_Rosengartenstrasse NOx       ppb   17415</span>
<span class="co">#&gt;  4  2014 min30    Zch_Rosengartenstrasse O3        µg/m3 17366</span>6
<span class="co">#&gt;  5  2014 min30    Zch_Rosengartenstrasse PM10      µg/m3 16788</span>8
<span class="co">#&gt;  6  2014 min30    Zch_Rosengartenstrasse Hr        %Hr   17517</span>
<span class="co">#&gt;  7  2014 min30    Zch_Rosengartenstrasse p         hPa   17519</span>
<span class="co">#&gt;  8  2014 min30    Zch_Rosengartenstrasse RainDur   min   17519</span>
<span class="co">#&gt;  9  2014 min30    Zch_Rosengartenstrasse T         °C    17517</span>7
<span class="co">#&gt; 10  2013 min30    Zch_Rosengartenstrasse NO        µg/m3  4269</span>9
<span class="co">#&gt; # ... with 116 more rows</span>

<span class="kw">my_store</span><span class="op">$</span><span class="fu"><a href="https://rdrr.io/r/base/get.html">get</a></span>(site = <span class="st">"Zch_Stampfenbachstrasse"</span>, interval = <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"d1"</span>, <span class="st">"h1"</span>), year = <span class="fl">2013</span>)  <span class="op">%&gt;%</span>
  <span class="kw">dplyr</span>::<span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span>(<span class="kw">.data</span><span class="op">$</span><span class="kw">starttime</span>, <span class="kw">.data</span><span class="op">$</span><span class="kw">parameter</span>)
<span class="co">#&gt; # A tibble: 16,286 x 6</span>
<span class="co">#&gt;    starttime           site                    parameter   interval unit   value</span>
<span class="co">#&gt;    &lt;dttm&gt;              &lt;fct&gt;                   &lt;fct&gt;       &lt;fct&gt;    &lt;fct&gt;  &lt;dbl&gt;</span>
<span class="co">#&gt;  1 2013-01-01 00:00:00 Zch_Stampfenbachstrasse CO          d1       mg/m3  0.381</span>
<span class="co">#&gt;  2 2013-01-01 00:00:00 Zch_Stampfenbachstrasse CO          d1       ppm    0.327</span>
<span class="co">#&gt;  3 2013-01-01 00:00:00 Zch_Stampfenbachstrasse CO          h1       mg/m3  0.805</span>
<span class="co">#&gt;  4 2013-01-01 00:00:00 Zch_Stampfenbachstrasse CO          h1       ppm    0.692</span>
<span class="co">#&gt;  5 2013-01-01 00:00:00 Zch_Stampfenbachstrasse CO_max_min~ d1       mg/m3  0.966</span>
<span class="co">#&gt;  6 2013-01-01 00:00:00 Zch_Stampfenbachstrasse CO_min_min~ d1       mg/m3  0.190</span>
<span class="co">#&gt;  7 2013-01-01 00:00:00 Zch_Stampfenbachstrasse CO_nb_min30 d1       1     48    </span>
<span class="co">#&gt;  8 2013-01-01 00:00:00 Zch_Stampfenbachstrasse Hr          d1       %Hr   76.0  </span>
<span class="co">#&gt;  9 2013-01-01 00:00:00 Zch_Stampfenbachstrasse Hr          h1       %Hr   82.9  </span>
<span class="co">#&gt; 10 2013-01-01 00:00:00 Zch_Stampfenbachstrasse Hr_max_min~ d1       %Hr   88.4  </span>
<span class="co">#&gt; # ... with 16,276 more rows</span>
</pre></div>
</div>
</div>
<div id="einlesefunktionen-von-daten" class="section level1">
<h1 class="hasAnchor">
<a href="#einlesefunktionen-von-daten" class="anchor"></a>Einlesefunktionen von Daten</h1>
<p>Um Daten in R einzulesen exisitieren für folgende Quellen bereits Funktionen:</p>
<ul>
<li>Ostluft: <code><a href="../../reference/read_airmo_csv.html">read_airmo_csv()</a></code> und <code><a href="../../reference/read_airmo_dat.html">read_airmo_dat()</a></code> für Exporte aus der AIRMO</li>
<li>MeteoSchweiz: <code><a href="../../reference/read_smn.html">read_smn()</a></code> und <code><a href="../../reference/read_smn_multiple.html">read_smn_multiple()</a></code> für SwissMetNet Exporte</li>
<li>ETHZ/IAC: <code><a href="../../reference/read_ethz_iac.html">read_ethz_iac()</a></code> Meteo Stationen auf dem Hönggerberg und dem Hauptgebäude CHN</li>
</ul>
<p>Existiert für die vorliegenden Daten keine Funktion und man möchte die selber schreiben an dieser Stelle einige Hinweise und Tipps.</p>
<div id="verwende-readr-funktionen-und-definiere-die-zeichenkodierung" class="section level2">
<h2 class="hasAnchor">
<a href="#verwende-readr-funktionen-und-definiere-die-zeichenkodierung" class="anchor"></a>Verwende readr Funktionen und definiere die Zeichenkodierung</h2>
<p>Ein generelles Problem beim einlesen von Textdateien ist die <a href="https://de.wikipedia.org/wiki/Zeichenkodierung">Zeichenkodierung</a>. Die meisten haben vermutlich “�” schon in Texten gesehen. Alle Daten im aqmet Store und alle Rückgabewerte von <code>read_xxx()</code> Funktionen sind UTF-8 kodiert. Mit dem <a href="https://readr.tidyverse.org/index.html">readr Packages</a> wird bei korrekter Definition der <a href="https://readr.tidyverse.org/articles/locales.html#character">Locale</a> der Text automatisch zu UTF-8 konvertiert. Im Gegensatz zu den R Base Funktionen oder<code><a href="https://Rdatatable.gitlab.io/data.table/reference/fread.html">data.table::fread()</a></code>.</p>
</div>
<div id="ausgabeformat-rolf" class="section level2">
<h2 class="hasAnchor">
<a href="#ausgabeformat-rolf" class="anchor"></a>Ausgabeformat rolf</h2>
<p>Für ein reibungsloses Zusammenspiel mit den Stores zu garantieren muss das Format rolf eingehalten werden. rolf setzt einen tibble mit folgenden Spalten und Klassen voraus:</p>
<table class="table">
<thead><tr class="header">
<th>Spalte</th>
<th>Klasse</th>
</tr></thead>
<tbody>
<tr class="odd">
<td><strong>“starttime”</strong></td>
<td>POSIXct</td>
</tr>
<tr class="even">
<td><strong>“site”</strong></td>
<td>factor</td>
</tr>
<tr class="odd">
<td><strong>“parameter”</strong></td>
<td>factor</td>
</tr>
<tr class="even">
<td><strong>“interval”</strong></td>
<td>factor</td>
</tr>
<tr class="odd">
<td><strong>“unit”</strong></td>
<td>factor</td>
</tr>
<tr class="even">
<td><strong>“value”</strong></td>
<td>double</td>
</tr>
</tbody>
</table>
<p>Selbst wenn in der Datei keine Einheiten enthalten sind, ist es besser die Spalte unit mit NA zu initialisieren. Ein weiterer Trick ist es die Spalten am Ende explizit zu selektionieren. Hier ein Beispiel, wie es in <code><a href="../../reference/read_smn.html">read_smn()</a></code> gelöst ist:</p>
<div class="sourceCode" id="cb19"><pre class="downlit">
<span class="kw">data</span> <span class="op">&lt;-</span> <span class="kw">dplyr</span>::<span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="kw">data</span>,
  stn = <span class="kw">forcats</span>::<span class="fu"><a href="https://forcats.tidyverse.org/reference/as_factor.html">as_factor</a></span>(<span class="kw">.data</span><span class="op">$</span><span class="kw">stn</span>),
  parameter = <span class="kw">forcats</span>::<span class="fu"><a href="https://forcats.tidyverse.org/reference/as_factor.html">as_factor</a></span>(<span class="kw">.data</span><span class="op">$</span><span class="kw">parameter</span>),
  interval = <span class="kw">forcats</span>::<span class="fu"><a href="https://forcats.tidyverse.org/reference/as_factor.html">as_factor</a></span>(<span class="kw">interval</span>),
  unit = <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span>(<span class="fl">NA</span>)
)
<span class="kw">dplyr</span>::<span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(<span class="kw">data</span>, starttime = <span class="st">"time"</span>, site = <span class="st">"stn"</span>, <span class="st">"parameter"</span>, <span class="st">"interval"</span>, <span class="st">"unit"</span>, <span class="st">"value"</span>)
</pre></div>
<p>Mit dem <code><a href="https://dplyr.tidyverse.org/reference/select.html">dplyr::select</a></code> am Ende ist man sicher nur die Spalten in der Rückgabe zu haben die man haben will und es ist einfach noch Spalten umzubenennen und die Reihenfolge zu ändern.</p>
</div>
</div>
<div id="zusammenfügen-von-daten-im-rolf-format" class="section level1">
<h1 class="hasAnchor">
<a href="#zusammenf%C3%BCgen-von-daten-im-rolf-format" class="anchor"></a>Zusammenfügen von Daten im rolf Format</h1>
<p>Die Verwendung von Factoren im rolf Format hat seine Vor- und Nachteile. Der Hauptvorteil liegt bei schnelleren Lese- und Schreiboperation, der grösste Nachteil beim Zusammenfügen der Daten. <code><a href="https://dplyr.tidyverse.org/reference/bind.html">dplyr::bind_rows</a></code> wird die Factoren in Characters umwandeln, wenn unterschiedliche Levels in den Daten vorhanden sind. Die Funktion <code><a href="../../reference/bind_rows_with_factor_columns.html">bind_rows_with_factor_columns()</a></code> führt das Zusammenfügen korrekt aus. Sie unterstützt ausserdem <a href="https://rlang.r-lib.org/reference/quasiquotation.html">Quasiquotation</a> von rlang<a href="#fn2" class="footnote-ref" id="fnref2"><sup>2</sup></a>. Somit kann auch eine grosse Liste von tibbles im rolf Format komfortable aneinander gefügt werden:</p>
<div class="sourceCode" id="cb20"><pre class="downlit">
<span class="kw">df1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/read_airmo_csv.html">read_airmo_csv</a></span>(<span class="kw">fs</span>::<span class="fu"><a href="http://fs.r-lib.org/reference/path.html">path</a></span>(<span class="kw">examples_path</span>, <span class="st">"Zch_Stampfenbachstrasse_h1_2013_Jan.csv"</span>))
<span class="kw">df2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/read_airmo_csv.html">read_airmo_csv</a></span>(<span class="kw">fs</span>::<span class="fu"><a href="http://fs.r-lib.org/reference/path.html">path</a></span>(<span class="kw">examples_path</span>, <span class="st">"Zch_Stampfenbachstrasse_d1_2013_Jan.csv"</span>))
<span class="kw">df_comb</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/bind_rows_with_factor_columns.html">bind_rows_with_factor_columns</a></span>(<span class="kw">df1</span>, <span class="kw">df2</span>)
<span class="kw">df_comb</span> <span class="op">%&gt;%</span> <span class="kw">dplyr</span>::<span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span>(<span class="kw">.data</span><span class="op">$</span><span class="kw">starttime</span>, <span class="kw">.data</span><span class="op">$</span><span class="kw">parameter</span>)
<span class="co">#&gt; # A tibble: 16,286 x 6</span>
<span class="co">#&gt;    starttime           site                    parameter interval unit   value</span>
<span class="co">#&gt;    &lt;dttm&gt;              &lt;fct&gt;                   &lt;fct&gt;     &lt;fct&gt;    &lt;fct&gt;  &lt;dbl&gt;</span>
<span class="co">#&gt;  1 2013-01-01 00:00:00 Zch_Stampfenbachstrasse CO        h1       mg/m3  0.805</span>
<span class="co">#&gt;  2 2013-01-01 00:00:00 Zch_Stampfenbachstrasse CO        h1       ppm    0.692</span>
<span class="co">#&gt;  3 2013-01-01 00:00:00 Zch_Stampfenbachstrasse CO        d1       mg/m3  0.381</span>
<span class="co">#&gt;  4 2013-01-01 00:00:00 Zch_Stampfenbachstrasse CO        d1       ppm    0.327</span>
<span class="co">#&gt;  5 2013-01-01 00:00:00 Zch_Stampfenbachstrasse Hr        h1       %Hr   82.9  </span>
<span class="co">#&gt;  6 2013-01-01 00:00:00 Zch_Stampfenbachstrasse Hr        d1       %Hr   76.0  </span>
<span class="co">#&gt;  7 2013-01-01 00:00:00 Zch_Stampfenbachstrasse NO        h1       µg/m3 80.5  </span> 
<span class="co">#&gt;  8 2013-01-01 00:00:00 Zch_Stampfenbachstrasse NO        h1       ppb   64.6  </span>
<span class="co">#&gt;  9 2013-01-01 00:00:00 Zch_Stampfenbachstrasse NO        d1       µg/m3 17.6  </span> 
<span class="co">#&gt; 10 2013-01-01 00:00:00 Zch_Stampfenbachstrasse NO        d1       ppb   14.1  </span>
<span class="co">#&gt; # ... with 16,276 more rows</span>

<span class="co"># liste mit 20+ tibbles</span>
<span class="kw">df_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/read_smn_multiple.html">read_smn_multiple</a></span>(<span class="kw">fs</span>::<span class="fu"><a href="http://fs.r-lib.org/reference/path.html">path</a></span>(<span class="kw">examples_path</span>, <span class="st">"smn_multi.txt"</span>), as_list = <span class="fl">TRUE</span>)
<span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="kw">df_list</span>)
<span class="co">#&gt; [1] 28</span>
<span class="kw">df_comb</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/bind_rows_with_factor_columns.html">bind_rows_with_factor_columns</a></span>(<span class="op">!</span><span class="op">!</span><span class="op">!</span><span class="kw">df_list</span>)
<span class="kw">df_comb</span> <span class="op">%&gt;%</span> <span class="kw">dplyr</span>::<span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span>(<span class="kw">.data</span><span class="op">$</span><span class="kw">starttime</span>, <span class="kw">.data</span><span class="op">$</span><span class="kw">parameter</span>)
<span class="co">#&gt; # A tibble: 1,399 x 6</span>
<span class="co">#&gt;    starttime           site  parameter interval unit  value</span>
<span class="co">#&gt;    &lt;dttm&gt;              &lt;fct&gt; &lt;fct&gt;     &lt;fct&gt;    &lt;fct&gt; &lt;dbl&gt;</span>
<span class="co">#&gt;  1 2010-01-01 00:00:00 KLO   dkl010b0  h1       &lt;NA&gt;  319  </span>
<span class="co">#&gt;  2 2010-01-01 00:00:00 KLO   fkl010b0  h1       &lt;NA&gt;    1.5</span>
<span class="co">#&gt;  3 2010-01-01 00:00:00 KLO   gre000b0  h1       &lt;NA&gt;    0  </span>
<span class="co">#&gt;  4 2010-01-01 00:00:00 KLO   tre200b0  h1       &lt;NA&gt;    2.3</span>
<span class="co">#&gt;  5 2010-01-01 00:00:00 UEB   dk1towb0  h1       &lt;NA&gt;  249  </span>
<span class="co">#&gt;  6 2010-01-01 00:00:00 UEB   fk1towb0  h1       &lt;NA&gt;    1.7</span>
<span class="co">#&gt;  7 2010-01-01 00:00:00 UEB   ta1towb0  h1       &lt;NA&gt;    3.7</span>
<span class="co">#&gt;  8 2010-01-01 01:00:00 KLO   dkl010b0  h1       &lt;NA&gt;  317  </span>
<span class="co">#&gt;  9 2010-01-01 01:00:00 KLO   fkl010b0  h1       &lt;NA&gt;    1.7</span>
<span class="co">#&gt; 10 2010-01-01 01:00:00 KLO   gre000b0  h1       &lt;NA&gt;    0  </span>
<span class="co">#&gt; # ... with 1,389 more rows</span>
</pre></div>
<p><code><a href="../../reference/bind_rows_with_factor_columns.html">bind_rows_with_factor_columns()</a></code> entfernt jedoch keine Duplikate aus den Daten. Es hängt die Daten einfach aneinander. Möchte man Duplikate entfernen, bzw. Daten aktualisieren mit neueren Daten muss man die Funktion <code>$merge()</code> des Format Objekts benützen. Dieses wurde beim Erzeugen des Store direkt initialisiert und ist als Feld <code>$format</code> verfügbar. Alternativ kann ein seperates Format Objekt erzeugt werden. Die Daten im ersten Datenframe werden über Daten im zweiten Datenframe priorisiert.</p>
<div class="sourceCode" id="cb21"><pre class="downlit">
<span class="co"># kopiere Daten und setze einige NA -&gt; Resultat sollte NA enthalten</span>
<span class="kw">df1</span> <span class="op">&lt;-</span> <span class="kw">df2</span>
<span class="kw">df1</span><span class="op">$</span><span class="kw">value</span>[<span class="fl">1</span><span class="op">:</span><span class="fl">150</span>] <span class="op">&lt;-</span> <span class="fl">NA</span>

<span class="kw">df_comb</span> <span class="op">&lt;-</span> <span class="kw">store</span><span class="op">$</span><span class="kw">format</span><span class="op">$</span><span class="fu"><a href="https://rdrr.io/r/base/merge.html">merge</a></span>(<span class="kw">df1</span>, <span class="kw">df2</span>)
<span class="kw">df_comb</span> <span class="op">%&gt;%</span> <span class="kw">dplyr</span>::<span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span>(<span class="kw">.data</span><span class="op">$</span><span class="kw">starttime</span>, <span class="kw">.data</span><span class="op">$</span><span class="kw">parameter</span>)
<span class="co">#&gt; # A tibble: 2,170 x 6</span>
<span class="co">#&gt;    starttime           site                    parameter    interval unit  value</span>
<span class="co">#&gt;    &lt;dttm&gt;              &lt;fct&gt;                   &lt;fct&gt;        &lt;fct&gt;    &lt;fct&gt; &lt;dbl&gt;</span>
<span class="co">#&gt;  1 2013-01-01 00:00:00 Zch_Stampfenbachstrasse CO           d1       mg/m3  NA  </span>
<span class="co">#&gt;  2 2013-01-01 00:00:00 Zch_Stampfenbachstrasse CO           d1       ppm    NA  </span>
<span class="co">#&gt;  3 2013-01-01 00:00:00 Zch_Stampfenbachstrasse CO_max_min30 d1       mg/m3  NA  </span>
<span class="co">#&gt;  4 2013-01-01 00:00:00 Zch_Stampfenbachstrasse CO_min_min30 d1       mg/m3  NA  </span>
<span class="co">#&gt;  5 2013-01-01 00:00:00 Zch_Stampfenbachstrasse CO_nb_min30  d1       1      NA  </span>
<span class="co">#&gt;  6 2013-01-01 00:00:00 Zch_Stampfenbachstrasse Hr           d1       %Hr    76.0</span>
<span class="co">#&gt;  7 2013-01-01 00:00:00 Zch_Stampfenbachstrasse Hr_max_min30 d1       %Hr    88.4</span>
<span class="co">#&gt;  8 2013-01-01 00:00:00 Zch_Stampfenbachstrasse Hr_min_min30 d1       %Hr    50.3</span>
<span class="co">#&gt;  9 2013-01-01 00:00:00 Zch_Stampfenbachstrasse Hr_nb_min30  d1       1      48  </span>
<span class="co">#&gt; 10 2013-01-01 00:00:00 Zch_Stampfenbachstrasse NO           d1       µg/m3  17.6</span>6
<span class="co">#&gt; # ... with 2,160 more rows</span>

<span class="kw">rolf</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/format_rolf.html">format_rolf</a></span>()
<span class="kw">df_comb</span> <span class="op">&lt;-</span> <span class="kw">rolf</span><span class="op">$</span><span class="fu"><a href="https://rdrr.io/r/base/merge.html">merge</a></span>(<span class="kw">df1</span>, <span class="kw">df2</span>)
<span class="kw">df_comb</span> <span class="op">%&gt;%</span> <span class="kw">dplyr</span>::<span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span>(<span class="kw">.data</span><span class="op">$</span><span class="kw">starttime</span>, <span class="kw">.data</span><span class="op">$</span><span class="kw">parameter</span>)
<span class="co">#&gt; # A tibble: 2,170 x 6</span>
<span class="co">#&gt;    starttime           site                    parameter    interval unit  value</span>
<span class="co">#&gt;    &lt;dttm&gt;              &lt;fct&gt;                   &lt;fct&gt;        &lt;fct&gt;    &lt;fct&gt; &lt;dbl&gt;</span>
<span class="co">#&gt;  1 2013-01-01 00:00:00 Zch_Stampfenbachstrasse CO           d1       mg/m3  NA  </span>
<span class="co">#&gt;  2 2013-01-01 00:00:00 Zch_Stampfenbachstrasse CO           d1       ppm    NA  </span>
<span class="co">#&gt;  3 2013-01-01 00:00:00 Zch_Stampfenbachstrasse CO_max_min30 d1       mg/m3  NA  </span>
<span class="co">#&gt;  4 2013-01-01 00:00:00 Zch_Stampfenbachstrasse CO_min_min30 d1       mg/m3  NA  </span>
<span class="co">#&gt;  5 2013-01-01 00:00:00 Zch_Stampfenbachstrasse CO_nb_min30  d1       1      NA  </span>
<span class="co">#&gt;  6 2013-01-01 00:00:00 Zch_Stampfenbachstrasse Hr           d1       %Hr    76.0</span>
<span class="co">#&gt;  7 2013-01-01 00:00:00 Zch_Stampfenbachstrasse Hr_max_min30 d1       %Hr    88.4</span>
<span class="co">#&gt;  8 2013-01-01 00:00:00 Zch_Stampfenbachstrasse Hr_min_min30 d1       %Hr    50.3</span>
<span class="co">#&gt;  9 2013-01-01 00:00:00 Zch_Stampfenbachstrasse Hr_nb_min30  d1       1      48  </span>
<span class="co">#&gt; 10 2013-01-01 00:00:00 Zch_Stampfenbachstrasse NO           d1       µg/m3  17.6</span>6
<span class="co">#&gt; # ... with 2,160 more rows</span>
</pre></div>
<p>Die <code>$merge()</code> Funktion unterstützt nur 2 Argumente. Muss eine Liste von tibbles gemerget werden muss man <code><a href="https://purrr.tidyverse.org/reference/reduce.html">purrr::reduce()</a></code> benützen. Mit Hilfe des Argument <code>.dir</code> kann man die Priosierung setzen. Mit “forward”" haben die Daten die zuerst in der Liste auftauchen Priorität, mit “backward” die Letzten.</p>
<div class="sourceCode" id="cb22"><pre class="downlit">
<span class="kw">df_comb</span> <span class="op">&lt;-</span> <span class="kw">purrr</span>::<span class="fu"><a href="https://purrr.tidyverse.org/reference/reduce.html">reduce</a></span>(<span class="kw">df_list</span>, <span class="kw">rolf</span><span class="op">$</span><span class="kw">merge</span>, .dir = <span class="st">"forward"</span>)
<span class="kw">df_comb</span> <span class="op">%&gt;%</span> <span class="kw">dplyr</span>::<span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span>(<span class="kw">.data</span><span class="op">$</span><span class="kw">starttime</span>, <span class="kw">.data</span><span class="op">$</span><span class="kw">parameter</span>)
<span class="co">#&gt; # A tibble: 1,399 x 6</span>
<span class="co">#&gt;    starttime           site  parameter interval unit  value</span>
<span class="co">#&gt;    &lt;dttm&gt;              &lt;fct&gt; &lt;fct&gt;     &lt;fct&gt;    &lt;fct&gt; &lt;dbl&gt;</span>
<span class="co">#&gt;  1 2010-01-01 00:00:00 KLO   dkl010b0  h1       &lt;NA&gt;  319  </span>
<span class="co">#&gt;  2 2010-01-01 00:00:00 KLO   fkl010b0  h1       &lt;NA&gt;    1.5</span>
<span class="co">#&gt;  3 2010-01-01 00:00:00 KLO   gre000b0  h1       &lt;NA&gt;    0  </span>
<span class="co">#&gt;  4 2010-01-01 00:00:00 KLO   tre200b0  h1       &lt;NA&gt;    2.3</span>
<span class="co">#&gt;  5 2010-01-01 00:00:00 UEB   dk1towb0  h1       &lt;NA&gt;  249  </span>
<span class="co">#&gt;  6 2010-01-01 00:00:00 UEB   fk1towb0  h1       &lt;NA&gt;    1.7</span>
<span class="co">#&gt;  7 2010-01-01 00:00:00 UEB   ta1towb0  h1       &lt;NA&gt;    3.7</span>
<span class="co">#&gt;  8 2010-01-01 01:00:00 KLO   dkl010b0  h1       &lt;NA&gt;  317  </span>
<span class="co">#&gt;  9 2010-01-01 01:00:00 KLO   fkl010b0  h1       &lt;NA&gt;    1.7</span>
<span class="co">#&gt; 10 2010-01-01 01:00:00 KLO   gre000b0  h1       &lt;NA&gt;    0  </span>
<span class="co">#&gt; # ... with 1,389 more rows</span>
</pre></div>
</div>
<div id="metadaten" class="section level1">
<h1 class="hasAnchor">
<a href="#metadaten" class="anchor"></a>Metadaten</h1>
<p>Daten aus verschiedenen Quellen werden verschiedene Schemen für die Vergabe von Namen haben. MeteoSchweiz zum Beispiel kodiert im Parameter Namen gleichzeitig das Mittelungsinterval:</p>
<table class="table">
<thead><tr class="header">
<th>Parameter</th>
<th>Interval</th>
<th>Messgrösse</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>ta1towb0</td>
<td>Bürgerliche Stundenmittel</td>
<td>Lufttemperatur, Instrument 1</td>
</tr>
<tr class="even">
<td>ta1towh0</td>
<td>Stundenmittel</td>
<td>Lufttemperatur, Instrument 1</td>
</tr>
<tr class="odd">
<td>ta1tows0</td>
<td>Momentanwerte</td>
<td>Lufttemperatur, Instrument 1</td>
</tr>
<tr class="even">
<td>fk1towz0</td>
<td>Zehnminutenmittel</td>
<td>Windgeschwindigkeit skalar, Instrument 1</td>
</tr>
</tbody>
</table>
<p>Um die Bezeichnungen zu normalisieren kommt es zu einem Zusammenspiel von im Store bereitgestellte Daten und der Funktion <code><a href="../../reference/meta_apply.html">meta_apply()</a></code>. Das Store Objekt verfügt über die Funktion <code>$get_meta()</code>, welche im AWS S3 bereitgestellte Metadaten zurück gibt. Wird <code>$get_meta()</code> ohne Argument aufgerufen erhält man eine Liste mit sämtlichen Metadaten im Store. Kennt man bereits den Namen kann man direkt die entsprechenden Metadaten holen:</p>
<div class="sourceCode" id="cb23"><pre class="downlit">
<span class="kw">meta</span> <span class="op">&lt;-</span> <span class="kw">store</span><span class="op">$</span><span class="fu">get_meta</span>()
<span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span>(<span class="kw">meta</span>)
<span class="co">#&gt;  [1] "all"                          "ecmwf"                       </span>
<span class="co">#&gt;  [3] "ethz"                         "hysplit"                     </span>
<span class="co">#&gt;  [5] "hysplit_cluster_trajectories" "meteoschweiz"                </span>
<span class="co">#&gt;  [7] "meteotest"                    "nabel"                       </span>
<span class="co">#&gt;  [9] "ostluft"                      "seepolizei"</span>

<span class="kw">meteoschweiz</span> <span class="op">&lt;-</span> <span class="kw">store</span><span class="op">$</span><span class="fu">get_meta</span>(<span class="st">"meteoschweiz"</span>)
<span class="kw">tibble</span>::<span class="fu"><a href="https://tibble.tidyverse.org/reference/glimpse.html">glimpse</a></span>(<span class="kw">meteoschweiz</span>)
<span class="co">#&gt; List of 1</span>
<span class="co">#&gt;  $ meteoschweiz: tibble [263 x 15] (S3: tbl_df/tbl/data.frame)</span>
<span class="co">#&gt;   ..$ site_short        : chr [1:263] "TAE" "TAE" "TAE" "TAE" ...</span>
<span class="co">#&gt;   ..$ site              : chr [1:263] "Aadorf/Tänikon" "Aadorf/Tänikon" "Aadorf/Tänikon" "Aadorf/Tänikon" ...</span>
<span class="co">#&gt;   ..$ Länge             : chr [1:263] "8°54'" "8°54'" "8°54'" "8°54'" ...</span> ...
<span class="co">#&gt;   ..$ Breite            : chr [1:263] "47°29'" "47°29'" "47°29'" "47°29'" ...</span> ...
<span class="co">#&gt;   ..$ x                 : num [1:263] 2710517 2710517 2710517 2710517 2710517 ...</span>
<span class="co">#&gt;   ..$ y                 : num [1:263] 1259824 1259824 1259824 1259824 1259824 ...</span>
<span class="co">#&gt;   ..$ masl              : num [1:263] 539 539 539 539 539 539 539 539 539 539 ...</span>
<span class="co">#&gt;   ..$ parameter_original: chr [1:263] "tre200s0" "ure200s0" "prestas0" "prestas0" ...</span>
<span class="co">#&gt;   ..$ source            : chr [1:263] "MeteoSchweiz" "MeteoSchweiz" "MeteoSchweiz" "MeteoSchweiz" ...</span>
<span class="co">#&gt;   ..$ unit              : chr [1:263] "°C" "%" "hPa" "hPa" ...</span>.
<span class="co">#&gt;   ..$ Beschreibung      : chr [1:263] "Lufttemperatur" "Relative" "Luftdruck" "Luftdruck" ...</span>
<span class="co">#&gt;   ..$ timezone_original : chr [1:263] "UTC" "UTC" "UTC" "UTC" ...</span>
<span class="co">#&gt;   ..$ site_long         : logi [1:263] NA NA NA NA NA NA ...</span>
<span class="co">#&gt;   ..$ interval          : chr [1:263] "min10" "min10" "min10" "min10" ...</span>
<span class="co">#&gt;   ..$ parameter         : chr [1:263] "T" "Hr" "p" "p" ...</span>
</pre></div>
<p>Die <code><a href="../../reference/meta_apply.html">meta_apply()</a></code> benützt die Metadaten als “Lookup Table”. Es wird folgende Operation ausgeführt:</p>
<div class="sourceCode" id="cb24"><pre class="downlit">
<span class="fu"><a href="../../reference/meta_apply.html">meta_apply</a></span>(<span class="kw">data</span>, <span class="kw">meta</span>, <span class="kw">data_src</span>, <span class="kw">data_dest</span>, <span class="kw">meta_key</span>, <span class="kw">meta_val</span>)

<span class="kw">data</span><span class="op">$</span><span class="kw">data_dest</span> <span class="op">=</span> <span class="kw">meta</span>[<span class="kw">meta</span><span class="op">$</span><span class="kw">meta_key</span> <span class="op">==</span> <span class="kw">data</span><span class="op">$</span><span class="kw">data_src</span>]<span class="op">$</span><span class="kw">meta_val</span>
</pre></div>
<p>Wobei die jeweiligen Spalten jeweils als Argument übergeben werden. Die Funktion verfügt über verschiende Modi um mit fehlenden Einträgen umzugehen. Im folgenden Beispiel werden bei den MeteoSchweiz Daten die “unit” Spalte basierend auf den “parameter” Spalte ausgefüllt. Da die Parameter noch die MeteoSchweiz Bezeichnungen haben müssen wir als Meta Key die Spalte “parameter_original” und “unit” als Value verwenden. Es werden die Daten aus rOstluft.data verwendet. In diesen fehlt in den Metadaten der MeteoSchweiz Parameter rre150z0 (Niederschlag). Der Default Modus “strict” stoppt das Script:</p>
<div class="sourceCode" id="cb25"><pre class="downlit">
<span class="kw">meteoschweiz</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">readRDS</a></span>(<span class="kw">fs</span>::<span class="fu"><a href="http://fs.r-lib.org/reference/path.html">path</a></span>(<span class="kw">examples_path</span>, <span class="st">"meta_smn.rds"</span>))
<span class="kw">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/read_smn.html">read_smn</a></span>(<span class="kw">fs</span>::<span class="fu"><a href="http://fs.r-lib.org/reference/path.html">path</a></span>(<span class="kw">examples_path</span>, <span class="st">"smn.txt"</span>), na.rm = <span class="fl">FALSE</span>)
<span class="kw">data</span> <span class="op">&lt;-</span> <span class="kw">dplyr</span>::<span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span>(<span class="kw">data</span>, <span class="kw">.data</span><span class="op">$</span><span class="kw">starttime</span>, <span class="kw">.data</span><span class="op">$</span><span class="kw">parameter</span>)
<span class="kw">data</span>
<span class="co">#&gt; # A tibble: 60 x 6</span>
<span class="co">#&gt;    starttime           site  parameter interval unit  value</span>
<span class="co">#&gt;    &lt;dttm&gt;              &lt;fct&gt; &lt;fct&gt;     &lt;fct&gt;    &lt;fct&gt; &lt;dbl&gt;</span>
<span class="co">#&gt;  1 2018-01-01 00:50:00 CHU   dkl010z0  min10    &lt;NA&gt;  216  </span>
<span class="co">#&gt;  2 2018-01-01 00:50:00 CHU   fkl010z0  min10    &lt;NA&gt;    1.7</span>
<span class="co">#&gt;  3 2018-01-01 00:50:00 CHU   fkl010z1  min10    &lt;NA&gt;    3  </span>
<span class="co">#&gt;  4 2018-01-01 00:50:00 CHU   gre000z0  min10    &lt;NA&gt;    5  </span>
<span class="co">#&gt;  5 2018-01-01 00:50:00 CHU   hto000s0  min10    &lt;NA&gt;   NA  </span>
<span class="co">#&gt;  6 2018-01-01 00:50:00 CHU   prestas0  min10    &lt;NA&gt;  946. </span>
<span class="co">#&gt;  7 2018-01-01 00:50:00 CHU   rre150z0  min10    &lt;NA&gt;    0  </span>
<span class="co">#&gt;  8 2018-01-01 00:50:00 CHU   sre000z0  min10    &lt;NA&gt;    0  </span>
<span class="co">#&gt;  9 2018-01-01 00:50:00 CHU   tre200s0  min10    &lt;NA&gt;    2.3</span>
<span class="co">#&gt; 10 2018-01-01 00:50:00 CHU   ure200s0  min10    &lt;NA&gt;   82.7</span>
<span class="co">#&gt; # ... with 50 more rows</span>

<span class="fu"><a href="https://rdrr.io/r/base/conditions.html">tryCatch</a></span>({
  <span class="fu"><a href="../../reference/meta_apply.html">meta_apply</a></span>(<span class="kw">data</span>, <span class="kw">meteoschweiz</span>, <span class="st">"parameter"</span>, <span class="st">"unit"</span>, <span class="st">"parameter_original"</span>, <span class="st">"unit"</span>)
}, error = <span class="fu">function</span>(<span class="kw">e</span>) {
  <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html">sprintf</a></span>(<span class="kw">e</span><span class="op">$</span><span class="kw">message</span>)
})
<span class="co">#&gt; [1] "apply meta data$unit = meta[meta$parameter_original == data$parameter]$unit:\n  missing keys in meta$parameter_original: rre150z0"</span>
</pre></div>
<p>Im einfachsten Fall werden Zeilen mit fehlenden Einträge einfach gelöscht. Dies geschieht mit dem Modus “drop”:</p>
<div class="sourceCode" id="cb26"><pre class="downlit">

<span class="kw">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/meta_apply.html">meta_apply</a></span>(<span class="kw">data</span>, <span class="kw">meteoschweiz</span>, <span class="st">"parameter"</span>, <span class="st">"unit"</span>, <span class="st">"parameter_original"</span>, <span class="st">"unit"</span>, mode = <span class="st">"drop"</span>)
<span class="co">#&gt; Warning in meta_apply(data, meteoschweiz, "parameter", "unit", "parameter_original", : apply meta data$unit = meta[meta$parameter_original == data$parameter]$unit:</span>
<span class="co">#&gt;   missing keys in meta$parameter_original: rre150z0</span>
<span class="co">#&gt;   dropping missing prameters</span>
<span class="kw">df</span>
<span class="co">#&gt; # A tibble: 54 x 6</span>
<span class="co">#&gt;    starttime           site  parameter interval unit  value</span>
<span class="co">#&gt;    &lt;dttm&gt;              &lt;fct&gt; &lt;fct&gt;     &lt;fct&gt;    &lt;fct&gt; &lt;dbl&gt;</span>
<span class="co">#&gt;  1 2018-01-01 00:50:00 CHU   dkl010z0  min10    °     216  </span> 
<span class="co">#&gt;  2 2018-01-01 00:50:00 CHU   fkl010z0  min10    m/s     1.7</span>
<span class="co">#&gt;  3 2018-01-01 00:50:00 CHU   fkl010z1  min10    m/s     3  </span>
<span class="co">#&gt;  4 2018-01-01 00:50:00 CHU   gre000z0  min10    W/m2    5  </span>
<span class="co">#&gt;  5 2018-01-01 00:50:00 CHU   hto000s0  min10    cm     NA  </span>
<span class="co">#&gt;  6 2018-01-01 00:50:00 CHU   prestas0  min10    hPa   946. </span>
<span class="co">#&gt;  7 2018-01-01 00:50:00 CHU   sre000z0  min10    min     0  </span>
<span class="co">#&gt;  8 2018-01-01 00:50:00 CHU   tre200s0  min10    °C      2.3</span>3
<span class="co">#&gt;  9 2018-01-01 00:50:00 CHU   ure200s0  min10    %      82.7</span>
<span class="co">#&gt; 10 2018-01-01 01:00:00 CHU   dkl010z0  min10    °     209  </span> 
<span class="co">#&gt; # ... with 44 more rows</span>
</pre></div>
<p>Sollte der Parameter für spätere Bearbeitung behalten werden, kommt der Modus “keep” zum Zug:</p>
<div class="sourceCode" id="cb27"><pre class="downlit">
<span class="kw">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/meta_apply.html">meta_apply</a></span>(<span class="kw">data</span>, <span class="kw">meteoschweiz</span>, <span class="st">"parameter"</span>, <span class="st">"unit"</span>, <span class="st">"parameter_original"</span>, <span class="st">"unit"</span>, mode = <span class="st">"keep"</span>)
<span class="co">#&gt; Warning in meta_apply(data, meteoschweiz, "parameter", "unit", "parameter_original", : apply meta data$unit = meta[meta$parameter_original == data$parameter]$unit:</span>
<span class="co">#&gt;   missing keys in meta$parameter_original: rre150z0</span>
<span class="co">#&gt;   keeping values: NA</span>
<span class="kw">df</span>
<span class="co">#&gt; # A tibble: 60 x 6</span>
<span class="co">#&gt;    starttime           site  parameter interval unit  value</span>
<span class="co">#&gt;    &lt;dttm&gt;              &lt;fct&gt; &lt;fct&gt;     &lt;fct&gt;    &lt;fct&gt; &lt;dbl&gt;</span>
<span class="co">#&gt;  1 2018-01-01 00:50:00 CHU   dkl010z0  min10    °     216  </span> 
<span class="co">#&gt;  2 2018-01-01 00:50:00 CHU   fkl010z0  min10    m/s     1.7</span>
<span class="co">#&gt;  3 2018-01-01 00:50:00 CHU   fkl010z1  min10    m/s     3  </span>
<span class="co">#&gt;  4 2018-01-01 00:50:00 CHU   gre000z0  min10    W/m2    5  </span>
<span class="co">#&gt;  5 2018-01-01 00:50:00 CHU   hto000s0  min10    cm     NA  </span>
<span class="co">#&gt;  6 2018-01-01 00:50:00 CHU   prestas0  min10    hPa   946. </span>
<span class="co">#&gt;  7 2018-01-01 00:50:00 CHU   rre150z0  min10    &lt;NA&gt;    0  </span>
<span class="co">#&gt;  8 2018-01-01 00:50:00 CHU   sre000z0  min10    min     0  </span>
<span class="co">#&gt;  9 2018-01-01 00:50:00 CHU   tre200s0  min10    °C      2.3</span>3
<span class="co">#&gt; 10 2018-01-01 00:50:00 CHU   ure200s0  min10    %      82.7</span>
<span class="co">#&gt; # ... with 50 more rows</span>
</pre></div>
<p>Mit Hilfe des Modus “replace” kann eine zusätzliche “Lookup Table” übergeben werden. Werte in dieser Tabelle haben Priorität über Werte in der Meta Tabelle. Im Beispiel wird die fehlende Einheit für rre150z0 bereit gestellt und die Einheit für dkl010z0 von ° zu deg überschrieben.</p>
<div class="sourceCode" id="cb28"><pre class="downlit">
<span class="kw">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/meta_apply.html">meta_apply</a></span>(<span class="kw">data</span>, <span class="kw">meteoschweiz</span>, <span class="st">"parameter"</span>, <span class="st">"unit"</span>, <span class="st">"parameter_original"</span>, <span class="st">"unit"</span>,
                 mode = <span class="st">"replace"</span>, replacements = <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(rre150z0 = <span class="st">"mm"</span>, dkl010z0 = <span class="st">"deg"</span>))
<span class="co">#&gt; apply meta data$unit = meta[meta$parameter_original == data$parameter]$unit:</span>
<span class="co">#&gt;   missing keys in meta$parameter_original: rre150z0</span>
<span class="co">#&gt;   replacements used: dkl010z0, rre150z0</span>
<span class="kw">df</span>
<span class="co">#&gt; # A tibble: 60 x 6</span>
<span class="co">#&gt;    starttime           site  parameter interval unit  value</span>
<span class="co">#&gt;    &lt;dttm&gt;              &lt;fct&gt; &lt;fct&gt;     &lt;fct&gt;    &lt;fct&gt; &lt;dbl&gt;</span>
<span class="co">#&gt;  1 2018-01-01 00:50:00 CHU   dkl010z0  min10    deg   216  </span>
<span class="co">#&gt;  2 2018-01-01 00:50:00 CHU   fkl010z0  min10    m/s     1.7</span>
<span class="co">#&gt;  3 2018-01-01 00:50:00 CHU   fkl010z1  min10    m/s     3  </span>
<span class="co">#&gt;  4 2018-01-01 00:50:00 CHU   gre000z0  min10    W/m2    5  </span>
<span class="co">#&gt;  5 2018-01-01 00:50:00 CHU   hto000s0  min10    cm     NA  </span>
<span class="co">#&gt;  6 2018-01-01 00:50:00 CHU   prestas0  min10    hPa   946. </span>
<span class="co">#&gt;  7 2018-01-01 00:50:00 CHU   rre150z0  min10    mm      0  </span>
<span class="co">#&gt;  8 2018-01-01 00:50:00 CHU   sre000z0  min10    min     0  </span>
<span class="co">#&gt;  9 2018-01-01 00:50:00 CHU   tre200s0  min10    °C      2.3</span>3
<span class="co">#&gt; 10 2018-01-01 00:50:00 CHU   ure200s0  min10    %      82.7</span>
<span class="co">#&gt; # ... with 50 more rows</span>
</pre></div>
<p>Hier ein Beispiel für die komplette Überführung der MeteoSchweiz Daten, inkl. manuelle Umbennung von rre150z0 und Änderung der Einheit für die Windrichtung (WD) von ° zu deg:</p>
<div class="sourceCode" id="cb29"><pre class="downlit">
<span class="kw">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/meta_apply.html">meta_apply</a></span>(<span class="kw">data</span>, <span class="kw">meteoschweiz</span>, <span class="st">"parameter"</span>, <span class="st">"unit"</span>, <span class="st">"parameter_original"</span>, <span class="st">"unit"</span>,
                 mode = <span class="st">"replace"</span>, replacements = <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(rre150z0 = <span class="st">"mm"</span>, dkl010z0 = <span class="st">"deg"</span>))
<span class="co">#&gt; apply meta data$unit = meta[meta$parameter_original == data$parameter]$unit:</span>
<span class="co">#&gt;   missing keys in meta$parameter_original: rre150z0</span>
<span class="co">#&gt;   replacements used: dkl010z0, rre150z0</span>

<span class="kw">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/meta_apply.html">meta_apply</a></span>(<span class="kw">df</span>, <span class="kw">meteoschweiz</span>, <span class="st">"parameter"</span>, <span class="st">"parameter"</span>, <span class="st">"parameter_original"</span>, <span class="st">"parameter"</span>,
                 mode = <span class="st">"replace"</span>, replacements = <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(rre150z0 = <span class="st">"Niederschlag"</span>))
<span class="co">#&gt; apply meta data$parameter = meta[meta$parameter_original == data$parameter]$parameter:</span>
<span class="co">#&gt;   missing keys in meta$parameter_original: rre150z0</span>
<span class="co">#&gt;   replacements used: rre150z0</span>

<span class="kw">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/meta_apply.html">meta_apply</a></span>(<span class="kw">df</span>, <span class="kw">meteoschweiz</span>, <span class="st">"site"</span>, <span class="st">"site"</span>, <span class="st">"site_short"</span>, <span class="st">"site"</span>)

<span class="kw">df</span>
<span class="co">#&gt; # A tibble: 60 x 6</span>
<span class="co">#&gt;    starttime           site  parameter    interval unit  value</span>
<span class="co">#&gt;    &lt;dttm&gt;              &lt;fct&gt; &lt;fct&gt;        &lt;fct&gt;    &lt;fct&gt; &lt;dbl&gt;</span>
<span class="co">#&gt;  1 2018-01-01 00:50:00 Chur  WD           min10    deg   216  </span>
<span class="co">#&gt;  2 2018-01-01 00:50:00 Chur  WVs          min10    m/s     1.7</span>
<span class="co">#&gt;  3 2018-01-01 00:50:00 Chur  WVs_max      min10    m/s     3  </span>
<span class="co">#&gt;  4 2018-01-01 00:50:00 Chur  StrGlo       min10    W/m2    5  </span>
<span class="co">#&gt;  5 2018-01-01 00:50:00 Chur  SnowDep      min10    cm     NA  </span>
<span class="co">#&gt;  6 2018-01-01 00:50:00 Chur  p            min10    hPa   946. </span>
<span class="co">#&gt;  7 2018-01-01 00:50:00 Chur  Niederschlag min10    mm      0  </span>
<span class="co">#&gt;  8 2018-01-01 00:50:00 Chur  SunDur       min10    min     0  </span>
<span class="co">#&gt;  9 2018-01-01 00:50:00 Chur  T            min10    °C      2.3</span>3
<span class="co">#&gt; 10 2018-01-01 00:50:00 Chur  Hr           min10    %      82.7</span>
<span class="co">#&gt; # ... with 50 more rows</span>
</pre></div>
</div>
<div id="openair-kompatibles-wide-format" class="section level1">
<h1 class="hasAnchor">
<a href="#openair-kompatibles-wide-format" class="anchor"></a>openair kompatibles Wide Format</h1>
<p>Das Long Format ist nicht für jede Analyse geeignet. Aus diesem Grund enthält rOstluft die Funktionalität Daten im rolf Format in ein <a href="http://davidcarslaw.github.io/openair/">openair</a> kompatibles Wide Format umzuwandeln. Ein Nachteil am Wide Format ist, dass Informationen die zu einer Spalte gehören, wie die Einheit einer Messgrösse, verloren gehen. Dies führt auch dazu, das man nicht die gleiche Messgrösse mit unterschiedlichen Einheiten in den Daten haben kann. Ausser man nennt die Messgrösse um. Die Funktion <code><a href="../../reference/rolf_to_openair.html">rolf_to_openair()</a></code> geht folgende Kompromisse ein: Die Einheiten werden entfernt, aber im Attribute “units” des Datenframes gespeichert. Messgrössen mit der Einheit ppb oder ppm werden ebenfalls entfernt (Dieser Automatismus lässt sich mit dem Argument keep_ppb abschalten). Openair nimmt an, dass alle Messgrössen als Massenkonzentrationen vorliegen. Weitere Konventionen in openair sind das die Zeitinformation in der Spalte “date” als <code>Date</code> oder <code>POSIXct</code> vorliegen, die Windgeschwindigkeit in der Spalte “ws” und die Windrichtung in der Spalte “wd”. Sämtliche Character und Factor Spalten dienen als Gruppierungsspalten. Diese werden von openair ignoriert oder gar entfernt, wenn nicht das Argument type benützt wird. Dieses erlaubt die explizite Nutzung einer Spalte als Gruppierungskriterium. Es können mehrere Gruppierungskriterien getrennt durch ein Komma definiert werden. Die openair Funktion <code><a href="https://rdrr.io/pkg/openair/man/cutData.html">openair::cutData()</a></code> übernimmt die Gruppierung.</p>
<div class="sourceCode" id="cb30"><pre class="downlit">
<span class="kw">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/read_airmo_csv.html">read_airmo_csv</a></span>(<span class="kw">fs</span>::<span class="fu"><a href="http://fs.r-lib.org/reference/path.html">path</a></span>(<span class="kw">examples_path</span>, <span class="st">"Zch_Stampfenbachstrasse_2010-2014.csv"</span>))
<span class="kw">wide</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/rolf_to_openair.html">rolf_to_openair</a></span>(<span class="kw">data</span>)
<span class="kw">tibble</span>::<span class="fu"><a href="https://tibble.tidyverse.org/reference/glimpse.html">glimpse</a></span>(<span class="kw">wide</span>)
<span class="co">#&gt; Rows: 87,626</span>
<span class="co">#&gt; Columns: 16</span>
<span class="co">#&gt; $ date    &lt;dttm&gt; 2010-01-01 00:00:00, 2010-01-01 00:30:00, 2010-01-01 01:00...</span>
<span class="co">#&gt; $ site    &lt;fct&gt; Zch_Stampfenbachstrasse, Zch_Stampfenbachstrasse, Zch_Stamp...</span>
<span class="co">#&gt; $ CO      &lt;dbl&gt; 0.513, 0.609, 0.822, 1.063, 0.861, 0.760, 0.633, 0.666, 0.7...</span>
<span class="co">#&gt; $ NO      &lt;dbl&gt; 9.50, 26.85, 59.95, 85.55, 72.04, 49.74, 26.50, 36.18, 60.3...</span>
<span class="co">#&gt; $ NO2     &lt;dbl&gt; 37.0, 46.5, 54.6, 60.5, 58.8, 52.9, 49.0, 50.9, 56.3, 48.8,...</span>
<span class="co">#&gt; $ NOx     &lt;dbl&gt; 26.9, 45.8, 76.6, 100.2, 88.5, 67.5, 46.9, 55.6, 77.8, 72.6...</span>
<span class="co">#&gt; $ O3      &lt;dbl&gt; 11.812, 7.989, 2.111, 1.410, 2.517, 2.416, 3.606, 1.617, 2....</span>
<span class="co">#&gt; $ PM10    &lt;dbl&gt; 49.7, 82.3, 152.9, 169.2, 190.1, 158.9, 93.0, 54.9, 58.7, 8...</span>
<span class="co">#&gt; $ SO2     &lt;dbl&gt; 2.36, 3.13, 4.19, 4.60, 3.97, 2.71, 2.29, 2.46, 2.86, 3.36,...</span>
<span class="co">#&gt; $ Hr      &lt;dbl&gt; 87.9, 88.6, 91.1, 91.8, 92.0, 92.4, 92.8, 92.0, 90.4, 91.5,...</span>
<span class="co">#&gt; $ p       &lt;dbl&gt; 942, 942, 942, 942, 942, 942, 941, 941, 941, 941, 940, 940,...</span>
<span class="co">#&gt; $ RainDur &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,...</span>
<span class="co">#&gt; $ StrGlo  &lt;dbl&gt; 7.49e-03, 7.27e-03, 1.02e-02, 7.81e-03, 1.22e-02, 1.57e-02,...</span>
<span class="co">#&gt; $ T       &lt;dbl&gt; 5.61, 5.57, 5.35, 5.39, 5.11, 4.81, 4.58, 4.80, 5.38, 5.12,...</span>
<span class="co">#&gt; $ wd      &lt;dbl&gt; 159.57, 147.91, 258.24, 2.90, 27.75, 35.41, 40.24, 164.05, ...</span>
<span class="co">#&gt; $ ws      &lt;dbl&gt; 0.904, 0.314, 0.630, 0.625, 1.905, 2.281, 2.245, 0.846, 0.3...</span>
</pre></div>
<p>Diese Daten können nun direkt in openair verwendet werden:</p>
<div class="sourceCode" id="cb31"><pre class="downlit">
<span class="kw">openair</span>::<span class="fu"><a href="https://rdrr.io/pkg/openair/man/windRose.html">windRose</a></span>(<span class="kw">wide</span>)
</pre></div>
<p><img src="tutorial_files/figure-html/unnamed-chunk-30-1.png" width="700"></p>
<div class="sourceCode" id="cb32"><pre class="downlit">
<span class="kw">openair</span>::<span class="fu"><a href="https://rdrr.io/pkg/openair/man/windRose.html">pollutionRose</a></span>(<span class="kw">wide</span>, <span class="st">"NO2"</span>, type=<span class="st">"year"</span>)
</pre></div>
<p><img src="tutorial_files/figure-html/unnamed-chunk-30-2.png" width="700"></p>
<p><code><a href="../../reference/openair_to_rolf.html">openair_to_rolf()</a></code> konventiert Daten zurück ins rolf Format. Der Nutzer muss die fehlenden Informationen bereitstellen:</p>
<div class="sourceCode" id="cb33"><pre class="downlit">
<span class="fu"><a href="../../reference/openair_to_rolf.html">openair_to_rolf</a></span>(<span class="kw">wide</span>, interval = <span class="st">"min30"</span>, units = <span class="fu"><a href="https://rdrr.io/r/base/attr.html">attr</a></span>(<span class="kw">wide</span>, <span class="st">"units"</span>))
<span class="co">#&gt; # A tibble: 1,226,764 x 6</span>
<span class="co">#&gt;    starttime           site                    parameter interval unit  value</span>
<span class="co">#&gt;    &lt;dttm&gt;              &lt;fct&gt;                   &lt;fct&gt;     &lt;fct&gt;    &lt;fct&gt; &lt;dbl&gt;</span>
<span class="co">#&gt;  1 2010-01-01 00:00:00 Zch_Stampfenbachstrasse CO        min30    mg/m3 0.513</span>
<span class="co">#&gt;  2 2010-01-01 00:30:00 Zch_Stampfenbachstrasse CO        min30    mg/m3 0.609</span>
<span class="co">#&gt;  3 2010-01-01 01:00:00 Zch_Stampfenbachstrasse CO        min30    mg/m3 0.822</span>
<span class="co">#&gt;  4 2010-01-01 01:30:00 Zch_Stampfenbachstrasse CO        min30    mg/m3 1.06 </span>
<span class="co">#&gt;  5 2010-01-01 02:00:00 Zch_Stampfenbachstrasse CO        min30    mg/m3 0.861</span>
<span class="co">#&gt;  6 2010-01-01 02:30:00 Zch_Stampfenbachstrasse CO        min30    mg/m3 0.760</span>
<span class="co">#&gt;  7 2010-01-01 03:00:00 Zch_Stampfenbachstrasse CO        min30    mg/m3 0.633</span>
<span class="co">#&gt;  8 2010-01-01 03:30:00 Zch_Stampfenbachstrasse CO        min30    mg/m3 0.666</span>
<span class="co">#&gt;  9 2010-01-01 04:00:00 Zch_Stampfenbachstrasse CO        min30    mg/m3 0.780</span>
<span class="co">#&gt; 10 2010-01-01 04:30:00 Zch_Stampfenbachstrasse CO        min30    mg/m3 0.654</span>
<span class="co">#&gt; # ... with 1,226,754 more rows</span>
</pre></div>
<p><code><a href="../../reference/rolf_to_openair_single.html">rolf_to_openair_single()</a></code> bietet die Möglichkeit einen bestimmten Parameter rauszupicken:</p>
<div class="sourceCode" id="cb34"><pre class="downlit">
<span class="fu"><a href="../../reference/rolf_to_openair_single.html">rolf_to_openair_single</a></span>(<span class="kw">data</span>, <span class="st">"NO2"</span>, unit = <span class="st">"µg/m3"</span>", keep_interval =<span class="fl">TRUE</span>E)
<span class="co">#&gt; # A tibble: 86,883 x 5</span>
<span class="co">#&gt;    date                site                    interval unit    NO2</span>
<span class="co">#&gt;    &lt;dttm&gt;              &lt;fct&gt;                   &lt;fct&gt;    &lt;fct&gt; &lt;dbl&gt;</span>
<span class="co">#&gt;  1 2010-01-01 00:00:00 Zch_Stampfenbachstrasse min30    µg/m3  37.0</span>0
<span class="co">#&gt;  2 2010-01-01 00:30:00 Zch_Stampfenbachstrasse min30    µg/m3  46.5</span>5
<span class="co">#&gt;  3 2010-01-01 01:00:00 Zch_Stampfenbachstrasse min30    µg/m3  54.6</span>6
<span class="co">#&gt;  4 2010-01-01 01:30:00 Zch_Stampfenbachstrasse min30    µg/m3  60.5</span>5
<span class="co">#&gt;  5 2010-01-01 02:00:00 Zch_Stampfenbachstrasse min30    µg/m3  58.8</span>8
<span class="co">#&gt;  6 2010-01-01 02:30:00 Zch_Stampfenbachstrasse min30    µg/m3  52.9</span>9
<span class="co">#&gt;  7 2010-01-01 03:00:00 Zch_Stampfenbachstrasse min30    µg/m3  49.0</span>0
<span class="co">#&gt;  8 2010-01-01 03:30:00 Zch_Stampfenbachstrasse min30    µg/m3  50.9</span>9
<span class="co">#&gt;  9 2010-01-01 04:00:00 Zch_Stampfenbachstrasse min30    µg/m3  56.3</span>3
<span class="co">#&gt; 10 2010-01-01 04:30:00 Zch_Stampfenbachstrasse min30    µg/m3  48.8</span>8
<span class="co">#&gt; # ... with 86,873 more rows</span>
</pre></div>
<p>Die weitere Optionen für die Funktion <code><a href="../../reference/rolf_to_openair.html">rolf_to_openair()</a></code> sind in der Dokumentation zu finden.</p>
</div>
<div id="berechnung-von-statistiken" class="section level1">
<h1 class="hasAnchor">
<a href="#berechnung-von-statistiken" class="anchor"></a>Berechnung von Statistiken</h1>
<p>Statistiken und die Verdichtung von Daten ist ein grundlegender Bestandteil einer Datenanalyse. In rOstluft gibt es die Funktion <code><a href="../../reference/resample.html">resample()</a></code> zur Berechnung von Statistiken von einem Interval zu einem anderen. Die Funktion <code><a href="../../reference/calculate_statstable.html">calculate_statstable()</a></code> erlaubt die Definition von Berechnungen über mehrere verschiedene Intervale, ist aber weniger flexibel.</p>
<div id="resample" class="section level2">
<h2 class="hasAnchor">
<a href="#resample" class="anchor"></a>resample</h2>
<p><code><a href="../../reference/resample.html">resample()</a></code> aggregiert die Daten in folgenden Schritten:</p>
<ul>
<li>Aufsplitten der Daten in Serien (site, parameter, interval, unit)
<ul>
<li>
<code><a href="../../reference/pad.html">pad_serie()</a></code>: Auffüllen von Lücken mit NA (kann übersprungen werden)</li>
<li>Gruppiere Serie mit neuem Interval mit Hilfe von <code><a href="http://lubridate.tidyverse.org/reference/round_date.html">lubridate::floor_date()</a></code>
</li>
<li>Berechne definierte Statistiken für den Parameter</li>
</ul>
</li>
<li>kombiniere die neu berechneten Serien</li>
</ul>
<div class="sourceCode" id="cb35"><pre class="downlit">
<span class="kw">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/read_airmo_csv.html">read_airmo_csv</a></span>(<span class="kw">fs</span>::<span class="fu"><a href="http://fs.r-lib.org/reference/path.html">path</a></span>(<span class="kw">examples_path</span>, <span class="st">"Zch_Stampfenbachstrasse_min30_2013_Jan.csv"</span>))

<span class="co"># Behalte nur Massenkonzentrationen</span>
<span class="kw">data</span> <span class="op">&lt;-</span> <span class="kw">dplyr</span>::<span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(<span class="kw">data</span>, <span class="op">!</span>(<span class="kw">.data</span><span class="op">$</span><span class="kw">unit</span> <span class="op">==</span> <span class="st">"ppb"</span> <span class="op">|</span> <span class="kw">.data</span><span class="op">$</span><span class="kw">unit</span> <span class="op">==</span> <span class="st">"ppm"</span>))

<span class="kw">statistics</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(
  <span class="st">"default_statistic"</span> = <span class="st">"drop"</span>,
  <span class="st">"O3"</span> = <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="st">"mean"</span>, <span class="st">"perc95"</span>, <span class="st">"n"</span>, <span class="st">"min"</span>, <span class="st">"max"</span>),
  <span class="st">"RainDur"</span> = <span class="st">"sum"</span>,
  <span class="st">"WD"</span> = <span class="st">"wind.direction"</span>,
  <span class="st">"WVs"</span> = <span class="st">"wind.speed_scalar"</span>,
  <span class="st">"WVv"</span> = <span class="st">"wind.speed_vector"</span>
)

<span class="co"># Monatsmittelwerte</span>
<span class="fu"><a href="../../reference/resample.html">resample</a></span>(<span class="kw">data</span>, <span class="kw">statistics</span>, <span class="st">"m1"</span>)
<span class="co">#&gt; # A tibble: 9 x 6</span>
<span class="co">#&gt;   starttime           site                   parameter    interval unit    value</span>
<span class="co">#&gt;   &lt;dttm&gt;              &lt;fct&gt;                  &lt;fct&gt;        &lt;fct&gt;    &lt;fct&gt;   &lt;dbl&gt;</span>
<span class="co">#&gt; 1 2013-01-01 00:00:00 Zch_Stampfenbachstras~ O3           m1       µg/m3 2.12e+1</span>1
<span class="co">#&gt; 2 2013-01-01 00:00:00 Zch_Stampfenbachstras~ O3_95%_min30 m1       µg/m3 6.44e+1</span>1
<span class="co">#&gt; 3 2013-01-01 00:00:00 Zch_Stampfenbachstras~ O3_nb_min30  m1       1     1.49e+3</span>
<span class="co">#&gt; 4 2013-01-01 00:00:00 Zch_Stampfenbachstras~ O3_min_min30 m1       µg/m3 1.04e+0</span>0
<span class="co">#&gt; 5 2013-01-01 00:00:00 Zch_Stampfenbachstras~ O3_max_min30 m1       µg/m3 7.67e+1</span>1
<span class="co">#&gt; 6 2013-01-01 00:00:00 Zch_Stampfenbachstras~ RainDur      m1       min   6.26e+3</span>
<span class="co">#&gt; 7 2013-01-01 00:00:00 Zch_Stampfenbachstras~ WVs          m1       m/s   1.69e+0</span>
<span class="co">#&gt; 8 2013-01-01 00:00:00 Zch_Stampfenbachstras~ WVv          m1       m/s   4.57e-1</span>
<span class="co">#&gt; 9 2013-01-01 00:00:00 Zch_Stampfenbachstras~ WD           m1       °     2.58e+2</span>2

<span class="co"># Tagesmittelwerte</span>
<span class="fu"><a href="../../reference/resample.html">resample</a></span>(<span class="kw">data</span>, <span class="kw">statistics</span>, <span class="st">"d1"</span>) <span class="op">%&gt;%</span>
  <span class="kw">dplyr</span>::<span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span>(<span class="kw">.data</span><span class="op">$</span><span class="kw">starttime</span>)
<span class="co">#&gt; # A tibble: 279 x 6</span>
<span class="co">#&gt;    starttime           site                    parameter   interval unit   value</span>
<span class="co">#&gt;    &lt;dttm&gt;              &lt;fct&gt;                   &lt;fct&gt;       &lt;fct&gt;    &lt;fct&gt;  &lt;dbl&gt;</span>
<span class="co">#&gt;  1 2013-01-01 00:00:00 Zch_Stampfenbachstrasse O3          d1       µg/m3  42.9 </span> 
<span class="co">#&gt;  2 2013-01-01 00:00:00 Zch_Stampfenbachstrasse O3_95%_min~ d1       µg/m3  70.3 </span> 
<span class="co">#&gt;  3 2013-01-01 00:00:00 Zch_Stampfenbachstrasse O3_nb_min30 d1       1      48   </span>
<span class="co">#&gt;  4 2013-01-01 00:00:00 Zch_Stampfenbachstrasse O3_min_min~ d1       µg/m3   2.58</span>8
<span class="co">#&gt;  5 2013-01-01 00:00:00 Zch_Stampfenbachstrasse O3_max_min~ d1       µg/m3  74.1 </span> 
<span class="co">#&gt;  6 2013-01-01 00:00:00 Zch_Stampfenbachstrasse RainDur     d1       min   495.  </span>
<span class="co">#&gt;  7 2013-01-01 00:00:00 Zch_Stampfenbachstrasse WVs         d1       m/s     2.22</span>
<span class="co">#&gt;  8 2013-01-01 00:00:00 Zch_Stampfenbachstrasse WVv         d1       m/s     1.98</span>
<span class="co">#&gt;  9 2013-01-01 00:00:00 Zch_Stampfenbachstrasse WD          d1       °     227.  </span> 
<span class="co">#&gt; 10 2013-01-02 00:00:00 Zch_Stampfenbachstrasse O3          d1       µg/m3  36.0 </span> 
<span class="co">#&gt; # ... with 269 more rows</span>
</pre></div>
<p><code><a href="../../reference/resample.html">resample()</a></code> verfügt über die Funktionalität Datenverfügbarkeit und Lücken mit den Argumenten <code>data_thresh</code> und <code>max_gap</code> zu berücksichtigen:</p>
<div class="sourceCode" id="cb36"><pre class="downlit">
<span class="co"># Jahresmittelwerte nur mit Daten vom Januar</span>
<span class="fu"><a href="../../reference/resample.html">resample</a></span>(<span class="kw">data</span>, <span class="kw">statistics</span>, <span class="st">"y1"</span>)
<span class="co">#&gt; # A tibble: 9 x 6</span>
<span class="co">#&gt;   starttime           site                   parameter    interval unit    value</span>
<span class="co">#&gt;   &lt;dttm&gt;              &lt;fct&gt;                  &lt;fct&gt;        &lt;fct&gt;    &lt;fct&gt;   &lt;dbl&gt;</span>
<span class="co">#&gt; 1 2013-01-01 00:00:00 Zch_Stampfenbachstras~ O3           y1       µg/m3 2.12e+1</span>1
<span class="co">#&gt; 2 2013-01-01 00:00:00 Zch_Stampfenbachstras~ O3_95%_min30 y1       µg/m3 6.44e+1</span>1
<span class="co">#&gt; 3 2013-01-01 00:00:00 Zch_Stampfenbachstras~ O3_nb_min30  y1       1     1.49e+3</span>
<span class="co">#&gt; 4 2013-01-01 00:00:00 Zch_Stampfenbachstras~ O3_min_min30 y1       µg/m3 1.04e+0</span>0
<span class="co">#&gt; 5 2013-01-01 00:00:00 Zch_Stampfenbachstras~ O3_max_min30 y1       µg/m3 7.67e+1</span>1
<span class="co">#&gt; 6 2013-01-01 00:00:00 Zch_Stampfenbachstras~ RainDur      y1       min   6.26e+3</span>
<span class="co">#&gt; 7 2013-01-01 00:00:00 Zch_Stampfenbachstras~ WVs          y1       m/s   1.69e+0</span>
<span class="co">#&gt; 8 2013-01-01 00:00:00 Zch_Stampfenbachstras~ WVv          y1       m/s   4.57e-1</span>
<span class="co">#&gt; 9 2013-01-01 00:00:00 Zch_Stampfenbachstras~ WD           y1       °     2.58e+2</span>2

<span class="co"># Jahresmittelwerte 80% Datenverfügbarkeit =&gt; all NA</span>
<span class="fu"><a href="../../reference/resample.html">resample</a></span>(<span class="kw">data</span>, <span class="kw">statistics</span>, <span class="st">"y1"</span>, data_thresh = <span class="fl">0.8</span>)
<span class="co">#&gt; # A tibble: 9 x 6</span>
<span class="co">#&gt;   starttime           site                    parameter    interval unit  value</span>
<span class="co">#&gt;   &lt;dttm&gt;              &lt;fct&gt;                   &lt;fct&gt;        &lt;fct&gt;    &lt;fct&gt; &lt;dbl&gt;</span>
<span class="co">#&gt; 1 2013-01-01 00:00:00 Zch_Stampfenbachstrasse O3           y1       µg/m3    NA</span>A
<span class="co">#&gt; 2 2013-01-01 00:00:00 Zch_Stampfenbachstrasse O3_95%_min30 y1       µg/m3    NA</span>A
<span class="co">#&gt; 3 2013-01-01 00:00:00 Zch_Stampfenbachstrasse O3_nb_min30  y1       1        NA</span>
<span class="co">#&gt; 4 2013-01-01 00:00:00 Zch_Stampfenbachstrasse O3_min_min30 y1       µg/m3    NA</span>A
<span class="co">#&gt; 5 2013-01-01 00:00:00 Zch_Stampfenbachstrasse O3_max_min30 y1       µg/m3    NA</span>A
<span class="co">#&gt; 6 2013-01-01 00:00:00 Zch_Stampfenbachstrasse RainDur      y1       min      NA</span>
<span class="co">#&gt; 7 2013-01-01 00:00:00 Zch_Stampfenbachstrasse WVs          y1       m/s      NA</span>
<span class="co">#&gt; 8 2013-01-01 00:00:00 Zch_Stampfenbachstrasse WVv          y1       m/s      NA</span>
<span class="co">#&gt; 9 2013-01-01 00:00:00 Zch_Stampfenbachstrasse WD           y1       °        NA</span>A

<span class="co"># Jahresmittelwerte 10 Tage Lücke = 48' 30min Werte =&gt; all NA</span>
<span class="fu"><a href="../../reference/resample.html">resample</a></span>(<span class="kw">data</span>, <span class="kw">statistics</span>, <span class="st">"y1"</span>, max_gap = <span class="fl">480</span>)
<span class="co">#&gt; # A tibble: 9 x 6</span>
<span class="co">#&gt;   starttime           site                    parameter    interval unit  value</span>
<span class="co">#&gt;   &lt;dttm&gt;              &lt;fct&gt;                   &lt;fct&gt;        &lt;fct&gt;    &lt;fct&gt; &lt;dbl&gt;</span>
<span class="co">#&gt; 1 2013-01-01 00:00:00 Zch_Stampfenbachstrasse O3           y1       µg/m3    NA</span>A
<span class="co">#&gt; 2 2013-01-01 00:00:00 Zch_Stampfenbachstrasse O3_95%_min30 y1       µg/m3    NA</span>A
<span class="co">#&gt; 3 2013-01-01 00:00:00 Zch_Stampfenbachstrasse O3_nb_min30  y1       1        NA</span>
<span class="co">#&gt; 4 2013-01-01 00:00:00 Zch_Stampfenbachstrasse O3_min_min30 y1       µg/m3    NA</span>A
<span class="co">#&gt; 5 2013-01-01 00:00:00 Zch_Stampfenbachstrasse O3_max_min30 y1       µg/m3    NA</span>A
<span class="co">#&gt; 6 2013-01-01 00:00:00 Zch_Stampfenbachstrasse RainDur      y1       min      NA</span>
<span class="co">#&gt; 7 2013-01-01 00:00:00 Zch_Stampfenbachstrasse WVs          y1       m/s      NA</span>
<span class="co">#&gt; 8 2013-01-01 00:00:00 Zch_Stampfenbachstrasse WVv          y1       m/s      NA</span>
<span class="co">#&gt; 9 2013-01-01 00:00:00 Zch_Stampfenbachstrasse WD           y1       °        NA</span>A
</pre></div>
<div id="default_statistic" class="section level3">
<h3 class="hasAnchor">
<a href="#default_statistic" class="anchor"></a><code>default_statistic</code>
</h3>
<p>In der Liste werden für jeden Parameter die Statistiken definiert, welche angewendet werden sollen. Der Listeneintrag <code>default_statistic</code> wird auf alle nicht eingetragenen Parameter angewendet. Die Statistik drop schliesst einen Parameter aus den Resultaten aus. Dies erlaubt die schnelle Berechnung von Statistiken für ein paar wenige Parametern. Gleichzeitig ist es auch möglich die gleichen Statistiken auf viele Parameter anzuwenden und ein paar wenige Ausnahmen zu definieren:</p>
<div class="sourceCode" id="cb37"><pre class="downlit">
<span class="kw">statistics</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(
  <span class="st">"default_statistic"</span> = <span class="st">"mean"</span>,
  <span class="st">"RainDur"</span> = <span class="st">"sum"</span>,
  <span class="st">"StrGlo"</span> = <span class="st">"max"</span>,
  <span class="st">"WD"</span> = <span class="st">"drop"</span>,
  <span class="st">"WVv"</span> = <span class="st">"drop"</span>
)

<span class="fu"><a href="../../reference/resample.html">resample</a></span>(<span class="kw">data</span>, <span class="kw">statistics</span>, <span class="st">"m1"</span>)
<span class="co">#&gt; # A tibble: 11 x 6</span>
<span class="co">#&gt;    starttime           site                parameter      interval unit    value</span>
<span class="co">#&gt;    &lt;dttm&gt;              &lt;fct&gt;               &lt;fct&gt;          &lt;fct&gt;    &lt;fct&gt;   &lt;dbl&gt;</span>
<span class="co">#&gt;  1 2013-01-01 00:00:00 Zch_Stampfenbachst~ CO             m1       mg/m3 4.36e-1</span>
<span class="co">#&gt;  2 2013-01-01 00:00:00 Zch_Stampfenbachst~ Hr             m1       %Hr   7.97e+1</span>
<span class="co">#&gt;  3 2013-01-01 00:00:00 Zch_Stampfenbachst~ NO             m1       µg/m3 2.41e+1</span>1
<span class="co">#&gt;  4 2013-01-01 00:00:00 Zch_Stampfenbachst~ NO2            m1       µg/m3 4.04e+1</span>1
<span class="co">#&gt;  5 2013-01-01 00:00:00 Zch_Stampfenbachst~ O3             m1       µg/m3 2.12e+1</span>1
<span class="co">#&gt;  6 2013-01-01 00:00:00 Zch_Stampfenbachst~ p              m1       hPa   9.64e+2</span>
<span class="co">#&gt;  7 2013-01-01 00:00:00 Zch_Stampfenbachst~ PM10           m1       µg/m3 2.63e+1</span>1
<span class="co">#&gt;  8 2013-01-01 00:00:00 Zch_Stampfenbachst~ RainDur        m1       min   6.26e+3</span>
<span class="co">#&gt;  9 2013-01-01 00:00:00 Zch_Stampfenbachst~ SO2            m1       µg/m3 2.54e+0</span>0
<span class="co">#&gt; 10 2013-01-01 00:00:00 Zch_Stampfenbachst~ StrGlo_max_mi~ m1       W/m2  5.12e+2</span>
<span class="co">#&gt; 11 2013-01-01 00:00:00 Zch_Stampfenbachst~ T              m1       °C    2.12e+0</span>0
</pre></div>
</div>
<div id="automatismen-und-einschränkungen" class="section level3">
<h3 class="hasAnchor">
<a href="#automatismen-und-einschr%C3%A4nkungen" class="anchor"></a>Automatismen und Einschränkungen</h3>
<p>Die Funktion benennt für die meisten Statistiken den Parameter gemäss dem AIRMO Schema<a href="#fn3" class="footnote-ref" id="fnref3"><sup>3</sup></a> um. Die Statistiken mean, median, sum, sd, percentile benennen den Paremeter nicht um und sind somit nicht kombinierbar.</p>
<p>Das Auffüllen der Lücken kann mittels des Argument <code>skip_padding</code> übersprungen werden. Zusätzlich kann mittels <code>start_date</code>, <code>end_date</code> und <code>drop_last</code> das Füllen kontrolliert werden. Normalerweise nimmt die Funktion das letzte Datum und füllt bis zum letzten neuen Intervall auf. Werden zum Beispiel Tagesmittelwerte berechnet und es sind nur Daten bis zum 22. Dezember 2017 10:00 Uhr vorhanden, wird der letzte Wert in der Serie 2017-12-22 00:00 sein. Wird eine komplette Jahresreihe benötigt, kann entweder das <code>end_date</code> auf 2017-12-31 oder auf 2018-01-01 und <code>drop_last</code> auf TRUE gesetzt werden.</p>
</div>
<div id="windmittelung" class="section level3">
<h3 class="hasAnchor">
<a href="#windmittelung" class="anchor"></a>Windmittelung</h3>
<p>Ein weiterer Spezialfall sind die Windberechnungen. Für die vektorielle Mittelung müssen die Paremeter zusammengefasst werden. Es müssen für alle drei Statistiken (wind.direction, wind.speed_vector, wind.speed_scalar) die Parameter definiert werden. Ist nur eine der Geschwindigkeiten vorhanden, wird die andere auf Basis der Vorhandenen berechnet. Zusätzlich ist die Windmittelung nicht kombinierbar mit anderen Statistiken.</p>
</div>
</div>
<div id="statstable" class="section level2">
<h2 class="hasAnchor">
<a href="#statstable" class="anchor"></a>Statstable</h2>
<p>Werden viele verschiedene und mehrstufige Statistiken benötigt ist die Berechnung mit <code><a href="../../reference/resample.html">resample()</a></code> umständlich. Die Funktion <code><a href="../../reference/calculate_statstable.html">calculate_statstable()</a></code> hingegen bietet diese Funktionalität, hat aber folgende Einschränkungen:</p>
<ul>
<li>Datenreihen werden immer auf komplette Jahre aufgefüllt</li>
<li>max_gap wird nur auf Berechnungen zu Jahresintervallen berücksichtigt und in <strong>Tagen</strong> definiert</li>
<li>data_thresh ist für alle Berechnungen identisch.</li>
<li>Intervall h8gl erwartet Intervall h1 als Basis</li>
<li>Die Verwendung von <code>default_statistic</code> und <code>_input_</code> führt schnell zu unerwarteten Ergebnissen</li>
</ul>
<p>Zur Analyse von Luftqualität sind diese Einschränkungen kein Problem, bzw. sogar erwünscht. Die Funktion <code><a href="../../reference/calculate_statstable.html">calculate_statstable()</a></code> erwartet wie der Name schon vermuten lässt die Defintion der Statistiken in einer Tabellenform. Die Tabelle hat die vier Spalten “parameter”, “statistic”, “from”, “to”. Jede Zeile enthält eine zu berechnende Statistik für einen Parameter vom Basis Interval (“from”) zum neuen Interval (“to”). Die Tabelle wird dann gruppiert zuerst mit “from”, dann mit “to” und zuletzt mit Parameter. Auf diese Weise wird eine Liste generiert die mit <code><a href="../../reference/resample.html">resample()</a></code> kompatibel ist. Ist keine <code>default_statistic</code> definiert wird automatisch <code>default_statistic = "drop"</code> zur Liste hinzugefügt. In welcher Reihenfolge die verschiedenen “from” Intervalle berechnet werden, kann optional mit Hilfe des Argument order definiert werden. Der Default Wert ist <code><a href="https://rdrr.io/r/base/c.html">c("input", "h1", "h8gl", "d1", "m1", "y1")</a></code>. Um die Tabelle in einer kompakten Form zu erstellen kann in jeder Zelle mehrere Werte getrennt durch “,” zusammengefasst werden. Hier die Tabelle zur Berechnung der LRV Grenzwerte aus 30min Werten (entspricht 6 Aufrufe von <code><a href="../../reference/resample.html">resample()</a></code>):</p>
<div class="sourceCode" id="cb38"><pre class="downlit">
<span class="kw">lrv_table</span> <span class="op">&lt;-</span> <span class="kw">tibble</span>::<span class="fu"><a href="https://tibble.tidyverse.org/reference/tribble.html">tribble</a></span>(
  <span class="op">~</span><span class="kw">parameter</span>, <span class="op">~</span><span class="kw">statistic</span>, <span class="op">~</span><span class="kw">from</span>, <span class="op">~</span><span class="kw">to</span>,
  <span class="st">"SO2, NO2, PM10"</span>, <span class="st">"mean"</span>, <span class="st">"input"</span>, <span class="st">"y1"</span>,
  <span class="st">"SO2, NO2"</span>, <span class="st">"perc95"</span>, <span class="st">"input"</span>, <span class="st">"y1"</span>,
  <span class="st">"O3"</span>, <span class="st">"perc98"</span>, <span class="st">"input"</span>, <span class="st">"m1"</span>,
  <span class="st">"O3"</span>, <span class="st">"mean"</span>, <span class="st">"input"</span>, <span class="st">"h1"</span>,
  <span class="st">"O3"</span>, <span class="st">"n&gt;120"</span>, <span class="st">"h1"</span>, <span class="st">"y1"</span>,
  <span class="st">"SO2, NO2, CO, PM10"</span>, <span class="st">"mean"</span>, <span class="st">"input"</span>, <span class="st">"d1"</span>,
  <span class="st">"SO2"</span>, <span class="st">"n&gt;100"</span>, <span class="st">"d1"</span>, <span class="st">"y1"</span>,
  <span class="st">"NO2"</span>, <span class="st">"n&gt;80"</span>, <span class="st">"d1"</span>, <span class="st">"y1"</span>,
  <span class="st">"CO"</span>, <span class="st">"n&gt;8"</span>, <span class="st">"d1"</span>, <span class="st">"y1"</span>,
  <span class="st">"PM10"</span>, <span class="st">"n&gt;50"</span>, <span class="st">"d1"</span>, <span class="st">"y1"</span>
)
</pre></div>
<div class="sourceCode" id="cb39"><pre class="downlit">
<span class="kw">knitr</span>::<span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span>(<span class="kw">lrv_table</span>)
</pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">parameter</th>
<th align="left">statistic</th>
<th align="left">from</th>
<th align="left">to</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">SO2, NO2, PM10</td>
<td align="left">mean</td>
<td align="left">input</td>
<td align="left">y1</td>
</tr>
<tr class="even">
<td align="left">SO2, NO2</td>
<td align="left">perc95</td>
<td align="left">input</td>
<td align="left">y1</td>
</tr>
<tr class="odd">
<td align="left">O3</td>
<td align="left">perc98</td>
<td align="left">input</td>
<td align="left">m1</td>
</tr>
<tr class="even">
<td align="left">O3</td>
<td align="left">mean</td>
<td align="left">input</td>
<td align="left">h1</td>
</tr>
<tr class="odd">
<td align="left">O3</td>
<td align="left">n&gt;120</td>
<td align="left">h1</td>
<td align="left">y1</td>
</tr>
<tr class="even">
<td align="left">SO2, NO2, CO, PM10</td>
<td align="left">mean</td>
<td align="left">input</td>
<td align="left">d1</td>
</tr>
<tr class="odd">
<td align="left">SO2</td>
<td align="left">n&gt;100</td>
<td align="left">d1</td>
<td align="left">y1</td>
</tr>
<tr class="even">
<td align="left">NO2</td>
<td align="left">n&gt;80</td>
<td align="left">d1</td>
<td align="left">y1</td>
</tr>
<tr class="odd">
<td align="left">CO</td>
<td align="left">n&gt;8</td>
<td align="left">d1</td>
<td align="left">y1</td>
</tr>
<tr class="even">
<td align="left">PM10</td>
<td align="left">n&gt;50</td>
<td align="left">d1</td>
<td align="left">y1</td>
</tr>
</tbody>
</table>
<p>Wird diese Tabelle verwendet resultiert eine Liste mit h1, m1 und y1 Einträgen, welche die berechneten Grössen enthält:</p>
<div class="sourceCode" id="cb40"><pre class="downlit">
<span class="kw">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/read_airmo_csv.html">read_airmo_csv</a></span>(<span class="kw">fs</span>::<span class="fu"><a href="http://fs.r-lib.org/reference/path.html">path</a></span>(<span class="kw">examples_path</span>, <span class="st">"Zch_Stampfenbachstrasse_min30_2017.csv"</span>))

<span class="co"># Berechne Massenkonzentrationen aus Volumenkonzentrationen</span>
<span class="kw">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/calculate_mass_concentrations.html">calculate_mass_concentrations</a></span>(<span class="kw">data</span>)

<span class="kw">stats</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/calculate_statstable.html">calculate_statstable</a></span>(<span class="kw">data</span>, <span class="kw">lrv_table</span>)
<span class="kw">stats</span>
<span class="co">#&gt; $y1</span>
<span class="co">#&gt; # A tibble: 10 x 6</span>
<span class="co">#&gt;    starttime           site                    parameter    interval unit  value</span>
<span class="co">#&gt;    &lt;dttm&gt;              &lt;fct&gt;                   &lt;fct&gt;        &lt;fct&gt;    &lt;fct&gt; &lt;dbl&gt;</span>
<span class="co">#&gt;  1 2017-01-01 00:00:00 Zch_Stampfenbachstrasse NO2          y1       µg/m3 30.4 </span> 
<span class="co">#&gt;  2 2017-01-01 00:00:00 Zch_Stampfenbachstrasse NO2_95%_min~ y1       µg/m3 68.8 </span> 
<span class="co">#&gt;  3 2017-01-01 00:00:00 Zch_Stampfenbachstrasse PM10         y1       µg/m3 15.9 </span> 
<span class="co">#&gt;  4 2017-01-01 00:00:00 Zch_Stampfenbachstrasse SO2          y1       µg/m3  1.05</span>5
<span class="co">#&gt;  5 2017-01-01 00:00:00 Zch_Stampfenbachstrasse SO2_95%_min~ y1       µg/m3  2.17</span>7
<span class="co">#&gt;  6 2017-01-01 00:00:00 Zch_Stampfenbachstrasse O3_nb_h1&gt;120 y1       1     81   </span>
<span class="co">#&gt;  7 2017-01-01 00:00:00 Zch_Stampfenbachstrasse CO_nb_d1&gt;8   y1       1      0   </span>
<span class="co">#&gt;  8 2017-01-01 00:00:00 Zch_Stampfenbachstrasse NO2_nb_d1&gt;80 y1       1      1   </span>
<span class="co">#&gt;  9 2017-01-01 00:00:00 Zch_Stampfenbachstrasse PM10_nb_d1&gt;~ y1       1      8   </span>
<span class="co">#&gt; 10 2017-01-01 00:00:00 Zch_Stampfenbachstrasse SO2_nb_d1&gt;1~ y1       1      0   </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $m1</span>
<span class="co">#&gt; # A tibble: 12 x 6</span>
<span class="co">#&gt;    starttime           site                    parameter    interval unit  value</span>
<span class="co">#&gt;    &lt;dttm&gt;              &lt;fct&gt;                   &lt;fct&gt;        &lt;fct&gt;    &lt;fct&gt; &lt;dbl&gt;</span>
<span class="co">#&gt;  1 2017-01-01 00:00:00 Zch_Stampfenbachstrasse O3_98%_min30 m1       µg/m3  62.5</span>5
<span class="co">#&gt;  2 2017-02-01 00:00:00 Zch_Stampfenbachstrasse O3_98%_min30 m1       µg/m3  79.3</span>3
<span class="co">#&gt;  3 2017-03-01 00:00:00 Zch_Stampfenbachstrasse O3_98%_min30 m1       µg/m3  94.4</span>4
<span class="co">#&gt;  4 2017-04-01 00:00:00 Zch_Stampfenbachstrasse O3_98%_min30 m1       µg/m3 105. </span> 
<span class="co">#&gt;  5 2017-05-01 00:00:00 Zch_Stampfenbachstrasse O3_98%_min30 m1       µg/m3 128. </span> 
<span class="co">#&gt;  6 2017-06-01 00:00:00 Zch_Stampfenbachstrasse O3_98%_min30 m1       µg/m3 134. </span> 
<span class="co">#&gt;  7 2017-07-01 00:00:00 Zch_Stampfenbachstrasse O3_98%_min30 m1       µg/m3 113. </span> 
<span class="co">#&gt;  8 2017-08-01 00:00:00 Zch_Stampfenbachstrasse O3_98%_min30 m1       µg/m3 109. </span> 
<span class="co">#&gt;  9 2017-09-01 00:00:00 Zch_Stampfenbachstrasse O3_98%_min30 m1       µg/m3  82.6</span>6
<span class="co">#&gt; 10 2017-10-01 00:00:00 Zch_Stampfenbachstrasse O3_98%_min30 m1       µg/m3  74.9</span>9
<span class="co">#&gt; 11 2017-11-01 00:00:00 Zch_Stampfenbachstrasse O3_98%_min30 m1       µg/m3  67.6</span>6
<span class="co">#&gt; 12 2017-12-01 00:00:00 Zch_Stampfenbachstrasse O3_98%_min30 m1       µg/m3  71.8</span>8
<span class="co">#&gt; </span>
<span class="co">#&gt; $h1</span>
<span class="co">#&gt; # A tibble: 8,760 x 6</span>
<span class="co">#&gt;    starttime           site                    parameter interval unit  value</span>
<span class="co">#&gt;    &lt;dttm&gt;              &lt;fct&gt;                   &lt;fct&gt;     &lt;fct&gt;    &lt;fct&gt; &lt;dbl&gt;</span>
<span class="co">#&gt;  1 2017-01-01 00:00:00 Zch_Stampfenbachstrasse O3        h1       µg/m3  1.45</span>5
<span class="co">#&gt;  2 2017-01-01 01:00:00 Zch_Stampfenbachstrasse O3        h1       µg/m3  1.35</span>5
<span class="co">#&gt;  3 2017-01-01 02:00:00 Zch_Stampfenbachstrasse O3        h1       µg/m3  1.02</span>2
<span class="co">#&gt;  4 2017-01-01 03:00:00 Zch_Stampfenbachstrasse O3        h1       µg/m3  1.54</span>4
<span class="co">#&gt;  5 2017-01-01 04:00:00 Zch_Stampfenbachstrasse O3        h1       µg/m3  2.41</span>1
<span class="co">#&gt;  6 2017-01-01 05:00:00 Zch_Stampfenbachstrasse O3        h1       µg/m3  2.14</span>4
<span class="co">#&gt;  7 2017-01-01 06:00:00 Zch_Stampfenbachstrasse O3        h1       µg/m3  2.41</span>1
<span class="co">#&gt;  8 2017-01-01 07:00:00 Zch_Stampfenbachstrasse O3        h1       µg/m3  2.67</span>7
<span class="co">#&gt;  9 2017-01-01 08:00:00 Zch_Stampfenbachstrasse O3        h1       µg/m3  3.74</span>4
<span class="co">#&gt; 10 2017-01-01 09:00:00 Zch_Stampfenbachstrasse O3        h1       µg/m3  6.52</span>2
<span class="co">#&gt; # ... with 8,750 more rows</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $d1</span>
<span class="co">#&gt; # A tibble: 1,460 x 6</span>
<span class="co">#&gt;    starttime           site                    parameter interval unit  value</span>
<span class="co">#&gt;    &lt;dttm&gt;              &lt;fct&gt;                   &lt;fct&gt;     &lt;fct&gt;    &lt;fct&gt; &lt;dbl&gt;</span>
<span class="co">#&gt;  1 2017-01-01 00:00:00 Zch_Stampfenbachstrasse CO        d1       mg/m3 0.381</span>
<span class="co">#&gt;  2 2017-01-02 00:00:00 Zch_Stampfenbachstrasse CO        d1       mg/m3 0.339</span>
<span class="co">#&gt;  3 2017-01-03 00:00:00 Zch_Stampfenbachstrasse CO        d1       mg/m3 0.349</span>
<span class="co">#&gt;  4 2017-01-04 00:00:00 Zch_Stampfenbachstrasse CO        d1       mg/m3 0.248</span>
<span class="co">#&gt;  5 2017-01-05 00:00:00 Zch_Stampfenbachstrasse CO        d1       mg/m3 0.278</span>
<span class="co">#&gt;  6 2017-01-06 00:00:00 Zch_Stampfenbachstrasse CO        d1       mg/m3 0.282</span>
<span class="co">#&gt;  7 2017-01-07 00:00:00 Zch_Stampfenbachstrasse CO        d1       mg/m3 0.378</span>
<span class="co">#&gt;  8 2017-01-08 00:00:00 Zch_Stampfenbachstrasse CO        d1       mg/m3 0.349</span>
<span class="co">#&gt;  9 2017-01-09 00:00:00 Zch_Stampfenbachstrasse CO        d1       mg/m3 0.388</span>
<span class="co">#&gt; 10 2017-01-10 00:00:00 Zch_Stampfenbachstrasse CO        d1       mg/m3 0.314</span>
<span class="co">#&gt; # ... with 1,450 more rows</span>
</pre></div>
<p>Nur die m1 und y1 sind für die LRV relevant:</p>
<div class="sourceCode" id="cb41"><pre class="downlit">
<span class="kw">lrv</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/bind_rows_with_factor_columns.html">bind_rows_with_factor_columns</a></span>(<span class="kw">stats</span><span class="op">$</span><span class="kw">y1</span>, <span class="kw">stats</span><span class="op">$</span><span class="kw">m1</span>)
</pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">starttime</th>
<th align="left">site</th>
<th align="left">parameter</th>
<th align="left">interval</th>
<th align="left">unit</th>
<th align="right">value</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">2017-01-01</td>
<td align="left">Zch_Stampfenbachstrasse</td>
<td align="left">NO2</td>
<td align="left">y1</td>
<td align="left">µg/m3</td>
<td align="right">30</td>
</tr>
<tr class="even">
<td align="left">2017-01-01</td>
<td align="left">Zch_Stampfenbachstrasse</td>
<td align="left">NO2_95%_min30</td>
<td align="left">y1</td>
<td align="left">µg/m3</td>
<td align="right">69</td>
</tr>
<tr class="odd">
<td align="left">2017-01-01</td>
<td align="left">Zch_Stampfenbachstrasse</td>
<td align="left">PM10</td>
<td align="left">y1</td>
<td align="left">µg/m3</td>
<td align="right">16</td>
</tr>
<tr class="even">
<td align="left">2017-01-01</td>
<td align="left">Zch_Stampfenbachstrasse</td>
<td align="left">SO2</td>
<td align="left">y1</td>
<td align="left">µg/m3</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">2017-01-01</td>
<td align="left">Zch_Stampfenbachstrasse</td>
<td align="left">SO2_95%_min30</td>
<td align="left">y1</td>
<td align="left">µg/m3</td>
<td align="right">2</td>
</tr>
<tr class="even">
<td align="left">2017-01-01</td>
<td align="left">Zch_Stampfenbachstrasse</td>
<td align="left">O3_nb_h1&gt;120</td>
<td align="left">y1</td>
<td align="left">1</td>
<td align="right">81</td>
</tr>
<tr class="odd">
<td align="left">2017-01-01</td>
<td align="left">Zch_Stampfenbachstrasse</td>
<td align="left">CO_nb_d1&gt;8</td>
<td align="left">y1</td>
<td align="left">1</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">2017-01-01</td>
<td align="left">Zch_Stampfenbachstrasse</td>
<td align="left">NO2_nb_d1&gt;80</td>
<td align="left">y1</td>
<td align="left">1</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">2017-01-01</td>
<td align="left">Zch_Stampfenbachstrasse</td>
<td align="left">PM10_nb_d1&gt;50</td>
<td align="left">y1</td>
<td align="left">1</td>
<td align="right">8</td>
</tr>
<tr class="even">
<td align="left">2017-01-01</td>
<td align="left">Zch_Stampfenbachstrasse</td>
<td align="left">SO2_nb_d1&gt;100</td>
<td align="left">y1</td>
<td align="left">1</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">2017-01-01</td>
<td align="left">Zch_Stampfenbachstrasse</td>
<td align="left">O3_98%_min30</td>
<td align="left">m1</td>
<td align="left">µg/m3</td>
<td align="right">62</td>
</tr>
<tr class="even">
<td align="left">2017-02-01</td>
<td align="left">Zch_Stampfenbachstrasse</td>
<td align="left">O3_98%_min30</td>
<td align="left">m1</td>
<td align="left">µg/m3</td>
<td align="right">79</td>
</tr>
<tr class="odd">
<td align="left">2017-03-01</td>
<td align="left">Zch_Stampfenbachstrasse</td>
<td align="left">O3_98%_min30</td>
<td align="left">m1</td>
<td align="left">µg/m3</td>
<td align="right">94</td>
</tr>
<tr class="even">
<td align="left">2017-04-01</td>
<td align="left">Zch_Stampfenbachstrasse</td>
<td align="left">O3_98%_min30</td>
<td align="left">m1</td>
<td align="left">µg/m3</td>
<td align="right">105</td>
</tr>
<tr class="odd">
<td align="left">2017-05-01</td>
<td align="left">Zch_Stampfenbachstrasse</td>
<td align="left">O3_98%_min30</td>
<td align="left">m1</td>
<td align="left">µg/m3</td>
<td align="right">128</td>
</tr>
<tr class="even">
<td align="left">2017-06-01</td>
<td align="left">Zch_Stampfenbachstrasse</td>
<td align="left">O3_98%_min30</td>
<td align="left">m1</td>
<td align="left">µg/m3</td>
<td align="right">134</td>
</tr>
<tr class="odd">
<td align="left">2017-07-01</td>
<td align="left">Zch_Stampfenbachstrasse</td>
<td align="left">O3_98%_min30</td>
<td align="left">m1</td>
<td align="left">µg/m3</td>
<td align="right">113</td>
</tr>
<tr class="even">
<td align="left">2017-08-01</td>
<td align="left">Zch_Stampfenbachstrasse</td>
<td align="left">O3_98%_min30</td>
<td align="left">m1</td>
<td align="left">µg/m3</td>
<td align="right">109</td>
</tr>
<tr class="odd">
<td align="left">2017-09-01</td>
<td align="left">Zch_Stampfenbachstrasse</td>
<td align="left">O3_98%_min30</td>
<td align="left">m1</td>
<td align="left">µg/m3</td>
<td align="right">83</td>
</tr>
<tr class="even">
<td align="left">2017-10-01</td>
<td align="left">Zch_Stampfenbachstrasse</td>
<td align="left">O3_98%_min30</td>
<td align="left">m1</td>
<td align="left">µg/m3</td>
<td align="right">75</td>
</tr>
<tr class="odd">
<td align="left">2017-11-01</td>
<td align="left">Zch_Stampfenbachstrasse</td>
<td align="left">O3_98%_min30</td>
<td align="left">m1</td>
<td align="left">µg/m3</td>
<td align="right">68</td>
</tr>
<tr class="even">
<td align="left">2017-12-01</td>
<td align="left">Zch_Stampfenbachstrasse</td>
<td align="left">O3_98%_min30</td>
<td align="left">m1</td>
<td align="left">µg/m3</td>
<td align="right">72</td>
</tr>
</tbody>
</table>
</div>
<div id="inputs_" class="section level2">
<h2 class="hasAnchor">
<a href="#inputs_" class="anchor"></a><code>_inputs_</code>
</h2>
<p>Der Parameter <code>_inputs_</code> ist ein Hilfskonstrukt wie <code>default_statistic</code>. Ein Problem bei mehrstufigen Berechnungen ist, dass unter Umständen bereits Resultate im Input für weitere Berechnungen enthalten sind. In folgenden Bespiel wird zuerst aus den 30min Werten d1 Mittelwerte, Anzahl Datenpunkte, min und max berechnet für d1, m1 und y1. Danach sollte das Tagesmaximum für das Jahr bestimmt werden:</p>
<div class="sourceCode" id="cb42"><pre class="downlit">
<span class="co"># Ein Parameter reicht für die Veranschaulichung</span>
<span class="kw">O3</span> <span class="op">&lt;-</span> <span class="kw">dplyr</span>::<span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(<span class="kw">data</span>, <span class="kw">.data</span><span class="op">$</span><span class="kw">parameter</span> <span class="op">==</span> <span class="st">"O3"</span>)

<span class="kw">statstable</span> <span class="op">&lt;-</span> <span class="kw">tibble</span>::<span class="fu"><a href="https://tibble.tidyverse.org/reference/tribble.html">tribble</a></span>(
  <span class="op">~</span><span class="kw">parameter</span>, <span class="op">~</span><span class="kw">statistic</span>, <span class="op">~</span><span class="kw">from</span>, <span class="op">~</span><span class="kw">to</span>,
  <span class="st">"default_statistic"</span>, <span class="st">"mean, n, min, max"</span>, <span class="st">"input"</span>, <span class="st">"d1, m1, y1"</span>,
  <span class="st">"default_statistic"</span>, <span class="st">"max"</span>, <span class="st">"d1"</span>, <span class="st">"y1"</span>
)

<span class="co"># Keine Berücksichtung der Datenverfügbarkeit</span>
<span class="kw">stats</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/calculate_statstable.html">calculate_statstable</a></span>(<span class="kw">O3</span>, <span class="kw">statstable</span>, data_thresh = <span class="fl">0</span>, max_gap = <span class="kw">NULL</span>)
<span class="kw">stats</span><span class="op">$</span><span class="kw">y1</span>
<span class="co">#&gt; # A tibble: 8 x 6</span>
<span class="co">#&gt;   starttime           site              parameter        interval unit     value</span>
<span class="co">#&gt;   &lt;dttm&gt;              &lt;fct&gt;             &lt;fct&gt;            &lt;fct&gt;    &lt;fct&gt;    &lt;dbl&gt;</span>
<span class="co">#&gt; 1 2017-01-01 00:00:00 Zch_Stampfenbach~ O3               y1       µg/m3  4.53e+1</span>1
<span class="co">#&gt; 2 2017-01-01 00:00:00 Zch_Stampfenbach~ O3_nb_min30      y1       1      1.75e+4</span>
<span class="co">#&gt; 3 2017-01-01 00:00:00 Zch_Stampfenbach~ O3_min_min30     y1       µg/m3  2.44e-1</span>1
<span class="co">#&gt; 4 2017-01-01 00:00:00 Zch_Stampfenbach~ O3_max_min30     y1       µg/m3  1.54e+2</span>2
<span class="co">#&gt; 5 2017-01-01 00:00:00 Zch_Stampfenbach~ O3_max_d1        y1       µg/m3  1.16e+2</span>2
<span class="co">#&gt; 6 2017-01-01 00:00:00 Zch_Stampfenbach~ O3_nb_min30_max~ y1       1      4.80e+1</span>
<span class="co">#&gt; 7 2017-01-01 00:00:00 Zch_Stampfenbach~ O3_min_min30_ma~ y1       µg/m3  9.00e+1</span>1
<span class="co">#&gt; 8 2017-01-01 00:00:00 Zch_Stampfenbach~ O3_max_min30_ma~ y1       µg/m3  1.54e+2</span>2
</pre></div>
<p>Wird für die Berechnung des maximalen Tagesmittelwert des Jahres <code>_inputs_</code> statt <code>default_statistic</code> verwendet, werden nur die Statistiken für Parameter berechnet die in den Input Daten enthalten sind.</p>
<div class="sourceCode" id="cb43"><pre class="downlit">
<span class="kw">statstable</span> <span class="op">&lt;-</span> <span class="kw">tibble</span>::<span class="fu"><a href="https://tibble.tidyverse.org/reference/tribble.html">tribble</a></span>(
  <span class="op">~</span><span class="kw">parameter</span>, <span class="op">~</span><span class="kw">statistic</span>, <span class="op">~</span><span class="kw">from</span>, <span class="op">~</span><span class="kw">to</span>,
  <span class="st">"default_statistic"</span>, <span class="st">"mean, n, min, max"</span>, <span class="st">"input"</span>, <span class="st">"d1, m1, y1"</span>,
  <span class="st">"_inputs_"</span>, <span class="st">"max"</span>, <span class="st">"d1"</span>, <span class="st">"y1"</span>
)

<span class="co"># Keine Berücksichtung der Datenverfügbarkeit</span>
<span class="kw">stats</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/calculate_statstable.html">calculate_statstable</a></span>(<span class="kw">O3</span>, <span class="kw">statstable</span>, data_thresh = <span class="fl">0</span>, max_gap = <span class="kw">NULL</span>)
<span class="kw">stats</span><span class="op">$</span><span class="kw">y1</span>
<span class="co">#&gt; # A tibble: 5 x 6</span>
<span class="co">#&gt;   starttime           site                  parameter    interval unit     value</span>
<span class="co">#&gt;   &lt;dttm&gt;              &lt;fct&gt;                 &lt;fct&gt;        &lt;fct&gt;    &lt;fct&gt;    &lt;dbl&gt;</span>
<span class="co">#&gt; 1 2017-01-01 00:00:00 Zch_Stampfenbachstra~ O3           y1       µg/m3  4.53e+1</span>1
<span class="co">#&gt; 2 2017-01-01 00:00:00 Zch_Stampfenbachstra~ O3_nb_min30  y1       1      1.75e+4</span>
<span class="co">#&gt; 3 2017-01-01 00:00:00 Zch_Stampfenbachstra~ O3_min_min30 y1       µg/m3  2.44e-1</span>1
<span class="co">#&gt; 4 2017-01-01 00:00:00 Zch_Stampfenbachstra~ O3_max_min30 y1       µg/m3  1.54e+2</span>2
<span class="co">#&gt; 5 2017-01-01 00:00:00 Zch_Stampfenbachstra~ O3_max_d1    y1       µg/m3  1.16e+2</span>2
</pre></div>
<p>Im Allgemeinen dürfte die explizite Definition der Statistiken für jeden Parameter gegenüber der Verwendung von <code>default_statistic</code> und <code>_inputs_</code> vorzuziehen. Ansonsten kann das Resultat unerwartete Ergebnisse enthalten. Die Definition der statstable kann auch in einer Textdatei oder Exceldatei erfolgen und dann eingelesen werden, statt im Code definiert werden.</p>
<p>An dieser Stelle noch die Berechnungen aller Statistiken im aqmet Store. Aus 21 Input Grössen werden 419 Statistiken berechnet:</p>
<table class="table">
<thead><tr class="header">
<th align="left">parameter</th>
<th align="left">statistic</th>
<th align="left">from</th>
<th align="left">to</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">CO, NO, NOx, NO2, O3, SO2</td>
<td align="left">mean</td>
<td align="left">input</td>
<td align="left">h1,d1,m1,y1</td>
</tr>
<tr class="even">
<td align="left">CO, NO, NOx, NO2, O3, SO2</td>
<td align="left">max, min, n</td>
<td align="left">input</td>
<td align="left">d1,m1,y1</td>
</tr>
<tr class="odd">
<td align="left">CO, NO, NOx, NO2, SO2</td>
<td align="left">perc95</td>
<td align="left">input</td>
<td align="left">m1,y1</td>
</tr>
<tr class="even">
<td align="left">O3</td>
<td align="left">perc02, perc98</td>
<td align="left">input</td>
<td align="left">m1,y1</td>
</tr>
<tr class="odd">
<td align="left">O3</td>
<td align="left">max, min, n, n&gt;120, n&gt;160, n&gt;180, n&gt;200, n&gt;240</td>
<td align="left">h1</td>
<td align="left">d1,m1,y1</td>
</tr>
<tr class="even">
<td align="left">NO2</td>
<td align="left">max, n, n&gt;200</td>
<td align="left">h1</td>
<td align="left">d1,m1,y1</td>
</tr>
<tr class="odd">
<td align="left">O3</td>
<td align="left">mean</td>
<td align="left">h1</td>
<td align="left">h8gl</td>
</tr>
<tr class="even">
<td align="left">CO</td>
<td align="left">mean</td>
<td align="left">h1</td>
<td align="left">h8gl</td>
</tr>
<tr class="odd">
<td align="left">CO</td>
<td align="left">max</td>
<td align="left">h8gl</td>
<td align="left">y1</td>
</tr>
<tr class="even">
<td align="left">O3</td>
<td align="left">max, n&gt;120, n&gt;160, n&gt;180, n&gt;200, n&gt;240</td>
<td align="left">h8gl</td>
<td align="left">y1</td>
</tr>
<tr class="odd">
<td align="left">CO, NO, NOx, NO2, O3, SO2</td>
<td align="left">min, max, n</td>
<td align="left">d1</td>
<td align="left">m1,y1</td>
</tr>
<tr class="even">
<td align="left">CO</td>
<td align="left">n&gt;8</td>
<td align="left">d1</td>
<td align="left">m1,y1</td>
</tr>
<tr class="odd">
<td align="left">SO2</td>
<td align="left">n&gt;100</td>
<td align="left">d1</td>
<td align="left">m1,y1</td>
</tr>
<tr class="even">
<td align="left">NO2</td>
<td align="left">n&gt;80</td>
<td align="left">d1</td>
<td align="left">m1,y1</td>
</tr>
<tr class="odd">
<td align="left">O3</td>
<td align="left">n&gt;120, n&gt;160, n&gt;200, n&gt;180, n&gt;240, n&gt;65</td>
<td align="left">d1</td>
<td align="left">m1,y1</td>
</tr>
<tr class="even">
<td align="left">O3_max_h1</td>
<td align="left">n&gt;120, n&gt;160, n&gt;180, n&gt;200, n&gt;240</td>
<td align="left">d1</td>
<td align="left">m1,y1</td>
</tr>
<tr class="odd">
<td align="left">O3_98%_min30</td>
<td align="left">max, n&gt;100</td>
<td align="left">m1</td>
<td align="left">y1</td>
</tr>
<tr class="even">
<td align="left">EC1.0, EC2.5, PM10, PM2.5, PN</td>
<td align="left">mean</td>
<td align="left">input</td>
<td align="left">h1,d1,m1,y1</td>
</tr>
<tr class="odd">
<td align="left">EC1.0, EC2.5, PM10, PM2.5, PN</td>
<td align="left">max, min, n</td>
<td align="left">input</td>
<td align="left">d1,m1,y1</td>
</tr>
<tr class="even">
<td align="left">EC1.0, EC2.5, PM10, PM2.5, PN</td>
<td align="left">perc95</td>
<td align="left">input</td>
<td align="left">m1,y1</td>
</tr>
<tr class="odd">
<td align="left">EC1.0, EC2.5, PM10, PM2.5, PN</td>
<td align="left">min, max, n</td>
<td align="left">d1</td>
<td align="left">m1,y1</td>
</tr>
<tr class="even">
<td align="left">PM10</td>
<td align="left">n&gt;50</td>
<td align="left">d1</td>
<td align="left">m1,y1</td>
</tr>
<tr class="odd">
<td align="left">PM2.5</td>
<td align="left">n&gt;25</td>
<td align="left">d1</td>
<td align="left">m1,y1</td>
</tr>
<tr class="even">
<td align="left">WD</td>
<td align="left">wind.direction</td>
<td align="left">input</td>
<td align="left">h1,d1,m1,y1</td>
</tr>
<tr class="odd">
<td align="left">WVs</td>
<td align="left">wind.speed_scalar</td>
<td align="left">input</td>
<td align="left">h1,d1,m1,y1</td>
</tr>
<tr class="even">
<td align="left">WVv</td>
<td align="left">wind.speed_vector</td>
<td align="left">input</td>
<td align="left">h1,d1,m1,y1</td>
</tr>
<tr class="odd">
<td align="left">WD</td>
<td align="left">n</td>
<td align="left">input</td>
<td align="left">d1,m1,y1</td>
</tr>
<tr class="even">
<td align="left">WVs</td>
<td align="left">max, min, n</td>
<td align="left">input</td>
<td align="left">d1,m1,y1</td>
</tr>
<tr class="odd">
<td align="left">WVv</td>
<td align="left">max, min, n</td>
<td align="left">input</td>
<td align="left">d1,m1,y1</td>
</tr>
<tr class="even">
<td align="left">Hr, p, StrGlo, T</td>
<td align="left">mean</td>
<td align="left">input</td>
<td align="left">h1,d1,m1,y1</td>
</tr>
<tr class="odd">
<td align="left">Hr, p</td>
<td align="left">min,max</td>
<td align="left">input</td>
<td align="left">d1</td>
</tr>
<tr class="even">
<td align="left">T</td>
<td align="left">min, max, n</td>
<td align="left">input</td>
<td align="left">d1,m1,y1</td>
</tr>
<tr class="odd">
<td align="left">T</td>
<td align="left">min, max</td>
<td align="left">h1</td>
<td align="left">d1,m1,y1</td>
</tr>
<tr class="even">
<td align="left">T</td>
<td align="left">min, max, n</td>
<td align="left">d1</td>
<td align="left">m1,y1</td>
</tr>
<tr class="odd">
<td align="left">StrGlo</td>
<td align="left">max, n</td>
<td align="left">input</td>
<td align="left">d1,m1,y1</td>
</tr>
<tr class="even">
<td align="left">Hr, p</td>
<td align="left">n</td>
<td align="left">input</td>
<td align="left">d1,m1,y1</td>
</tr>
<tr class="odd">
<td align="left">RainDur, RainSum, SunDur</td>
<td align="left">sum</td>
<td align="left">input</td>
<td align="left">h1,d1,m1,y1</td>
</tr>
<tr class="even">
<td align="left">RainDur, RainSum, SunDur</td>
<td align="left">n</td>
<td align="left">input</td>
<td align="left">d1,m1,y1</td>
</tr>
<tr class="odd">
<td align="left">RainDur, RainSum, SunDur</td>
<td align="left">max</td>
<td align="left">d1</td>
<td align="left">y1</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="umwandlung-von-volumen--und-massenkonzentrationen" class="section level1">
<h1 class="hasAnchor">
<a href="#umwandlung-von-volumen--und-massenkonzentrationen" class="anchor"></a>Umwandlung von Volumen- und Massenkonzentrationen</h1>
<p>Die Umwandlung der Konzentrationen erfolgt äquivalent zu den Berechnungen in der AIRMO. Sollen andere Konstanten verwendet werden, ist die Dokumentation von <code><a href="../../reference/convert_get_R.html">convert_set_R()</a></code> zu konsultieren. Die Funktionen <code><a href="../../reference/convert_conc.html">convert_conc()</a></code> und <code><a href="../../reference/convert_conc.html">convert_conc_multiple()</a></code> verfügen beide über Varianten wie die umgewandelten Daten zurückgegeben werden. Definiert wird dies mit dem Argument method. Bei “return” werden nur die umgewandelten Daten zurückgegeben, bei “append” werden sie am Ende angehängt und zuletzt bei “replace” werden die ursprünglichen Daten ersetzt.</p>
<div class="sourceCode" id="cb44"><pre class="downlit">
<span class="kw">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/read_airmo_csv.html">read_airmo_csv</a></span>(<span class="kw">fs</span>::<span class="fu"><a href="http://fs.r-lib.org/reference/path.html">path</a></span>(<span class="kw">examples_path</span>, <span class="st">"Zch_Stampfenbachstrasse_min30_2013_Jan.csv"</span>))

<span class="co"># Behalte nur Volumenkonzentrationen</span>
<span class="kw">data</span> <span class="op">&lt;-</span> <span class="kw">dplyr</span>::<span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(<span class="kw">data</span>, <span class="kw">.data</span><span class="op">$</span><span class="kw">unit</span> <span class="op">==</span> <span class="st">"ppb"</span> <span class="op">|</span> <span class="kw">.data</span><span class="op">$</span><span class="kw">unit</span> <span class="op">==</span> <span class="st">"ppm"</span>)

<span class="fu"><a href="../../reference/convert_conc.html">convert_conc</a></span>(<span class="kw">data</span>, <span class="st">"NO"</span>, <span class="st">"ppb"</span>, <span class="st">"µg/m3"</span>", method =<span class="st">"return"</span>")
<span class="co">#&gt; # A tibble: 1,484 x 6</span>
<span class="co">#&gt;    starttime           site                    parameter interval unit  value</span>
<span class="co">#&gt;    &lt;dttm&gt;              &lt;fct&gt;                   &lt;fct&gt;     &lt;fct&gt;    &lt;fct&gt; &lt;dbl&gt;</span>
<span class="co">#&gt;  1 2013-01-01 00:00:00 Zch_Stampfenbachstrasse NO        min30    µg/m3  79.3</span>3
<span class="co">#&gt;  2 2013-01-01 00:30:00 Zch_Stampfenbachstrasse NO        min30    µg/m3  81.8</span>8
<span class="co">#&gt;  3 2013-01-01 01:00:00 Zch_Stampfenbachstrasse NO        min30    µg/m3  75.6</span>6
<span class="co">#&gt;  4 2013-01-01 01:30:00 Zch_Stampfenbachstrasse NO        min30    µg/m3  81.2</span>2
<span class="co">#&gt;  5 2013-01-01 02:00:00 Zch_Stampfenbachstrasse NO        min30    µg/m3 101. </span> 
<span class="co">#&gt;  6 2013-01-01 02:30:00 Zch_Stampfenbachstrasse NO        min30    µg/m3  61.4</span>4
<span class="co">#&gt;  7 2013-01-01 03:00:00 Zch_Stampfenbachstrasse NO        min30    µg/m3  63.6</span>6
<span class="co">#&gt;  8 2013-01-01 03:30:00 Zch_Stampfenbachstrasse NO        min30    µg/m3  61.0</span>0
<span class="co">#&gt;  9 2013-01-01 04:00:00 Zch_Stampfenbachstrasse NO        min30    µg/m3  63.6</span>6
<span class="co">#&gt; 10 2013-01-01 04:30:00 Zch_Stampfenbachstrasse NO        min30    µg/m3  70.7</span>7
<span class="co">#&gt; # ... with 1,474 more rows</span>

<span class="kw">conversions</span> <span class="op">&lt;-</span> <span class="kw">tibble</span>::<span class="fu"><a href="https://tibble.tidyverse.org/reference/tribble.html">tribble</a></span>(
  <span class="op">~</span><span class="kw">parameter</span>, <span class="op">~</span><span class="kw">from</span>, <span class="op">~</span><span class="kw">to</span>,
  <span class="st">"CO"</span>, <span class="st">"ppm"</span>, <span class="st">"mg/m3"</span>,
  <span class="st">"NO"</span>, <span class="st">"ppb"</span>, <span class="st">"µg/m3"</span>",
  <span class="st">"O3"</span>, <span class="st">"ppb"</span>, <span class="st">"µg/m3"</span>",
  <span class="st">"NO2"</span>, <span class="st">"ppb"</span>, <span class="st">"µg/m3"</span>",
  <span class="st">"SO2"</span>, <span class="st">"ppb"</span>, <span class="st">"µg/m3"</span>"
)
<span class="fu"><a href="../../reference/convert_conc.html">convert_conc_multiple</a></span>(<span class="kw">data</span>, <span class="kw">conversions</span>, method = <span class="st">"return"</span>) <span class="op">%&gt;%</span>
  <span class="kw">dplyr</span>::<span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span>(<span class="kw">.data</span><span class="op">$</span><span class="kw">starttime</span>)
<span class="co">#&gt; # A tibble: 7,424 x 6</span>
<span class="co">#&gt;    starttime           site                    parameter interval unit   value</span>
<span class="co">#&gt;    &lt;dttm&gt;              &lt;fct&gt;                   &lt;fct&gt;     &lt;fct&gt;    &lt;fct&gt;  &lt;dbl&gt;</span>
<span class="co">#&gt;  1 2013-01-01 00:00:00 Zch_Stampfenbachstrasse CO        min30    mg/m3  0.782</span>
<span class="co">#&gt;  2 2013-01-01 00:00:00 Zch_Stampfenbachstrasse NO        min30    µg/m3 79.3  </span> 
<span class="co">#&gt;  3 2013-01-01 00:00:00 Zch_Stampfenbachstrasse O3        min30    µg/m3  3.48 </span> 
<span class="co">#&gt;  4 2013-01-01 00:00:00 Zch_Stampfenbachstrasse NO2       min30    µg/m3 63.0  </span> 
<span class="co">#&gt;  5 2013-01-01 00:00:00 Zch_Stampfenbachstrasse SO2       min30    µg/m3 11.7  </span> 
<span class="co">#&gt;  6 2013-01-01 00:30:00 Zch_Stampfenbachstrasse CO        min30    mg/m3  0.828</span>
<span class="co">#&gt;  7 2013-01-01 00:30:00 Zch_Stampfenbachstrasse NO        min30    µg/m3 81.8  </span> 
<span class="co">#&gt;  8 2013-01-01 00:30:00 Zch_Stampfenbachstrasse O3        min30    µg/m3  3.40 </span> 
<span class="co">#&gt;  9 2013-01-01 00:30:00 Zch_Stampfenbachstrasse NO2       min30    µg/m3 64.7  </span> 
<span class="co">#&gt; 10 2013-01-01 00:30:00 Zch_Stampfenbachstrasse SO2       min30    µg/m3 12.2  </span> 
<span class="co">#&gt; # ... with 7,414 more rows</span>

<span class="fu"><a href="../../reference/convert_conc.html">convert_conc_multiple</a></span>(<span class="kw">data</span>, <span class="kw">conversions</span>, method = <span class="st">"append"</span>) <span class="op">%&gt;%</span>
  <span class="kw">dplyr</span>::<span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span>(<span class="kw">.data</span><span class="op">$</span><span class="kw">starttime</span>)
<span class="co">#&gt; # A tibble: 16,332 x 6</span>
<span class="co">#&gt;    starttime           site                    parameter interval unit   value</span>
<span class="co">#&gt;    &lt;dttm&gt;              &lt;fct&gt;                   &lt;fct&gt;     &lt;fct&gt;    &lt;fct&gt;  &lt;dbl&gt;</span>
<span class="co">#&gt;  1 2013-01-01 00:00:00 Zch_Stampfenbachstrasse CO        min30    ppm    0.672</span>
<span class="co">#&gt;  2 2013-01-01 00:00:00 Zch_Stampfenbachstrasse NO        min30    ppb   63.6  </span>
<span class="co">#&gt;  3 2013-01-01 00:00:00 Zch_Stampfenbachstrasse NO2       min30    ppb   33.0  </span>
<span class="co">#&gt;  4 2013-01-01 00:00:00 Zch_Stampfenbachstrasse NOx       min30    ppb   96.5  </span>
<span class="co">#&gt;  5 2013-01-01 00:00:00 Zch_Stampfenbachstrasse O3        min30    ppb    1.75 </span>
<span class="co">#&gt;  6 2013-01-01 00:00:00 Zch_Stampfenbachstrasse SO2       min30    ppb    4.41 </span>
<span class="co">#&gt;  7 2013-01-01 00:00:00 Zch_Stampfenbachstrasse CO        min30    mg/m3  0.782</span>
<span class="co">#&gt;  8 2013-01-01 00:00:00 Zch_Stampfenbachstrasse NO        min30    µg/m3 79.3  </span> 
<span class="co">#&gt;  9 2013-01-01 00:00:00 Zch_Stampfenbachstrasse O3        min30    µg/m3  3.48 </span> 
<span class="co">#&gt; 10 2013-01-01 00:00:00 Zch_Stampfenbachstrasse NO2       min30    µg/m3 63.0  </span> 
<span class="co">#&gt; # ... with 16,322 more rows</span>

<span class="fu"><a href="../../reference/convert_conc.html">convert_conc_multiple</a></span>(<span class="kw">data</span>, <span class="kw">conversions</span>, method = <span class="st">"replace"</span>) <span class="op">%&gt;%</span>
  <span class="kw">dplyr</span>::<span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span>(<span class="kw">.data</span><span class="op">$</span><span class="kw">starttime</span>)
<span class="co">#&gt; # A tibble: 8,908 x 6</span>
<span class="co">#&gt;    starttime           site                    parameter interval unit   value</span>
<span class="co">#&gt;    &lt;dttm&gt;              &lt;fct&gt;                   &lt;fct&gt;     &lt;fct&gt;    &lt;fct&gt;  &lt;dbl&gt;</span>
<span class="co">#&gt;  1 2013-01-01 00:00:00 Zch_Stampfenbachstrasse NOx       min30    ppb   96.5  </span>
<span class="co">#&gt;  2 2013-01-01 00:00:00 Zch_Stampfenbachstrasse CO        min30    mg/m3  0.782</span>
<span class="co">#&gt;  3 2013-01-01 00:00:00 Zch_Stampfenbachstrasse NO        min30    µg/m3 79.3  </span> 
<span class="co">#&gt;  4 2013-01-01 00:00:00 Zch_Stampfenbachstrasse O3        min30    µg/m3  3.48 </span> 
<span class="co">#&gt;  5 2013-01-01 00:00:00 Zch_Stampfenbachstrasse NO2       min30    µg/m3 63.0  </span> 
<span class="co">#&gt;  6 2013-01-01 00:00:00 Zch_Stampfenbachstrasse SO2       min30    µg/m3 11.7  </span> 
<span class="co">#&gt;  7 2013-01-01 00:30:00 Zch_Stampfenbachstrasse NOx       min30    ppb   99.4  </span>
<span class="co">#&gt;  8 2013-01-01 00:30:00 Zch_Stampfenbachstrasse CO        min30    mg/m3  0.828</span>
<span class="co">#&gt;  9 2013-01-01 00:30:00 Zch_Stampfenbachstrasse NO        min30    µg/m3 81.8  </span> 
<span class="co">#&gt; 10 2013-01-01 00:30:00 Zch_Stampfenbachstrasse O3        min30    µg/m3  3.40 </span> 
<span class="co">#&gt; # ... with 8,898 more rows</span>
</pre></div>
<p>Die Funktion <code><a href="../../reference/calculate_mass_concentrations.html">calculate_mass_concentrations()</a></code> ist eine Hilfsfunktion, die aus Volumenkonzentrationen für CO, NO, NO2, NO2, SO2 in einem tibble automatisch die Massenkonzentrationen berechnet. Mit dem Argument keep_ppb können optional die Volumenkonzentration behalten werden. Das Default vorgehen ist die Volumenkonzentrationen zu ersetzen.</p>
</div>
<div id="pluck" class="section level1">
<h1 class="hasAnchor">
<a href="#pluck" class="anchor"></a>Pluck</h1>
<p>Die Pluck Funktionen sind Wrapper um <code><a href="https://dplyr.tidyverse.org/reference/filter.html">dplyr::filter()</a></code>. Sie ermöglichen dem Nutzer eine komfortable Filterung von Daten im rolf Format. Als Beispiel nehmen wir die Daten aus dem mehrfach Meteoschweiz Export, dieser enthaltet eine Vielzahl von verschiedenen Stationen, Intervalle und Parameter:</p>
<div class="sourceCode" id="cb45"><pre class="downlit">
<span class="kw">fn</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span>(<span class="st">"extdata"</span>, <span class="st">"smn_multi.txt"</span>, package = <span class="st">"rOstluft.data"</span>)
<span class="kw">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/read_smn_multiple.html">read_smn_multiple</a></span>(<span class="kw">fn</span>) <span class="op">%&gt;%</span> 
  <span class="kw">dplyr</span>::<span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span>(<span class="kw">starttime</span>)

<span class="fu"><a href="../../reference/pluck_parameter.html">pluck_parameter</a></span>(<span class="kw">data</span>, <span class="st">"ta1towb0"</span>)
<span class="co">#&gt; # A tibble: 6 x 6</span>
<span class="co">#&gt;   starttime           site  parameter interval unit  value</span>
<span class="co">#&gt;   &lt;dttm&gt;              &lt;fct&gt; &lt;fct&gt;     &lt;fct&gt;    &lt;fct&gt; &lt;dbl&gt;</span>
<span class="co">#&gt; 1 2010-01-01 00:00:00 UEB   ta1towb0  h1       &lt;NA&gt;    3.7</span>
<span class="co">#&gt; 2 2010-01-01 01:00:00 UEB   ta1towb0  h1       &lt;NA&gt;    3.5</span>
<span class="co">#&gt; 3 2010-01-01 02:00:00 UEB   ta1towb0  h1       &lt;NA&gt;    3.2</span>
<span class="co">#&gt; 4 2010-01-01 03:00:00 UEB   ta1towb0  h1       &lt;NA&gt;    3.1</span>
<span class="co">#&gt; 5 2010-01-01 04:00:00 UEB   ta1towb0  h1       &lt;NA&gt;    3.3</span>
<span class="co">#&gt; 6 2010-01-01 05:00:00 UEB   ta1towb0  h1       &lt;NA&gt;    3.3</span>

<span class="co"># entpackt automatisch Vectors</span>
<span class="fu"><a href="../../reference/pluck_parameter.html">pluck_site</a></span>(<span class="kw">data</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"KLO"</span>, <span class="st">"UEB"</span>)) <span class="op">%&gt;%</span> <span class="kw">dplyr</span>::<span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice</a></span>(<span class="fl">41</span><span class="op">:</span><span class="fl">46</span>)
<span class="co">#&gt; # A tibble: 6 x 6</span>
<span class="co">#&gt;   starttime           site  parameter interval unit  value</span>
<span class="co">#&gt;   &lt;dttm&gt;              &lt;fct&gt; &lt;fct&gt;     &lt;fct&gt;    &lt;fct&gt; &lt;dbl&gt;</span>
<span class="co">#&gt; 1 2010-01-01 05:00:00 UEB   fk1towb0  h1       &lt;NA&gt;    1.9</span>
<span class="co">#&gt; 2 2010-01-01 05:00:00 UEB   ta1towb0  h1       &lt;NA&gt;    3.3</span>
<span class="co">#&gt; 3 2018-01-01 00:00:00 UEB   uretowhs  h1       &lt;NA&gt;   85.1</span>
<span class="co">#&gt; 4 2018-01-01 00:50:00 KLO   dkl010z0  min10    &lt;NA&gt;  224  </span>
<span class="co">#&gt; 5 2018-01-01 00:50:00 KLO   fkl010z0  min10    &lt;NA&gt;    5.7</span>
<span class="co">#&gt; 6 2018-01-01 00:50:00 KLO   fkl010z1  min10    &lt;NA&gt;    9.6</span>

<span class="co"># supported splicing mit den rlang operator !!!</span>
<span class="kw">intervals</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"h1"</span>, <span class="st">"d1"</span>)
<span class="fu"><a href="../../reference/pluck_parameter.html">pluck_interval</a></span>(<span class="kw">data</span>, <span class="op">!</span><span class="op">!</span><span class="op">!</span><span class="kw">intervals</span>) <span class="op">%&gt;%</span> <span class="kw">dplyr</span>::<span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice</a></span>(<span class="fl">40</span><span class="op">:</span><span class="fl">45</span>)
<span class="co">#&gt; # A tibble: 6 x 6</span>
<span class="co">#&gt;   starttime           site  parameter interval unit  value</span>
<span class="co">#&gt;   &lt;dttm&gt;              &lt;fct&gt; &lt;fct&gt;     &lt;fct&gt;    &lt;fct&gt; &lt;dbl&gt;</span>
<span class="co">#&gt; 1 2010-01-01 05:00:00 UEB   dk1towb0  h1       &lt;NA&gt;  129  </span>
<span class="co">#&gt; 2 2010-01-01 05:00:00 UEB   fk1towb0  h1       &lt;NA&gt;    1.9</span>
<span class="co">#&gt; 3 2010-01-01 05:00:00 UEB   ta1towb0  h1       &lt;NA&gt;    3.3</span>
<span class="co">#&gt; 4 2017-12-31 01:00:00 RHW   wkcap1d0  d1       &lt;NA&gt;    2  </span>
<span class="co">#&gt; 5 2017-12-31 01:00:00 RHW   wkcap2d0  d1       &lt;NA&gt;   11  </span>
<span class="co">#&gt; 6 2017-12-31 01:00:00 RHW   wkcap3d0  d1       &lt;NA&gt;   21</span>

<span class="co"># pluck_year mit einer sequence</span>
<span class="fu"><a href="../../reference/pluck_parameter.html">pluck_year</a></span>(<span class="kw">data</span>, <span class="fl">2010</span><span class="op">:</span><span class="fl">2018</span>) <span class="op">%&gt;%</span> <span class="kw">dplyr</span>::<span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice</a></span>(<span class="fl">51</span><span class="op">:</span><span class="fl">56</span>)
<span class="co">#&gt; # A tibble: 6 x 6</span>
<span class="co">#&gt;   starttime           site  parameter interval unit  value</span>
<span class="co">#&gt;   &lt;dttm&gt;              &lt;fct&gt; &lt;fct&gt;     &lt;fct&gt;    &lt;fct&gt; &lt;dbl&gt;</span>
<span class="co">#&gt; 1 2017-12-31 01:00:00 RHW   wkwtp1d0  d1       &lt;NA&gt;    1  </span>
<span class="co">#&gt; 2 2017-12-31 01:00:00 RHW   wkwtp2d0  d1       &lt;NA&gt;    9  </span>
<span class="co">#&gt; 3 2017-12-31 01:00:00 RHW   wkwtp3d0  d1       &lt;NA&gt;    9  </span>
<span class="co">#&gt; 4 2018-01-01 00:00:00 UEB   uretowhs  h1       &lt;NA&gt;   85.1</span>
<span class="co">#&gt; 5 2018-01-01 00:50:00 ARH   dkl010z0  min10    &lt;NA&gt;  168  </span>
<span class="co">#&gt; 6 2018-01-01 00:50:00 ARH   fkl010z0  min10    &lt;NA&gt;    1.1</span>

<span class="co"># NA Werte werden gefiltert</span>
<span class="fu"><a href="../../reference/pluck_parameter.html">pluck_unit</a></span>(<span class="kw">data</span>, <span class="st">"hPa"</span>)
<span class="co">#&gt; # A tibble: 6 x 6</span>
<span class="co">#&gt;   starttime           site  parameter interval unit  value</span>
<span class="co">#&gt;   &lt;dttm&gt;              &lt;fct&gt; &lt;fct&gt;     &lt;fct&gt;    &lt;fct&gt; &lt;dbl&gt;</span>
<span class="co">#&gt; 1 2019-01-31 00:50:00 TAE   prestas0  min10    hPa    936.</span>
<span class="co">#&gt; 2 2019-01-31 01:00:00 TAE   prestas0  min10    hPa    936 </span>
<span class="co">#&gt; 3 2019-01-31 01:10:00 TAE   prestas0  min10    hPa    936.</span>
<span class="co">#&gt; 4 2019-01-31 01:20:00 TAE   prestas0  min10    hPa    936.</span>
<span class="co">#&gt; 5 2019-01-31 01:30:00 TAE   prestas0  min10    hPa    936.</span>
<span class="co">#&gt; 6 2019-01-31 01:40:00 TAE   prestas0  min10    hPa    936.</span>

<span class="co"># Verkettbar mittels pipes</span>
<span class="kw">data</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../../reference/pluck_parameter.html">pluck_site</a></span>(<span class="st">"KLO"</span>, <span class="st">"UEB"</span>) <span class="op">%&gt;%</span>
  <span class="fu"><a href="../../reference/pluck_parameter.html">pluck_parameter</a></span>(<span class="st">"gre000z0"</span>) <span class="op">%&gt;%</span>
  <span class="fu"><a href="../../reference/pluck_parameter.html">pluck_year</a></span>(<span class="fl">2010</span><span class="op">:</span><span class="fl">2018</span>) <span class="op">%&gt;%</span> 
  <span class="kw">dplyr</span>::<span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice</a></span>(<span class="fl">1</span><span class="op">:</span><span class="fl">6</span>)
<span class="co">#&gt; # A tibble: 6 x 6</span>
<span class="co">#&gt;   starttime           site  parameter interval unit  value</span>
<span class="co">#&gt;   &lt;dttm&gt;              &lt;fct&gt; &lt;fct&gt;     &lt;fct&gt;    &lt;fct&gt; &lt;dbl&gt;</span>
<span class="co">#&gt; 1 2018-01-01 00:50:00 KLO   gre000z0  min10    &lt;NA&gt;      1</span>
<span class="co">#&gt; 2 2018-01-01 00:50:00 UEB   gre000z0  min10    &lt;NA&gt;      3</span>
<span class="co">#&gt; 3 2018-01-01 01:00:00 KLO   gre000z0  min10    &lt;NA&gt;      1</span>
<span class="co">#&gt; 4 2018-01-01 01:00:00 UEB   gre000z0  min10    &lt;NA&gt;      3</span>
<span class="co">#&gt; 5 2018-01-01 01:10:00 KLO   gre000z0  min10    &lt;NA&gt;      1</span>
<span class="co">#&gt; 6 2018-01-01 01:10:00 UEB   gre000z0  min10    &lt;NA&gt;      2</span>
</pre></div>
</div>
<div id="koordinatentransformationen" class="section level1">
<h1 class="hasAnchor">
<a href="#koordinatentransformationen" class="anchor"></a>Koordinatentransformationen</h1>
<p>Für die Darstellung von Elementen mit Koordinaten im Bezugsystem <a href="https://epsg.io/2056">LV95</a> oder <a href="https://epsg.io/21781">LV03</a> auf Karten ist es oft notwendig diese nach <a href="https://epsg.io/4326">WSG84</a> zu transformieren. Die Funktionen <code><a href="../../reference/transform_crs.html">rOstluft::transform_LV95_to_WSG84()</a></code> und <code><a href="../../reference/transform_crs.html">rOstluft::transform_WSG84_to_LV95()</a></code> sind Wrapper um die allgemeine Funktion <code><a href="../../reference/transform_crs.html">rOstluft::transform_crs()</a></code>.</p>
<div class="sourceCode" id="cb46"><pre class="downlit">
<span class="kw">meteoschweiz</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">readRDS</a></span>(<span class="kw">fs</span>::<span class="fu"><a href="http://fs.r-lib.org/reference/path.html">path</a></span>(<span class="kw">examples_path</span>, <span class="st">"meta_smn.rds"</span>))
<span class="kw">meteoschweiz</span> <span class="op">&lt;-</span> <span class="kw">dplyr</span>::<span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html">distinct</a></span>(<span class="kw">meteoschweiz</span>, <span class="kw">site</span>, <span class="kw">x</span>, <span class="kw">y</span>)

<span class="fu"><a href="../../reference/transform_crs.html">transform_LV95_to_WSG84</a></span>(<span class="kw">meteoschweiz</span>) <span class="op">%&gt;%</span> <span class="kw">head</span>
<span class="co">#&gt; Warning in showSRID(SRS_string, format = "PROJ", multiline = "NO"): Discarded</span>
<span class="co">#&gt; datum CH1903+ in CRS definition</span>
<span class="co">#&gt; # A tibble: 6 x 5</span>
<span class="co">#&gt;   site                 x       y   lon   lat</span>
<span class="co">#&gt;   &lt;chr&gt;            &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;</span>
<span class="co">#&gt; 1 Aadorf/Tänikon 2710517 1259824  8.90  47.5</span>
<span class="co">#&gt; 2 Altenrhein     2760382 1261386  9.57  47.5</span>
<span class="co">#&gt; 3 BadRagaz       2756910 1209350  9.50  47.0</span>
<span class="co">#&gt; 4 Chur           2759465 1193152  9.53  46.9</span>
<span class="co">#&gt; 5 Ebnat-Kappel   2726347 1237176  9.11  47.3</span>
<span class="co">#&gt; 6 Glarus         2723755 1210567  9.07  47.0</span>

<span class="fu"><a href="../../reference/transform_crs.html">transform_crs</a></span>(<span class="kw">meteoschweiz</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(lon = <span class="st">"x"</span>, lat = <span class="st">"y"</span>),
          <span class="kw">sp</span>::<span class="fu"><a href="https://rdrr.io/pkg/sp/man/CRS-class.html">CRS</a></span>(<span class="st">"+init=epsg:2056"</span>), <span class="kw">sp</span>::<span class="fu"><a href="https://rdrr.io/pkg/sp/man/CRS-class.html">CRS</a></span>(<span class="st">"+init=epsg:4326"</span>),
          append = <span class="fl">FALSE</span>) <span class="op">%&gt;%</span> <span class="kw">head</span>
<span class="co">#&gt; Warning in showSRID(uprojargs, format = "PROJ", multiline = "NO"): Discarded</span>
<span class="co">#&gt; datum CH1903+ in CRS definition</span>
<span class="co">#&gt; # A tibble: 6 x 3</span>
<span class="co">#&gt;   site             lon   lat</span>
<span class="co">#&gt;   &lt;chr&gt;          &lt;dbl&gt; &lt;dbl&gt;</span>
<span class="co">#&gt; 1 Aadorf/Tänikon  8.90  47.5</span>
<span class="co">#&gt; 2 Altenrhein      9.57  47.5</span>
<span class="co">#&gt; 3 BadRagaz        9.50  47.0</span>
<span class="co">#&gt; 4 Chur            9.53  46.9</span>
<span class="co">#&gt; 5 Ebnat-Kappel    9.11  47.3</span>
<span class="co">#&gt; 6 Glarus          9.07  47.0</span>
</pre></div>
</div>
<div id="noaa-hysplit-trajektorien" class="section level1">
<h1 class="hasAnchor">
<a href="#noaa-hysplit-trajektorien" class="anchor"></a>NOAA Hysplit Trajektorien</h1>
<p>Neben dem Ostluft AWS Store aqmet existiert noch ein Store mit hysplit Trajektorien von 1980 bis zum jeweiligen Vormonat des aktuellen Datums für die Standorte Zürich Kaserne und St. Gallen Blumenbergplatz. Die Trajektorien sind jeweils für 01:00 und 13:00 UTC+1 (=Luftmassen Herkunft) gerechnet.</p>
<p>Beim Format hysplit wird für die Abfrage nur die <code>site</code> und das <code>year</code> benötigt:</p>
<div class="sourceCode" id="cb47"><pre class="downlit">
<span class="kw">hysplit_store</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/r6_storage_s3.html">storage_s3_rds</a></span>(<span class="st">"hysplit_tutorial"</span>, <span class="fu"><a href="../../reference/format_hysplit.html">format_hysplit</a></span>(), <span class="st">"rostluft"</span>, <span class="st">"hysplit"</span>)
<span class="co">#&gt; store hysplit_tutorial initialized under 'C:\Users\tom\AppData\Local\rOstluft\hysplit_tutorial'</span>

<span class="co"># nutze den vordefinierten store (name ist optional, default ist "hysplit")</span>
<span class="kw">hysplit_store</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/store_aqmet.html">store_hysplit</a></span>(<span class="st">"hysplit_tutorial"</span>)

<span class="co"># hole die Trakektorien für Zürich Kaserne von 2018</span>
<span class="kw">traj</span> <span class="op">&lt;-</span> <span class="kw">hysplit_store</span><span class="op">$</span><span class="fu"><a href="https://rdrr.io/r/base/get.html">get</a></span>(site = <span class="st">"ZH_Kaserne_hysplit"</span>, year = <span class="fl">2018</span>)

<span class="co"># plotte die Daten mit openair</span>
<span class="kw">openair</span>::<span class="fu"><a href="https://rdrr.io/pkg/openair/man/trajPlot.html">trajPlot</a></span>(<span class="kw">openair</span>::<span class="fu"><a href="https://rdrr.io/pkg/openair/man/selectByDate.html">selectByDate</a></span>(<span class="kw">traj</span>, start = <span class="st">"2018-01-01"</span>, end = <span class="st">"2018-01-05"</span>))
</pre></div>
<p><img src="tutorial_files/figure-html/unnamed-chunk-48-1.png" width="700"></p>
</div>
<div id="lokale-daten-löschen" class="section level1">
<h1 class="hasAnchor">
<a href="#lokale-daten-l%C3%B6schen" class="anchor"></a>Lokale Daten löschen</h1>
<p>Werden die Daten lokal nicht mehr benötigt, kann mit der Funktion <code>$destroy()</code> des Store Objektes die Daten gelöscht werden. Zu beachten ist, dass der AWS S3 Store als read only initialisiert wurde. Um ihn löschen zu können muss dies geändert werden. Um ein versehentliches löschen durch Autocomplete zu verhindern, muss der String “DELETE” als Argument übergeben werden</p>
<div class="sourceCode" id="cb48"><pre class="downlit">
<span class="kw">store</span><span class="op">$</span><span class="kw">read.only</span> <span class="op">=</span> <span class="fl">FALSE</span>
<span class="kw">store</span><span class="op">$</span><span class="fu">destroy</span>(<span class="st">"DELETE"</span>)
<span class="co">#&gt; Cache for Store tutorial destroyed</span>

<span class="kw">my_store</span><span class="op">$</span><span class="fu">destroy</span>(<span class="st">"DELETE"</span>)
<span class="co">#&gt; Store eigene_daten destroyed</span>

<span class="kw">hysplit_store</span><span class="op">$</span><span class="kw">read.only</span> <span class="op">=</span> <span class="fl">FALSE</span>
<span class="kw">hysplit_store</span><span class="op">$</span><span class="fu">destroy</span>(<span class="st">"DELETE"</span>)
<span class="co">#&gt; Cache for Store hysplit_tutorial destroyed</span>
</pre></div>
</div>
<div class="footnotes">
<hr>
<ol>
<li id="fn1"><p>Der Pfad zum Verzeichnis entspricht der Ausgabe von <code><a href="https://rdrr.io/r/base/Sys.getenv.html">Sys.getenv("HOME")</a></code><a href="#fnref1" class="footnote-back">↩︎</a></p></li>
<li id="fn2"><p>rlang muss nicht als library importiert werden. … leitet die Expression an rOstluft weiter. Dieses hat den Operator importiert und kann somit die Expression korrekt auswerten.<a href="#fnref2" class="footnote-back">↩︎</a></p></li>
<li id="fn3"><p>Ausnahme für die Statistiken perc02, perc95, perc98. Die AIRMO spezifiert nicht das Basis Interval =&gt; O3_95%, In rOstluft O3_95%_min30.<a href="#fnref3" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Thomas von Allmen, Jörg Sintermann.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
